(()=>{"use strict";var e,t={1440:(e,t,s)=>{var i=s(2260),a=s(2511);const n={startTerrainHeight:.5,slopeAmplitude:200,slopeLengthRange:[375,750],slopeDetail:64,layers:[{color:13165035,width:5},{color:6065609,width:22},{color:2243451,width:10},{color:2960428,width:5},{color:3813938,width:250}]};class o{constructor(e,t,s=n){this.yOffset=0,this.scene=e,this.b2Physics=t,this.config=s;const i=Math.floor(1.5*s.slopeLengthRange[1]);this.pointsPool=[];for(let e=0;e<i;e++)this.pointsPool.push({x:0,y:0});this.vec2Pool=[];for(let e=0;e<i;e++)this.vec2Pool.push(new a.b2Vec2(0,0));this.chunks=[this.scene.add.graphics(),this.scene.add.graphics(),this.scene.add.graphics(),this.scene.add.graphics(),this.scene.add.graphics(),this.scene.add.graphics(),this.scene.add.graphics(),this.scene.add.graphics()],this.terrainBody=this.b2Physics.world.CreateBody(),this.slopeStart=new Phaser.Math.Vector2(0,0),this.update()}interpolate(e,t,s){let i=.5*(1-Math.cos(s*Math.PI));return e*(1-i)+t*i}update(){const{zoom:e,width:t,worldView:s}=this.scene.cameras.main;for(;this.slopeStart.x<s.x+t+1/e*500;)console.time("TerrainSimple#generateSlope()"),this.updateChunk(),console.timeEnd("TerrainSimple#generateSlope()")}updateChunk(){const e=[],t=[],{slopeDetail:s}=this.config,i=this.b2Physics.worldScale;let o=new Phaser.Math.Vector2(0,this.slopeStart.y),r=Phaser.Math.Between(n.slopeLengthRange[0],n.slopeLengthRange[1]);r=Math.round(r/s)*s,this.yOffset+=r>.8*this.config.slopeLengthRange[1]?.2:.05;const h=(this.config.slopeLengthRange[1],.75);let c,l,d=0===this.slopeStart.x?{x:o.x+1.5*n.slopeLengthRange[1],y:0}:{x:o.x+r,y:Math.random()*h+this.yOffset},p=0,y=0;const{startTerrainHeight:g,slopeAmplitude:u}=this.config,m=this.scene.cameras.main.height*g,b=d.x-o.x,w=this.slopeStart.x;for(;p<=d.x;){let a=m+this.interpolate(o.y,d.y,(p-o.x)/b)*u;c=this.pointsPool[y],c.x=p+w,c.y=a,e.push(c),l=this.vec2Pool[y],l.x=c.x/i,l.y=c.y/i,t.push(l),p+=s,y++}const f=new a.b2ChainShape;f.CreateChain(t,t.length,t[0],t[t.length-1]);const S={shape:f,density:0,friction:0};this.terrainBody.CreateFixture(S);const x=this.chunks.shift();if(!x)return;this.chunks.push(x),x.clear();const C=e.length,A=Math.max(e[0].y,e[C-1].y)+2*this.scene.cameras.main.height;let P=0;e.push({x:e[C-1].x,y:A},{x:w,y:A});for(const{color:t,width:s}of this.config.layers)x.translateCanvas(0,P),x.fillStyle(t),x.fillPoints(e,!0,!0),x.translateCanvas(0,0),P=s;this.slopeStart.x+=p-s,this.slopeStart.y=d.y}}class r{constructor(e,t,s=1,i=!1){this.direction=new a.b2Vec2(0,1),this.rayCastResult={hit:!1,point:null,normal:null,fraction:-1,lastHitTime:-1},this.body=e,this.scene=t,this.world=e.GetWorld(),this.rayLength=s,i&&(this.rayCastCrashResult={hit:!1,point:null,normal:null,fraction:-1,lastHitTime:-1})}update(){}callback(e,t,s,i){return this.rayCastResult.hit=!0,this.rayCastResult.point=t,this.rayCastResult.normal=s,this.rayCastResult.fraction=i,this.rayCastResult.lastHitTime=this.scene.game.getTime(),i}callbackCrash(e,t,s,i){if(this.rayCastCrashResult)return this.rayCastCrashResult.hit=!0,this.rayCastCrashResult.point=t,this.rayCastCrashResult.normal=s,this.rayCastCrashResult.fraction=i,this.rayCastCrashResult.lastHitTime=this.scene.game.getTime(),i}reset(){this.rayCastResult.hit=!1,this.rayCastResult.point=null,this.rayCastResult.normal=null,this.rayCastResult.fraction=-1,this.rayCastCrashResult&&(this.rayCastCrashResult.hit=!1,this.rayCastCrashResult.point=null,this.rayCastCrashResult.normal=null,this.rayCastCrashResult.fraction=-1)}}class h{constructor(e,t){this.isCrashed=!1,this.jumpForce=300,this.boostForce=27.5,this.board={numSegments:10,segmentLength:8.4,segmentThickness:3.375,segments:[]},this.scene=e,this.b2Physics=t,this.cursors=this.scene.input.keyboard.createCursorKeys(),this.generateSnowboard(250,50),this.generateSnowmanBody(250,50)}update(){var e,t;if(this.board.segments.forEach((e=>e.update())),(null===(e=this.board.segments[this.board.segments.length-1].rayCastCrashResult)||void 0===e?void 0:e.hit)&&this.detachBoard(),this.lostHead&&this.detachHead(),this.getTimeInAir()>150&&this.resetLegs(),null===(t=this.scene.input.activePointer)||void 0===t?void 0:t.isDown){const e=this.scene.input.activePointer;e.motionFactor=.2,this.scene.input.activePointer.x<this.scene.cameras.main.width/2?this.leanBackward():this.leanForward(),e.velocity.y<-30&&this.scene.game.getTime()-e.moveTime<=300&&this.jump()}else this.scene.input.activePointer.motionFactor=.8;this.cursors.up.isDown&&this.scene.game.getTime()-this.cursors.up.timeDown<=300&&this.jump(),this.cursors.left.isDown&&this.leanBackward(),this.cursors.right.isDown&&this.leanForward(),this.cursors.down.isDown&&this.leanCenter(),!this.isCrashed&&this.boost()}getTimeInAir(){if(this.board.segments.some((e=>e.rayCastResult.hit)))return-1;const e=Math.max(...this.board.segments.map((e=>e.rayCastResult.lastHitTime)));return this.scene.game.getTime()-e}isInAir(){return-1!==this.getTimeInAir()}detachBoard(){this.bindingJointLeft&&this.b2Physics.world.DestroyJoint(this.bindingJointLeft),this.bindingJointRight&&this.b2Physics.world.DestroyJoint(this.bindingJointRight),this.jointDistLeft&&this.b2Physics.world.DestroyJoint(this.jointDistLeft),this.jointDistRight&&this.b2Physics.world.DestroyJoint(this.jointDistRight),this.board.segments[this.board.segments.length-1].body.SetLinearVelocity(new a.b2Vec2(-50,0)),this.isCrashed=!0}detachHead(){this.neckJoint&&this.b2Physics.world.DestroyJoint(this.neckJoint),this.neckJoint=null}boost(){const e=this.isInAir()?.6:.9;this.board.segments&&this.board.segments[4].body.ApplyForceToCenter(new a.b2Vec2(this.boostForce*e,0),!0),this.body.ApplyForceToCenter(new a.b2Vec2(this.boostForce*e,0),!0)}resetLegs(){this.setDistanceLegs(25,30)}leanBackward(){this.body.ApplyAngularImpulse(this.isInAir()?-3:-4),this.setDistanceLegs(27.5,40)}leanForward(){this.body.ApplyAngularImpulse(this.isInAir()?3:4),this.setDistanceLegs(40,27.5)}leanCenter(){this.body.ApplyForceToCenter(new a.b2Vec2(0,10)),this.setDistanceLegs(25,25)}jump(){this.setDistanceLegs(40,40);const e=this.board.segments.map((e=>e.rayCastResult.hit)),t=e[0],s=e[e.length-1],i=e[4]||e[5]||e[6],a=i?.6:1;let n={x:0,y:0};t&&!s?n.y=-this.jumpForce*a:s&&!t?n=this.body.GetWorldVector({x:0,y:-this.jumpForce*a},n):i&&(n.y=-this.jumpForce/2.8),this.body.ApplyForceToCenter(n,!0)}setDistanceLegs(e,t){this.jointDistLeft&&e&&this.jointDistLeft.SetLength(e/this.b2Physics.worldScale),this.jointDistRight&&t&&this.jointDistRight.SetLength(t/this.b2Physics.worldScale)}generateSnowboard(e,t){const{numSegments:s,segmentLength:i,segmentThickness:n}=this.board;for(let s=1;s<=this.board.numSegments;s++){const a=this.b2Physics.createBox(e+i*s,t,0,i,n,!0,13973086);this.board.segments.push(new r(a,this.scene,.5,s===this.board.numSegments))}this.board.leftBinding=this.board.segments[3].body,this.board.rightBinding=this.board.segments[6].body;const o=[{dampingRatio:.5,frequencyHz:5,referenceAngle:-.35},{dampingRatio:.5,frequencyHz:5,referenceAngle:-.25},{dampingRatio:.5,frequencyHz:6,referenceAngle:0},{dampingRatio:.5,frequencyHz:7,referenceAngle:0},{dampingRatio:.5,frequencyHz:10,referenceAngle:0},{dampingRatio:.5,frequencyHz:7,referenceAngle:0},{dampingRatio:.5,frequencyHz:6,referenceAngle:0},{dampingRatio:.5,frequencyHz:5,referenceAngle:-.25},{dampingRatio:.5,frequencyHz:5,referenceAngle:-.35}];for(let n=0;n<s-1;n++){const[s,r]=this.board.segments.slice(n,n+2),h=new a.b2Vec2((e+i/2+i*(n+1))/this.b2Physics.worldScale,t/this.b2Physics.worldScale),{dampingRatio:c,frequencyHz:l,referenceAngle:d}=o[n],p=new a.b2WeldJointDef;p.Initialize(s.body,r.body,h),p.referenceAngle=d,a.b2AngularStiffness(p,l,c,p.bodyA,p.bodyB),this.b2Physics.world.CreateJoint(p)}}generateSnowmanBody(e,t){if(!this.board.leftBinding||!this.board.rightBinding)return;const s=this.b2Physics.worldScale,n=.7*s,o=.7*s,r=.3*s,h=.5,c=new a.b2Vec2(e+this.board.segmentLength*(this.board.numSegments/2+h),t-2*s-s/2),l=this.b2Physics.createCircle(c.x,c.y-s-n,0,n,{color:13165035,type:a.b2BodyType.b2_dynamicBody});this.body=this.b2Physics.createCircle(c.x,c.y,0,s,{color:13165035,type:a.b2BodyType.b2_dynamicBody});const d=new i.Math.Vector2(0,-1).multiply({x:0,y:s}).add(c);this.neckJoint=this.b2Physics.createRevoluteJoint({bodyA:this.body,bodyB:l,anchor:d,lowerAngle:-.25,upperAngle:.25,enableLimit:!0});const p=s+o/1.75,y=new i.Math.Vector2(0,1).rotate(h).multiply({x:p,y:p}).add(c),g=this.b2Physics.createBox(y.x,y.y,h,r,o,!0),u=new i.Math.Vector2(0,1).rotate(h).multiply({x:s,y:s}).add(c);this.b2Physics.createRevoluteJoint({bodyA:this.body,bodyB:g,anchor:u,lowerAngle:-.2,upperAngle:1,enableLimit:!0});const m=new i.Math.Vector2(0,1).rotate(.25).multiply({x:o,y:o}).add(y),b=this.b2Physics.createBox(m.x,m.y,0,r,o,!0),w=new i.Math.Vector2(m.x,m.y).add({x:0,y:-o/2});this.b2Physics.createRevoluteJoint({bodyA:g,bodyB:b,anchor:w,lowerAngle:-1.5,upperAngle:.375,enableLimit:!0});const f=new i.Math.Vector2(m).add({x:0,y:o/2});this.b2Physics.createRevoluteJoint({bodyA:b,bodyB:this.board.leftBinding,anchor:f});const S=s+o/1.75,x=new i.Math.Vector2(0,1).rotate(-.5).multiply({x:S,y:S}).add(c),C=this.b2Physics.createBox(x.x,x.y,-.5,r,o,!0),A=new i.Math.Vector2(0,1).rotate(-.5).multiply({x:s,y:s}).add(c);this.b2Physics.createRevoluteJoint({bodyA:this.body,bodyB:C,anchor:A,lowerAngle:-1,upperAngle:.2,enableLimit:!0});const P=new i.Math.Vector2(0,1).rotate(-.25).multiply({x:o,y:o}).add(x),R=this.b2Physics.createBox(P.x,P.y,0,r,o,!0),v=new i.Math.Vector2(P.x,P.y).add({x:0,y:-o/2});this.b2Physics.createRevoluteJoint({bodyA:C,bodyB:R,anchor:v,lowerAngle:-.375,upperAngle:1.5,enableLimit:!0});const B=new i.Math.Vector2(P).add({x:0,y:o/2});this.b2Physics.createRevoluteJoint({bodyA:R,bodyB:this.board.rightBinding,anchor:B})}}class c{constructor(e,t,s){this.textureKeys=new Set,this.ZERO=new a.b2Vec2(0,0),this.scene=e,this.worldScale=t,this.world=a.b2World.Create(s),this.userDataGraphics=e.add.graphics()}createBox(e,t,s,i,n,o,r=11962192){const h=new a.b2PolygonShape;h.SetAsBox(i/2/this.worldScale,n/2/this.worldScale);const c={shape:h,density:.1,friction:.001,restitution:.005},l=this.world.CreateBody({position:{x:e/this.worldScale,y:t/this.worldScale},angle:s,linearDamping:.15,angularDamping:.1,type:a.b2BodyType.b2_dynamicBody});l.CreateFixture(c),l.SetMassData({mass:.5,center:new a.b2Vec2,I:1});let d=this.scene.add.graphics();d.fillStyle(r),d.fillRect(-i/2,-n/2,2*i,2*n);const p=`box-${i}-${n}-${r}`;this.textureKeys.has(p)||(this.textureKeys.add(p),d.generateTexture(p,i,n));const y=this.scene.add.image(e,t,p);return l.SetUserData(y),l}createCircle(e,t,s,i,n={}){const o=new a.b2CircleShape;o.m_radius=i/this.worldScale;const r={shape:o,density:.1,friction:.001,restitution:.005},h=this.world.CreateBody({position:{x:e/this.worldScale,y:t/this.worldScale},angle:s,linearDamping:n.linearDamping,angularDamping:n.angularDamping,type:a.b2BodyType.b2_dynamicBody});h.CreateFixture(r),h.SetMassData({mass:1,center:this.ZERO,I:1});const c=this.scene.add.graphics();c.fillStyle(n.color||3355443),c.fillCircle(0,0,i);const l=`circle-${i}-${n.color||3355443}`;return this.textureKeys.has(l)||this.textureKeys.add(l),h.SetUserData(c),h}createRevoluteJoint(e){const t=new a.b2RevoluteJointDef,s=new a.b2Vec2(e.anchor.x/this.worldScale,e.anchor.y/this.worldScale);return t.Initialize(e.bodyA,e.bodyB,s),e.lowerAngle&&(t.lowerAngle=e.lowerAngle),e.upperAngle&&(t.upperAngle=e.upperAngle),e.enableLimit&&(t.enableLimit=e.enableLimit),this.world.CreateJoint(t)}update(){console.time("Physics#update()");let e=Math.round(this.scene.game.loop.delta)/640;const t=Math.floor(Math.max(this.scene.game.loop.actualFps/3,2));this.world.Step(e,{positionIterations:t,velocityIterations:t}),this.world.ClearForces();const s=this.scene.cameras.main.scrollX-450,i=this.worldScale;for(let e=this.world.GetBodyList();e;e=e.GetNext()){if(!e)continue;let t=e.GetUserData();if(t){let s=e.GetPosition();t.x=s.x*i,t.y=s.y*i,t.rotation=e.GetAngle()}else for(let t=e.GetFixtureList();t;t=t.GetNext()){const a=t.GetShape();this.isChain(a)&&a.m_vertices[a.m_vertices.length-1].x*i<s&&e.DestroyFixture(t)}}console.timeEnd("Physics#update()")}isEdge(e){return e.GetType()===a.b2ShapeType.e_edge}isChain(e){return e.GetType()===a.b2ShapeType.e_chain}isPolygon(e){return e.GetType()===a.b2ShapeType.e_polygon}isCircle(e){return e.GetType()===a.b2ShapeType.e_circle}}class l{constructor(e){this.scene=e;const{width:t,height:s}=this.scene.cameras.main;this.bgSpaceBack=this.scene.add.tileSprite(0,0,t,s,"space-back").setOrigin(0).setScrollFactor(0,0),this.bgSpaceMid=this.scene.add.tileSprite(0,0,t,s,"space-mid").setOrigin(0).setScrollFactor(0,0),this.bgSpaceFront=this.scene.add.tileSprite(0,0,t,s,"space-front").setOrigin(0).setScrollFactor(0,0),this.bgLandscapeMountains=this.scene.add.tileSprite(0,0,t,s,"bg-landscape-4-mountain").setZ(2).setScale(1.25,2).setOrigin(0,.5).setScrollFactor(0,0).setTint(30,30,30,30),this.bgLandscapeHills=this.scene.add.tileSprite(0,0,t,s,"bg-landscape-3-trees").setScale(1.25,1.5).setOrigin(0,.25).setScrollFactor(0,0).setZ(1).setTint(50,50,50,50)}update(){const{scrollX:e,scrollY:t}=this.scene.cameras.main;this.bgSpaceBack.setTilePosition(.001*e,.001*t),this.bgSpaceMid.setTilePosition(.0025*e,.0025*t),this.bgSpaceFront.setTilePosition(.005*e,.005*t),this.bgLandscapeMountains.setTilePosition(.025*e,0),this.bgLandscapeHills.setTilePosition(.035*e,0)}}class d extends i.Scene{constructor(){super({key:"GameScene"})}create(){return e=this,t=void 0,i=function*(){this.music=this.sound.add("theme"),this.music.play({loop:!0,volume:.5,rate:.9,delay:1.25});let e=new a.b2Vec2(0,9.8);this.b2Physics=new c(this,15,e),this.backdrop=new l(this),this.terrainSimple=new o(this,this.b2Physics),this.wickedSnowman=new h(this,this.b2Physics);const t=this.cameras.main.worldView.x+this.cameras.main.width/2,s=this.cameras.main.worldView.y+this.cameras.main.height/2;this.add.text(t+50,s-200,"WICKED SNOWMAN").setScrollFactor(.35).setFontSize(40).setOrigin(.5),this.add.text(t+50,s-100,"Don't lose your head").setScrollFactor(.35).setFontSize(25).setOrigin(.5),this.add.text(t-35,s-62.5," ↑  jump").setScrollFactor(.35).setFontSize(20).setOrigin(0),this.add.text(t-35,s-37.5,"← → control").setScrollFactor(.35).setFontSize(20).setOrigin(0),this.playAgainButton=this.add.text(t,s,"PLAY AGAIN?").setScrollFactor(0).setFontSize(25).setOrigin(.5).setPadding(12).setAlpha(0).setStyle({backgroundColor:"#223B7B"}).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.restartGame())).on("pointerover",(()=>this.playAgainButton.setStyle({fill:"#5c8dc9"}))).on("pointerout",(()=>this.playAgainButton.setStyle({fill:"#FFF"}))),this.textDistance=this.add.text(12,12,"Travelled: 0m").setScrollFactor(0,0).setFontSize(16),this.textDistance.setShadow(1,1,"#000000",2),this.cameras.main.startFollow(this.wickedSnowman.body.GetUserData(),!1,.8,.25),this.cameras.main.followOffset.set(-375,0),this.cameras.main.setDeadzone(50,125),this.cameras.main.setBackgroundColor(0),this.cameras.main.setZoom(1,1)},new((s=void 0)||(s=Promise))((function(a,n){function o(e){try{h(i.next(e))}catch(e){n(e)}}function r(e){try{h(i.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}h((i=i.apply(e,t||[])).next())}));var e,t,s,i}restartGame(){this.music.stop(),this.scene.restart()}update(){this.wickedSnowman.isCrashed&&!this.playAgainButton.alpha&&(this.playAgainButton.setAlpha(1),this.tweens.add({targets:this.music,volume:0,detune:-500,rate:.5,duration:3e3,onComplete:e=>this.music.stop()})),this.wickedSnowman.isCrashed||(this.metersTravelled=Math.floor(this.wickedSnowman.body.GetPosition().Length()/2),this.textDistance.setText("Travelled: "+this.metersTravelled+"m")),this.backdrop.update(),this.wickedSnowman.update(),this.terrainSimple.update(),this.b2Physics.update()}}class p extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.audio("theme",["assets/audio/theme/theme.ogg","assets/audio/theme/theme.mp3","assets/audio/theme/theme.aac"]),this.load.image("space-back","assets/img/bgSpace/bg_space_seamless.png"),this.load.image("space-mid","assets/img/bgSpace/bg_space_seamless_fl1.png"),this.load.image("space-front","assets/img/bgSpace/bg_space_seamless_fl2.png"),this.load.image("bg-landscape-3-trees","assets/img/bgLandscape/landscape_0002_3_trees.png"),this.load.image("bg-landscape-4-mountain","assets/img/bgLandscape/landscape_0003_4_mountain.png")}create(){this.scene.start("GameScene")}}const y={type:i.WEBGL,backgroundColor:"#ffffff",disableContextMenu:!0,fps:{min:55,target:60,smoothStep:!0},scale:{parent:"phaser-wrapper",mode:i.Scale.ENVELOP,autoCenter:i.Scale.CENTER_BOTH,width:960,height:540},scene:[p,d]};window.addEventListener("load",(()=>{new i.Game(y)}))}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(l=0;l<e.length;l++){for(var[s,a,n]=e[l],r=!0,h=0;h<s.length;h++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[h])))?s.splice(h--,1):(r=!1,n<o&&(o=n));if(r){e.splice(l--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[s,a,n]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,h]=s,c=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(h)var l=h(i)}for(t&&t(s);c<o.length;c++)n=o[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(l)},s=self.webpackChunkwicked_snowman=self.webpackChunkwicked_snowman||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=i.O(void 0,[216],(()=>i(1440)));a=i.O(a)})();