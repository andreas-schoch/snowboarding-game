(()=>{var e,t={7153:(e,t,s)=>{var i={"./gamestats-pixi.module.js":[6913,216]};function o(e){if(!s.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],o=t[0];return s.e(t[1]).then((()=>s(o)))}o.keys=()=>Object.keys(i),o.id=7153,e.exports=o},9209:(e,t,s)=>{"use strict";s.d(t,{fl:()=>k,eM:()=>O,R$:()=>F,$7:()=>D,m6:()=>G,qs:()=>I,gC:()=>B,Ql:()=>C,$K:()=>L,uF:()=>x,rb:()=>A,O2:()=>T,mO:()=>E,nI:()=>M,XG:()=>v,N8:()=>f,c6:()=>_,d5:()=>R,ot:()=>N});var i=s(2260);class o extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.loadAudio(),this.loadImg(),this.loadLevels(),this.load.html("dom_game_ui","assets/html/game_ui.html")}create(){this.scene.start("GameScene")}loadAudio(){this.load.audio("riverside_ride",["assets/audio/music/riverside_ride/riverside_ride.ogg","assets/audio/music/riverside_ride/riverside_ride.mp3"]),this.load.audio("boink",["assets/audio/sfx/jump/boink.ogg","assets/audio/sfx/jump/boink.mp3"]),this.load.audio("pickup_present",["assets/audio/sfx/pickup/pickupgem.ogg","assets/audio/sfx/pickup/pickupgem.mp3"]),this.load.audio("death",["assets/audio/sfx/crash/death.ogg","assets/audio/sfx/crash/death.mp3"]),this.load.audio("grunt",["assets/audio/sfx/crash_grunt/grunt.ogg","assets/audio/sfx/crash_grunt/grunt.mp3"]),this.load.audio("applause",["assets/audio/sfx/applause/applause.ogg","assets/audio/sfx/applause/applause.mp3"])}loadImg(){const e=F*M,t={360:"640x360",540:"960x540",720:"1280x720"}[[360,540,720].reduce(((t,s)=>Math.abs(s-e)<Math.abs(t-e)?s:t))];this.load.atlas("bg_space_pack",`assets/img/packed/bg_space_${t}.png`,`assets/img/packed/bg_space_${t}.json`),this.load.atlas("atlas_santa",`assets/img/packed/character_santa_${t}.png`,`assets/img/packed/character_santa_${t}.json`),this.load.atlas("atlas_environment",`assets/img/packed/environment_${t}.png`,`assets/img/packed/environment_${t}.json`)}loadLevels(){this.load.json(T.level_001,`assets/levels/export/${T.level_001}.json`),this.load.json(T.level_002,`assets/levels/export/${T.level_002}.json`),this.load.json(T.level_003,`assets/levels/export/${T.level_003}.json`)}}var r=s(2511);class a{constructor(e,t){var s;this.chunks=[],this.zoomModifier=1/G,this.layers=[{color:13165035,width:5*this.zoomModifier},{color:6065609,width:22*this.zoomModifier},{color:2243451,width:10*this.zoomModifier},{color:2960428,width:5*this.zoomModifier},{color:3813938,width:250*this.zoomModifier}],this.scene=e,this.b2Physics=t,this.terrainBody=this.b2Physics.world.CreateBody();const i=this.terrainBody.GetPosition(),o=this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserTerrain",!0)[0];if(!o)return;const r=null===(s=o.GetFixtureList())||void 0===s?void 0:s.GetShape();let a=0;const n=50*this.b2Physics.worldScale,l=[];let h=[];for(const[e,t]of[...r.m_vertices].reverse().entries()){const s={x:(t.x-i.x)*this.b2Physics.worldScale,y:-(t.y+i.y)*this.b2Physics.worldScale};h.push(s),0===e?a=s.x:e===r.m_vertices.length-1&&h.length&&l.length&&s.x-h[0].x<n&&l[l.length-1].push(...h),s.x-a>=n&&(l.push(h),h=[s],a=s.x)}l.forEach(((e,t)=>this.drawTerrain(e,t)))}update(){}drawTerrain(e,t){const s=e.length-1,i={graphics:this.scene.add.graphics().setDepth(10),index:t,vertices:e,firstVert:e[0],lastVert:e[s]};this.chunks.push(i);const o=Math.max(...i.vertices.map((e=>e.y)))+2*this.scene.cameras.main.height;let r=0;e.push({x:i.lastVert.x,y:o},{x:i.firstVert.x,y:o});for(const{color:t,width:s}of this.layers)i.graphics.translateCanvas(0,r),i.graphics.fillStyle(t),i.graphics.fillPoints(e,!0,!0),i.graphics.translateCanvas(0,0),r=.5*s}}class n{constructor(e,t,s,i){this.world=e,this.debugGraphics=t,this.scene=s,this.worldSize=i}loadScene(e){this.loadedBodies=e.body?e.body.map((e=>this.loadBody(e))):[],this.loadedJoints=e.joint?e.joint.map((e=>this.loadJoint(e))):[],this.loadedImages=e.image?e.image.map((e=>this.loadImage(e))):[];const t=this.loadedBodies.every((e=>e))&&this.loadedJoints.every((e=>e))&&this.loadedImages.every((e=>e));return t?console.log("R.U.B.E. scene loaded successfully",this.loadedBodies,this.loadedJoints,this.loadedImages):console.error("R.U.B.E. scene failed to load fully",this.loadedBodies,this.loadedJoints,this.loadedImages),t}loadBody(e){const t={};t.type=Math.min(Math.max(e.type||0,0),2),t.angle=e.angle||0,t.angularVelocity=e.angularVelocity||0,t.awake=Boolean(e.awake),t.enabled=!e.hasOwnProperty("active")||e.active,t.fixedRotation=Boolean(e.fixedRotation),t.linearVelocity=this.rubeToXY(e.linearVelocity),t.linearDamping=e.linearDamping||0,t.angularDamping=e.angularDamping||0,t.position=this.rubeToXY(e.position);const s=this.world.CreateBody(t);return s.SetMassData({mass:e["massData-mass"]||1,center:this.rubeToVec2(e["massData-center"]),I:e["massData-I"]||1}),s.name=e.name||"",s.customProperties=e.customProperties||[],s.customPropertiesMap=this.customPropertiesArrayToMap(s.customProperties||[]),(e.fixture||[]).map((e=>this.loadFixture(s,e))),s}loadFixture(e,t){const s=this.getFixtureDefWithShape(t,e);s.friction=t.friction||0,s.density=t.density||0,s.restitution=t.restitution||0,s.isSensor=Boolean(t.sensor),s.filter={categoryBits:t["filter-categoryBits"],maskBits:t["filter-maskBits"]||1,groupIndex:t["filter-groupIndex"]||65535};const i=e.CreateFixture(s);return i.name=t.name||"",i.customProperties=t.customProperties||[],i.customPropertiesMap=this.customPropertiesArrayToMap(i.customProperties),i}loadJoint(e){if(e.bodyA>=this.loadedBodies.length)return console.error("Index for bodyA is invalid: "+e),null;if(e.bodyB>=this.loadedBodies.length)return console.error("Index for bodyB is invalid: "+e),null;const t=this.loadedBodies[e.bodyA],s=this.loadedBodies[e.bodyB];if(!t||!s)return console.error("bodyA or bodyB are invalid",t,s,this.loadedBodies),null;let i;switch(e.type){case"revolute":{const o=new r.b2RevoluteJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,o.enableLimit=Boolean(e.enableLimit),o.lowerAngle=e.lowerLimit||0,o.upperAngle=e.upperLimit||0,o.enableMotor=Boolean(e.enableMotor),o.maxMotorTorque=e.maxMotorTorque||0,o.motorSpeed=e.motorSpeed||0,i=this.world.CreateJoint(o);break}case"distance":{const o=new r.b2DistanceJointDef;o.length=e.length||0,o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition()),this.rubeToVec2(e.anchorB).Rotate(s.GetAngle()).Add(s.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.length=e.length||0,o.minLength=0,o.maxLength=2*o.length,r.b2LinearStiffness(o,e.frequency||0,e.dampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}case"prismatic":{const o=new r.b2PrismaticJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition()),this.rubeToXY(e.localAxisA)),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,o.enableLimit=Boolean(e.enableLimit),o.lowerTranslation=e.lowerLimit||0,o.upperTranslation=e.upperLimit||0,o.enableMotor=Boolean(e.enableMotor),o.maxMotorForce=e.maxMotorForce||0,o.motorSpeed=e.motorSpeed||0,i=this.world.CreateJoint(o);break}case"wheel":{const o=new r.b2WheelJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorB),this.rubeToVec2(e.localAxisA)),o.collideConnected=Boolean(e.collideConnected),o.enableMotor=Boolean(e.enableMotor),o.maxMotorTorque=e.maxMotorTorque||0,o.motorSpeed=e.motorSpeed||0,r.b2LinearStiffness(o,e.springFrequency||0,e.springDampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}case"friction":{const o=new r.b2FrictionJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.maxForce=e.maxForce||0,o.maxTorque=e.maxTorque||0,i=this.world.CreateJoint(o);break}case"weld":{const o=new r.b2WeldJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,r.b2AngularStiffness(o,e.frequency||0,e.dampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}default:throw new Error("Unsupported joint type: "+e.type)}return i.name=e.name,i.customProperties=e.customProperties||[],i.customPropertiesMap=this.customPropertiesArrayToMap(i.customProperties),i}loadImage(e){const{file:t,body:s,center:i,customProperties:o,angle:r,aspectScale:a,scale:n,flip:l,renderOrder:h}=e,c=this.loadedBodies[s],d=c?c.GetPosition().Add(this.rubeToXY(i)):this.rubeToXY(i);if(!d)return null;const u=this.getCustomProperty(e,"string","phaserTexture",""),p=(t||"").split("/").reverse()[0],m=this.getCustomProperty(e,"string","phaserTextureFrame",p),g=this.scene.add.image(d.x*this.worldSize,d.y*-this.worldSize,u||p,m);return g.rotation=c?-c.GetAngle()-(r||0):-(r||0),g.scaleY=this.worldSize/g.height*n,g.scaleX=g.scaleY*a,g.flipX=l,g.setDepth(h),g.custom_origin_angle=-(r||0),g.customProperties=o||[],g.customPropertiesMap=this.customPropertiesArrayToMap(g.customProperties),c&&c.SetUserData(g),g}rubeToXY(e,t={x:0,y:0}){return this.isXY(e)?{x:e.x+t.x,y:e.y+t.y}:t}rubeToVec2(e){return this.isXY(e)?new r.b2Vec2(e.x,e.y):new r.b2Vec2(0,0)}getBodiesByName(e){const t=[];for(let s=this.world.GetBodyList();s;s=s.GetNext())s&&s.name===e&&t.push(s);return t}getBodiesByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetBodyList();o;o=o.GetNext())if(o&&o.customProperties)for(let r=0;r<o.customProperties.length;r++)o.customProperties[r].hasOwnProperty("name")&&o.customProperties[r].hasOwnProperty(e)&&o.customProperties[r].name==t&&o.customProperties[r][e]==s&&i.push(o);return i}getFixturesByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetBodyList();o;o=o.GetNext())for(let r=o.GetFixtureList();r;r=r.GetNext())if(r&&r.customProperties)for(let o=0;o<r.customProperties.length;o++)r.customProperties[o].hasOwnProperty("name")&&r.customProperties[o].hasOwnProperty(e)&&r.customProperties[o].name==t&&r.customProperties[o][e]==s&&i.push(r);return i}getJointsByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetJointList();o;o=o.GetNext())if(o&&o.customProperties)for(let r=0;r<o.customProperties.length;r++)o.customProperties[r].hasOwnProperty("name")&&o.customProperties[r].hasOwnProperty(e)&&o.customProperties[r].name==t&&o.customProperties[r][e]==s&&i.push(o);return i}getCustomProperty(e,t,s,i){if(!e.customProperties)return i;for(const i of e.customProperties)if(i.name&&i.hasOwnProperty(t)&&i.name===s)return i[t];return i}customPropertiesArrayToMap(e){return e.reduce(((e,t)=>{if(t.hasOwnProperty("int"))e[t.name]=t.int;else if(t.hasOwnProperty("float"))e[t.name]=t.float;else if(t.hasOwnProperty("string"))e[t.name]=t.string;else if(t.hasOwnProperty("color"))e[t.name]=t.color;else if(t.hasOwnProperty("bool"))e[t.name]=t.bool;else{if(!t.hasOwnProperty("vec2"))throw new Error("invalid or missing custom property type");e[t.name]=this.rubeToXY(t.vec2)}return e}),{})}getFixtureDefWithShape(e,t){if(e.hasOwnProperty("circle")&&e.circle){const s=new r.b2CircleShape;s.Set(this.rubeToXY(e.circle.center),e.circle.radius);const i=t.GetPosition().Clone().Add(s.m_p).Scale(this.worldSize);return O&&this.debugGraphics.strokeCircle(i.x,-i.y,e.circle.radius*this.worldSize),{shape:s}}if(e.hasOwnProperty("polygon")&&e.polygon){const s=this.pointsFromSeparatedVertices(e.polygon.vertices).reverse(),i=t.GetPosition();if(O){const e=s.map((e=>i.Clone().Add(new r.b2Vec2(e.x,e.y).Rotate(t.GetAngle())).Scale(this.worldSize))).map((({x:e,y:t})=>({x:e,y:-t})));this.debugGraphics.strokePoints(e,!0).setDepth(100)}return{shape:(new r.b2PolygonShape).Set(s,s.length)}}if(e.hasOwnProperty("chain")&&e.chain){const s=this.pointsFromSeparatedVertices(e.chain.vertices).reverse(),i=t.GetPosition();if(O){const e=s.map((e=>i.Clone().Add(new r.b2Vec2(e.x,e.y).Rotate(t.GetAngle())).Scale(this.worldSize))).map((({x:e,y:t})=>({x:e,y:-t})));this.debugGraphics.strokePoints(e).setDepth(100)}return{shape:e.chain.hasNextVertex&&e.chain.hasPrevVertex&&e.chain.nextVertex&&e.chain.prevVertex?(new r.b2ChainShape).CreateLoop(s,s.length):(new r.b2ChainShape).CreateChain(s,s.length,this.rubeToXY(e.chain.prevVertex),this.rubeToXY(e.chain.nextVertex))}}throw new Error("Could not find shape type for fixture")}pointsFromSeparatedVertices(e){const t=[];for(let s=0;s<e.x.length;s++)t.push(new r.b2Vec2(e.x[s],e.y[s]));return t}isXY(e){return Boolean(e&&"object"==typeof e&&e.hasOwnProperty("x")&&e.hasOwnProperty("y"))}}class l extends Phaser.Events.EventEmitter{constructor(e,t,s){super(),this.isPaused=!1,this.stepDeltaTime=1/60,this.stepConfig={positionIterations:12,velocityIterations:12},this.debugDraw=e.add.graphics(),this.scene=e,this.worldScale=t,this.world=r.b2World.Create(s),this.world.SetAutoClearForces(!0),this.world.SetContactListener({BeginContact:e=>this.emit("begin_contact",e),EndContact:()=>null,PreSolve:()=>null,PostSolve:(e,t)=>this.emit("post_solve",e,t)}),this.rubeLoader=new n(this.world,this.scene.add.graphics(),this.scene,this.worldScale)}loadRubeScene(e){const t=this.scene.cache.json.get(e);if(!this.rubeLoader.loadScene(t))throw new Error("Failed to load RUBE scene");console.log("RUBE scene loaded successfully.")}update(){if(this.isPaused)return;N.begin("physics"),this.world.Step(this.stepDeltaTime,this.stepConfig);const e=this.worldScale;for(let t=this.world.GetBodyList();t;t=t.GetNext()){if(!t)continue;let s=t.GetUserData();if(s&&s)if(t.IsEnabled()){let{x:i,y:o}=t.GetPosition();!s.visible&&s.setVisible(!0),s.x=i*e,s.y=o*-e,s.rotation=-t.GetAngle()+(s.custom_origin_angle||0)}else s.setVisible(!1)}N.end("physics")}}class h{constructor(e){this.scene=e,this.bgSpaceBack=this.registerLayer("bg_space_back.png"),this.bgSpaceMid=this.registerLayer("bg_space_mid.png"),this.bgSpaceFront=this.registerLayer("bg_space_front.png")}update(){N.begin("backdrop");const{scrollX:e,scrollY:t}=this.scene.cameras.main;this.bgSpaceBack.setTilePosition(.005*e,.005*t),this.bgSpaceMid.setTilePosition(.01*e,.01*t),this.bgSpaceFront.setTilePosition(.025*e,.025*t),N.end("backdrop")}registerLayer(e,t=1,s=1){const{width:i,height:o,zoomX:r,zoomY:a,worldView:n}=this.scene.cameras.main;return this.scene.add.tileSprite(n.x+i/2,n.y+o/2,i,o,"bg_space_pack",e).setOrigin(.5,.5).setScrollFactor(0,0).setScale(t*(1/r),s*(1/a)).setDepth(-200)}}class c{constructor(e){this.segments=[],this.pointStart=new r.b2Vec2(0,0),this.pointEnd=new r.b2Vec2(0,0),this.player=e,this.scene=e.scene,this.b2Physics=e.b2Physics,this.debugGraphics=this.scene.add.graphics(),this.initRays(this.b2Physics.worldScale/4)}update(e){O&&this.debugGraphics.clear();const t=this.segments;for(const e of this.segments)this.resetSegment(e),e.body.GetWorldPoint(r.b2Vec2.ZERO,this.pointStart),e.body.GetWorldPoint(e.groundRayDirection,this.pointEnd),this.b2Physics.world.RayCast(this.pointStart,this.pointEnd,e.groundRayCallback),O&&this.drawDebug(e.groundRayResult.hit?255:65280),e.crashRayResult&&e.crashRayCallback&&e.crashRayDirection&&(e.body.GetWorldPoint(r.b2Vec2.ZERO,this.pointStart),e.body.GetWorldPoint(e.crashRayDirection,this.pointEnd),this.b2Physics.world.RayCast(this.pointStart,this.pointEnd,e.crashRayCallback),O&&this.drawDebug(e.crashRayResult.hit?255:65280));this.isTailGrounded=t[0].groundRayResult.hit,this.isNoseGrounded=t[t.length-1].groundRayResult.hit,this.isCenterGrounded=t[3].groundRayResult.hit}getTimeInAir(){if(this.segments.some((e=>e.groundRayResult.hit)))return-1;const e=Math.max(...this.segments.map((e=>e.groundRayResult.lastHitTime)));return this.scene.game.getTime()-e}isInAir(){return-1!==this.getTimeInAir()}rayCallbackFactory(e){return(t,s,i,o)=>{if(!t.IsSensor())return e.hit=!0,e.point=s,e.normal=i,e.fraction=o,e.lastHitTime=this.scene.game.getTime(),o}}resetSegment(e){e.groundRayResult.hit=!1,e.groundRayResult.point=null,e.groundRayResult.normal=null,e.groundRayResult.fraction=-1,e.crashRayResult&&(e.crashRayResult.hit=!1,e.crashRayResult.point=null,e.crashRayResult.normal=null,e.crashRayResult.fraction=-1)}drawDebug(e){this.debugGraphics.lineStyle(2,e,1);const t=this.b2Physics.worldScale;this.debugGraphics.lineBetween(this.pointStart.x*t,-this.pointStart.y*t,this.pointEnd.x*t,-this.pointEnd.y*t)}initRays(e){const t={hit:!1,point:null,normal:null,fraction:-1,lastHitTime:-1};for(const s of this.player.parts.boardSegments){const i=this.b2Physics.rubeLoader.getCustomProperty(s,"int","phaserBoardSegmentIndex",-1)===this.player.parts.boardSegments.length-1,o=Object.assign({},t),a=Object.assign({},t);this.segments.push({body:s,groundRayDirection:new r.b2Vec2(0,-e/this.b2Physics.worldScale),groundRayResult:o,groundRayCallback:this.rayCallbackFactory(o),crashRayDirection:i?new r.b2Vec2((i?2*e:e)/this.b2Physics.worldScale,0):void 0,crashRayResult:i?a:void 0,crashRayCallback:i?this.rayCallbackFactory(a):void 0}),i&&(this.nose=this.segments[this.segments.length-1])}}}class d{constructor(e){this.levelFinished=!1,this.isCrashed=!1,this.timeGrounded=0,this.pickupsToProcess=new Set,this.seenSensors=new Set,this.comboLeeway=null,this.comboAccumulatedScore=0,this.comboMultiplier=0,this.totalTrickScore=0,this.totalCollectedPresents=0,this.trickScoreLog=[],this.anglePreviousUpdate=0,this.totalRotation=0,this.currentFlipRotation=0,this.pendingFrontFlips=0,this.pendingBackFlips=0,this.landedFrontFlips=0,this.landedBackFlips=0,this.lastDistance=0,this.parts=e.parts,this.playerController=e,this.b2Physics=e.b2Physics,this.state=e.board.isInAir()?"in_air":"grounded",this.registerCollisionListeners(),this.playerController.scene.observer.on("enter_in_air",(()=>this.state="in_air")),this.playerController.scene.observer.on("enter_grounded",(()=>{this.state="grounded",this.timeGrounded=this.playerController.scene.game.getTime(),this.landedFrontFlips+=this.pendingFrontFlips,this.landedBackFlips+=this.pendingBackFlips;const e=this.pendingBackFlips+this.pendingFrontFlips;if(e>=1){this.trickScoreLog.push({type:"flip",flips:e,timestamp:Date.now()});const t=e*e*k;this.totalTrickScore+=t,this.comboAccumulatedScore+=t*R,this.comboMultiplier++,this.playerController.scene.observer.emit("combo_change",this.comboAccumulatedScore,this.comboMultiplier),this.playerController.scene.observer.emit("score_change",this.getCurrentScore()),this.resetComboLeewayTween(),this.comboLeeway=this.createComboLeewayTween(!1)}this.totalRotation=0,this.currentFlipRotation=0,this.pendingBackFlips=0,this.pendingFrontFlips=0}))}createComboLeewayTween(e=!0){return this.playerController.scene.tweens.addCounter({paused:e,from:-.5*Math.PI,to:1.5*Math.PI,duration:4e3,onUpdate:e=>this.playerController.scene.observer.emit("combo_leeway_update",e.getValue()),onComplete:e=>this.handleComboComplete()})}reset(){this.totalTrickScore=0,this.trickScoreLog=[],this.comboLeeway&&(this.comboLeeway.stop(),this.comboLeeway=null),this.totalCollectedPresents=0,this.comboMultiplier=0,this.comboAccumulatedScore=0,this.levelFinished=!1,this.isCrashed=!1,this.seenSensors.clear(),this.pickupsToProcess.clear(),this.pendingFrontFlips=0,this.pendingBackFlips=0,this.landedBackFlips=0,this.landedFrontFlips=0,this.currentFlipRotation=0,this.anglePreviousUpdate=0,this.lastDistance=0,this.timeGrounded=0,this.totalRotation=0}getCurrentScore(){return{distance:this.getTravelDistanceMeters(),coins:this.totalCollectedPresents,trickScore:this.totalTrickScore,finishedLevel:this.levelFinished,crashed:this.isCrashed,trickScoreLog:this.trickScoreLog}}getState(){return this.state}getTravelDistanceMeters(){const e=this.parts.body.GetPosition().x;return 5*Math.floor(e/5)}registerCollisionListeners(){this.playerController.b2Physics.on("post_solve",((e,t)=>{if(this.isCrashed)return;const s=e.GetFixtureA().GetBody(),i=e.GetFixtureB().GetBody();s!==i&&(s===this.parts.head||i===this.parts.head)&&Math.max(...t.normalImpulses)>I&&this.setCrashed()})),this.playerController.b2Physics.on("begin_contact",(e=>{var t,s;const i=e.GetFixtureA(),o=e.GetFixtureB(),r=i.GetBody(),a=o.GetBody();i.IsSensor()&&!this.seenSensors.has(r)&&(null===(t=i.customPropertiesMap)||void 0===t?void 0:t.phaserSensorType)?this.handleSensor(r,i):o.IsSensor()&&!this.seenSensors.has(a)&&(null===(s=o.customPropertiesMap)||void 0===s?void 0:s.phaserSensorType)&&this.handleSensor(a,o)}))}setCrashed(){this.isCrashed=!0,this.playerController.scene.observer.emit("enter_crashed",this.getCurrentScore()),this.resetComboLeewayTween()}handleSensor(e,t){var s;if(this.seenSensors.add(e),!this.isCrashed&&!this.levelFinished)switch(null===(s=t.customPropertiesMap)||void 0===s?void 0:s.phaserSensorType){case"pickup_present":this.pickupsToProcess.add(e);break;case"level_finish":{this.playerController.scene.cameras.main.stopFollow(),console.log("congratulations you reached the end of the level"),this.handleComboComplete(),this.levelFinished=!0,this.resetComboLeewayTween();const e=this.getCurrentScore();this.playerController.scene.observer.emit("score_change",e),this.playerController.scene.observer.emit("level_finish",e);break}case"level_deathzone":this.setCrashed()}}update(e){this.processPickups();const t=this.playerController.board.isInAir();"grounded"===this.state&&t&&!this.isCrashed?this.playerController.scene.observer.emit("enter_in_air"):"in_air"!==this.state||t||this.isCrashed||this.playerController.scene.observer.emit("enter_grounded"),this.updateTrickCounter(),this.updateComboLeeway(),this.updateDistance()}processPickups(){for(const e of this.pickupsToProcess){const t=e.GetUserData();this.b2Physics.world.DestroyBody(e),t.destroy(),this.totalCollectedPresents++,this.playerController.scene.observer.emit("pickup_present",this.totalCollectedPresents),this.playerController.scene.observer.emit("score_change",this.getCurrentScore())}this.pickupsToProcess.clear()}updateTrickCounter(){if("in_air"===this.state){const e=i.Math.Angle.Normalize(this.parts.body.GetAngle()),t=this.calculateDifferenceBetweenAngles(this.anglePreviousUpdate,e);this.totalRotation+=t,this.currentFlipRotation+=t,this.anglePreviousUpdate=e,this.currentFlipRotation>=Math.PI*(0===this.pendingBackFlips?1.25:2)?(this.pendingBackFlips++,this.currentFlipRotation=0):this.currentFlipRotation<=Math.PI*-(0===this.pendingFrontFlips?1.25:2)&&(this.pendingFrontFlips++,this.currentFlipRotation=0)}}updateComboLeeway(){this.comboLeeway&&("in_air"===this.state||!this.playerController.board.isCenterGrounded||this.b2Physics.isPaused?this.comboLeeway.isPlaying()&&this.comboLeeway.pause()&&O&&console.log("pause comboLeeway"):this.comboLeeway.isPaused()&&this.comboLeeway.resume()&&O&&console.log("resume comboLeeway"))}resetComboLeewayTween(){this.comboLeeway&&(this.comboLeeway.stop(),this.comboLeeway=null)}calculateDifferenceBetweenAngles(e,t){let s=t-e;return s<-Math.PI?s+=2*Math.PI:s>Math.PI&&(s-=2*Math.PI),s}updateDistance(){const e=this.getTravelDistanceMeters();e===this.lastDistance||this.isCrashed||this.levelFinished||(this.playerController.scene.observer.emit("distance_change",e),this.playerController.scene.observer.emit("score_change",this.getCurrentScore()),this.lastDistance=e)}handleComboComplete(){if(this.levelFinished)return;const e=this.comboAccumulatedScore*this.comboMultiplier;this.totalTrickScore+=e,this.trickScoreLog.push({type:"combo",multiplier:this.comboMultiplier,accumulator:this.comboAccumulatedScore,timestamp:Date.now()}),this.playerController.scene.observer.emit("score_change",this.getCurrentScore()),this.playerController.scene.observer.emit("combo_change",0,0),this.comboAccumulatedScore=0,this.comboMultiplier=0}}class u{constructor(e,t){this.scene=e,this.b2Physics=t,this.scene.input.on("pointerdown",(e=>this.MouseDown({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale}))),this.scene.input.on("pointerup",(e=>this.MouseUp({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale}))),this.scene.input.on("pointermove",(e=>this.MouseMove({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale},!0)))}MouseMove(e,t){t&&this.mouseJoint&&this.mouseJoint.SetTarget(e)}MouseUp(e){this.mouseJoint&&(this.b2Physics.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null)}MouseDown(e){let t;if(this.mouseJoint&&(this.b2Physics.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null),this.b2Physics.world.QueryPointAABB(e,(s=>s.GetBody().GetType()!==r.b2BodyType.b2_dynamicBody||!s.TestPoint(e)||(t=s,!1))),t){const s=5,i=.5,o=t.GetBody(),a=new r.b2MouseJointDef;a.collideConnected=!0,a.damping=.1,a.bodyA=this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserTerrain",!0)[0],a.bodyB=o,a.target.Copy(e),a.maxForce=700*o.GetMass(),r.b2LinearStiffness(a,s,i,a.bodyA,a.bodyB),this.mouseJoint=this.b2Physics.world.CreateJoint(a),o.SetAwake(!0)}}}const p=(e,t=!0)=>e.distance+m(e,t)+e.coins*E+(e.finishedLevel?A:0),m=(e,t)=>t?e.trickScore:e.trickScoreLog.reduce(((e,t)=>"combo"===t.type?e+t.multiplier*t.accumulator:"flip"===t.type?e+t.flips*t.flips*k:e),0);var g,y;!function(e){e.PANEL_PAUSE_MENU="panel-pause-menu",e.PANEL_SELECT_LEVEL="panel-select-level",e.PANEL_LEADERBOARDS="panel-leaderboards",e.PANEL_HOW_TO_PLAY="panel-how-to-play",e.PANEL_SETTINGS="panel-settings",e.PANEL_CREDITS="panel-credits",e.PANEL_YOUR_SCORE="panel-your-score",e.NONE="none"}(g||(g={})),function(e){e.HUD_DISTANCE="hud-distance",e.HUD_COMBO="hud-combo",e.HUD_SCORE="hud-score"}(y||(y={}));class b extends i.Scene{constructor(){super({key:"GameUIScene"}),this.panels=[],this.pendingScore=null,this.localScores=[]}init([e,t]){this.observer=e,this.restartGame=t,this.resolutionMod=this.game.canvas.width/D}create(){const e=Number(localStorage.getItem(f)||80)/100;this.music=this.sound.add("riverside_ride",{loop:!0,volume:.5*e,rate:.95,delay:1,detune:0}),this.music.play();const t=Number(localStorage.getItem(_)||80)/100;this.sfx_jump_start=this.sound.add("boink",{detune:-200,volume:t}),this.sfx_pickup_present=this.sound.add("pickup_present",{detune:100,rate:1.1,volume:t}),this.sfx_death=this.sound.add("death",{detune:700,rate:1.25,volume:t}),this.sfx_grunt=this.sound.add("grunt",{detune:700,rate:1.25,volume:.6*t}),this.sfx_applause=this.sound.add("applause",{detune:0,rate:1,volume:.6*t});const s=this.cameras.main.worldView.x+this.cameras.main.width/2;this.cameras.main.worldView.y,this.cameras.main.height,this.initDomUi(),this.observer.on("toggle_pause",((e,t)=>this.setPanelVisibility(e?t:g.NONE))),this.observer.on("jump_start",(()=>this.sfx_jump_start.play({delay:.15,detune:-200,rate:1}))),this.observer.on("pickup_present",(e=>{this.hudDistance&&(this.hudDistance.innerText=String(e)+"x"),this.sfx_pickup_present.play()})),this.observer.on("combo_change",((e,t)=>{this.hudCombo&&(this.hudCombo.innerText=e?e+"x"+t:"-")})),this.observer.on("score_change",(e=>{this.hudScore&&(this.hudScore.innerText=String(p(e)))})),this.comboLeewayChart=this.add.graphics(),this.observer.on("combo_leeway_update",(e=>{this.comboLeewayChart.clear().fillStyle(16777215).slice(s,72*this.resolutionMod,12*this.resolutionMod,e,1.5*Math.PI).fillPath()})),this.observer.on("enter_crashed",(e=>{this.pendingScore=e,this.sfx_death.play(),this.sfx_grunt.play(),this.comboLeewayChart.clear(),this.hudCombo&&(this.hudCombo.innerText="-"),this.tweens.add({targets:this.music,volume:0,detune:-500,rate:.5,duration:2e3,onComplete:()=>{this.music.stop(),this.updateYourScorePanelData(e),this.setPanelVisibility(g.PANEL_YOUR_SCORE)}})})),this.observer.on("level_finish",(e=>{this.pendingScore=e,this.sfx_applause.play(),this.comboLeewayChart.clear(),this.tweens.add({targets:this.music,volume:0,duration:2e3,onComplete:()=>{this.music.stop(),this.updateYourScorePanelData(e),this.setPanelVisibility(g.PANEL_YOUR_SCORE)}})}))}update(){}initDomUi(){const e=this.cameras.main.worldView.x+this.cameras.main.width/2,t=this.cameras.main.worldView.y+this.cameras.main.height/2,s=this.add.dom(e,t).createFromCache("dom_game_ui");s.setScale(this.resolutionMod).addListener("click");const i=localStorage.getItem(v)||"1",o=Array.from(document.querySelectorAll('#settings-form input[name="resolution"]'));for(const e of o)e.value===i&&(e.checked=!0);const r=localStorage.getItem(f)||"80",a=document.querySelector('#settings-form input[name="volumeMusic"]');a&&(a.value=r);const n=localStorage.getItem(_)||"80",l=document.querySelector('#settings-form input[name="volumeSfx"]');l&&(l.value=n);const h=this.sys.game.device.browser;if(!(h.chrome||h.edge||h.opera)){const e=document.getElementById("unsupported-browser-notice");if(!e)throw new Error('element with id "unsupported-browser-notice" not found');console.warn("Unsupported browser detected. Game may run well but it was not optimized for this particular browser:",h),e.classList.remove("hidden")}const c=document.getElementById("pause-game-icon"),d=document.getElementById("how-to-play-icon");if(c&&d&&setTimeout((()=>{c.classList.remove("hidden"),d.classList.remove("hidden")}),250),this.panelPauseMenu=document.getElementById(g.PANEL_PAUSE_MENU),this.panelSelectLevel=document.getElementById(g.PANEL_SELECT_LEVEL),this.panelHowToPlay=document.getElementById(g.PANEL_HOW_TO_PLAY),this.panelLeaderboards=document.getElementById(g.PANEL_LEADERBOARDS),this.panelSettings=document.getElementById(g.PANEL_SETTINGS),this.panelCredits=document.getElementById(g.PANEL_CREDITS),this.panelYourScore=document.getElementById(g.PANEL_YOUR_SCORE),this.hudDistance=document.getElementById(y.HUD_DISTANCE),this.hudCombo=document.getElementById(y.HUD_COMBO),this.hudScore=document.getElementById(y.HUD_SCORE),!this.panelPauseMenu)throw new Error("panelPauseMenu not found");if(!this.panelSelectLevel)throw new Error("panelSelectLevel not found");if(!this.panelHowToPlay)throw new Error("panelHowToPlay not found");if(!this.panelLeaderboards)throw new Error("panelLeaderboards not found");if(!this.panelSettings)throw new Error("panelSettings not found");if(!this.panelCredits)throw new Error("panelCredits not found");if(!this.panelYourScore)throw new Error("panelYourScore not found");if(!this.hudDistance)throw new Error("hudDistance not found");if(!this.hudCombo)throw new Error("hudCombo not found");if(!this.hudScore)throw new Error("hudScore not found");return this.panels=[this.panelPauseMenu,this.panelSelectLevel,this.panelHowToPlay,this.panelLeaderboards,this.panelSettings,this.panelCredits,this.panelYourScore],s.on("click",(e=>{var t,s,i;switch(e.target.id){case"btn-goto-pause-menu":this.setPanelVisibility(g.PANEL_PAUSE_MENU);break;case"btn-resume-game":this.setPanelVisibility(g.NONE),this.observer.emit("resume_game");break;case"btn-goto-select-level":this.setPanelVisibility(g.PANEL_SELECT_LEVEL);break;case"btn-goto-how-to-play":this.setPanelVisibility(g.PANEL_HOW_TO_PLAY);break;case"btn-goto-leaderboards":this.localScores=JSON.parse(localStorage.getItem(x)||"[]"),this.updateLeaderboardPanelData(this.localScores),this.setPanelVisibility(g.PANEL_LEADERBOARDS);break;case"btn-goto-settings":this.setPanelVisibility(g.PANEL_SETTINGS);break;case"btn-goto-credits":this.setPanelVisibility(g.PANEL_CREDITS);break;case"pause-game-icon":(null===(t=this.panelPauseMenu)||void 0===t?void 0:t.classList.contains("hidden"))&&this.observer.emit("pause_game_icon_pressed");break;case"how-to-play-icon":(null===(s=this.panelPauseMenu)||void 0===s?void 0:s.classList.contains("hidden"))&&this.observer.emit("how_to_play_icon_pressed");break;case"btn-score-submit":{const e=document.querySelector(".submit-score"),t=document.getElementById("username"),s=null==t?void 0:t.value;s&&this.pendingScore&&e&&(this.submitScore(this.pendingScore,s),e.classList.add("hidden"));break}case"btn-save-settings":{e.preventDefault();const t=null===(i=this.panelSettings)||void 0===i?void 0:i.querySelector("form");t&&(localStorage.setItem(v,t.resolution.value||"1"),localStorage.setItem(f,t.volumeMusic.value),localStorage.setItem(_,t.volumeSfx.value),location.reload());break}case"btn-play-again":this.playAgain();break;case"level_001":case"level_002":localStorage.setItem(B,e.target.id),this.playAgain();break;default:console.log("non-interactable target id",e.target.id)}})),s}playAgain(){this.music.stop(),this.restartGame()}setPanelVisibility(e){const t=document.getElementById("pause-game-icon"),s=document.getElementById("how-to-play-icon");t&&s&&(e===g.NONE?(t.classList.remove("hidden"),s.classList.remove("hidden")):(t.classList.add("hidden"),s.classList.add("hidden"))),this.panels.forEach((t=>{t.id===e?t.classList.remove("hidden"):t.classList.add("hidden")}))}updateYourScorePanelData(e){const t=e.trickScoreLog.reduce(((e,t)=>"combo"===t.type?e+t.multiplier*t.accumulator:"flip"===t.type?e+t.flips*t.flips*k:e),0);if(console.log("trickScore computed",t,e.trickScore),this.panelYourScore){const t=document.getElementById("your-score-distance"),s=document.getElementById("your-score-coins"),i=document.getElementById("your-score-trick-score"),o=document.getElementById("your-score-best-combo"),r=document.getElementById("your-score-total"),a=document.getElementById("username"),n=document.querySelector(".submit-score");e.finishedLevel?this.panelYourScore.classList.add("succeeded"):this.panelYourScore.classList.remove("succeeded");const l=e.trickScoreLog.filter((e=>"combo"===e.type)),h=l.length?Math.max(...l.map((e=>e.accumulator*e.multiplier))):0;t&&(t.innerText=String(e.distance)+"m"),s&&(s.innerText=`${e.coins}x${E}`),i&&(i.innerText=String(e.trickScore)),o&&(o.innerText=String(h)),r&&(r.innerText=String(p(e)));const c=localStorage.getItem(L),d=localStorage.getItem(C);a&&!c?(a.value=`Player_${this.pseudoRandomId()}`,a.setAttribute("value",a.value),localStorage.setItem(L,a.value),localStorage.setItem(C,(null===crypto||void 0===crypto?void 0:crypto.randomUUID)?crypto.randomUUID():this.pseudoRandomId())):c&&d&&(null==n||n.classList.add("hidden"),this.submitScore(e,d))}}submitScore(e,t){const s=JSON.parse(localStorage.getItem(x)||"[]");e.id=this.pseudoRandomId(),e.timestamp=Date.now(),s.push(e),this.localScores=s,console.log("localScores",s),localStorage.setItem(x,JSON.stringify(s))}pseudoRandomId(){return Math.random().toString(36).slice(2)}updateLeaderboardPanelData(e){const t=document.getElementById("leaderboard-item-template"),s=document.getElementById("leaderboard-item-container");if(this.panelLeaderboards&&t&&s){const i=localStorage.getItem(L);e=e.map((e=>Object.assign(Object.assign({},e),{total:p(e,!1),username:e.username||localStorage.getItem(L)}))).sort(((e,t)=>t.total-e.total)),s.innerText="";for(const[o,r]of e.entries()){const e=i&&i===r.username?"You":r.username,a=t.content.cloneNode(!0),n=a.querySelector("#leaderboard-item-rank"),l=a.querySelector("#leaderboard-item-username"),h=a.querySelector("#leaderboard-item-score");n&&(n.innerHTML=String(o+1)),l&&(l.innerHTML=String(e)),h&&(h.innerHTML=String(r.total)),s.appendChild(a)}}}}class w{constructor(e,t){var s,i,o,a,n,l,h,p,m,y;this.jumpForce=39e3,this.leanForce=150,this.jumpVector=new r.b2Vec2(0,0),this.scene=e,this.b2Physics=t,this.cursors=null===(s=this.scene.input.keyboard)||void 0===s?void 0:s.createCursorKeys(),this.scene.observer.on("pause_game_icon_pressed",(()=>this.pauseGame())),this.scene.observer.on("how_to_play_icon_pressed",(()=>this.pauseGame(g.PANEL_HOW_TO_PLAY))),null===(i=this.scene.input.keyboard)||void 0===i||i.on("keydown-ESC",(()=>this.pauseGame())),null===(o=this.cursors)||void 0===o||o.space.on("down",(()=>this.pauseGame())),this.scene.observer.on("resume_game",(()=>this.b2Physics.isPaused=!1)),null===(a=this.cursors)||void 0===a||a.up.on("down",(()=>{this.cursors&&!this.state.isCrashed&&!this.state.levelFinished&&"grounded"===this.state.getState()&&this.scene.game.getTime()-this.cursors.up.timeDown<=250&&!this.b2Physics.isPaused&&this.scene.observer.emit("jump_start")})),this.initBodyParts(),this.board=new c(this),this.state=new d(this),O&&(new u(e,t),this.debugKeyLeft=null===(n=this.scene.input.keyboard)||void 0===n?void 0:n.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.debugKeyRight=null===(l=this.scene.input.keyboard)||void 0===l?void 0:l.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.debugKeyUp=null===(h=this.scene.input.keyboard)||void 0===h?void 0:h.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.debugKeyDown=null===(p=this.scene.input.keyboard)||void 0===p?void 0:p.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.debugControls=new Phaser.Cameras.Controls.SmoothedKeyControl({camera:this.scene.cameras.main,zoomIn:null===(m=this.scene.input.keyboard)||void 0===m?void 0:m.addKey(Phaser.Input.Keyboard.KeyCodes.Q),zoomOut:null===(y=this.scene.input.keyboard)||void 0===y?void 0:y.addKey(Phaser.Input.Keyboard.KeyCodes.E),acceleration:.05,drag:.0015,maxSpeed:1,zoomSpeed:.02}))}pauseGame(e=g.PANEL_PAUSE_MENU){this.state.isCrashed||this.state.levelFinished||(this.b2Physics.isPaused=!this.b2Physics.isPaused,this.state.updateComboLeeway(),this.scene.observer.emit("toggle_pause",this.b2Physics.isPaused,e))}update(e){var t,s,i,o,r;if(!this.b2Physics.isPaused){if(N.begin("snowman"),O&&(this.debugControls&&this.debugControls.update(e),(null===(t=this.debugKeyLeft)||void 0===t?void 0:t.isDown)&&(this.scene.cameras.main.scrollX-=300*e),(null===(s=this.debugKeyRight)||void 0===s?void 0:s.isDown)&&(this.scene.cameras.main.scrollX+=300*e),(null===(i=this.debugKeyUp)||void 0===i?void 0:i.isDown)&&(this.scene.cameras.main.scrollY-=300*e),(null===(o=this.debugKeyDown)||void 0===o?void 0:o.isDown)&&(this.scene.cameras.main.scrollY+=300*e)),this.state.update(e),this.state.isCrashed&&this.detachBoard(),this.board.getTimeInAir()>100&&this.resetLegs(),!this.state.isCrashed&&!this.state.levelFinished){if(this.board.update(e),(null===(r=this.scene.input.activePointer)||void 0===r?void 0:r.isDown)&&this.scene.input.activePointer.wasTouch){const t=this.scene.input.activePointer;t.motionFactor=.2,this.scene.input.activePointer.x<this.scene.cameras.main.width/2?this.leanBackward(e):this.leanForward(e),t.velocity.y<-30&&this.scene.game.getTime()-t.moveTime<=250&&this.jump(e)}else this.scene.input.activePointer.motionFactor=.8;this.cursors&&(this.cursors.up.isDown&&this.leanUp(e),this.cursors.left.isDown&&this.leanBackward(e),this.cursors.right.isDown&&this.leanForward(e),this.cursors.down.isDown&&this.leanCenter(e),this.cursors.up.isDown&&this.scene.game.getTime()-this.cursors.up.timeDown<=250&&this.jump(e))}N.end("snowman")}}detachBoard(){this.parts.bindingLeft&&this.b2Physics.world.DestroyJoint(this.parts.bindingLeft),this.parts.bindingRight&&this.b2Physics.world.DestroyJoint(this.parts.bindingRight),this.parts.distanceLegLeft&&this.b2Physics.world.DestroyJoint(this.parts.distanceLegLeft),this.parts.distanceLegRight&&this.b2Physics.world.DestroyJoint(this.parts.distanceLegRight),this.parts.weldCenter&&this.b2Physics.world.DestroyJoint(this.parts.weldCenter),this.parts.prismatic&&this.b2Physics.world.DestroyJoint(this.parts.prismatic)}jump(e){if(this.scene.game.getTime()-this.state.timeGrounded<100)return;this.leanUp(e);const{isTailGrounded:t,isCenterGrounded:s,isNoseGrounded:i}=this.board;if(s||t||i){const t=this.jumpForce*e,i=this.jumpVector.Set(0,0);s?this.parts.body.GetWorldVector({x:0,y:.3*t},i).Add({x:0,y:1.25*t}):this.parts.body.GetWorldVector({x:0,y:.5*t},i).Add({x:0,y:.85*t}),this.parts.body.ApplyForceToCenter(i,!0)}}resetLegs(){var e,t;null===(e=this.parts.distanceLegLeft)||void 0===e||e.SetLength(.65),null===(t=this.parts.distanceLegRight)||void 0===t||t.SetLength(.65)}leanBackward(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.55),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.8),this.parts.weldCenter.m_referenceAngle=Math.PI/180*-10,this.parts.body.ApplyAngularImpulse(this.leanForce*e)}leanForward(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.8),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.55),this.parts.weldCenter.m_referenceAngle=Math.PI/180*10,this.parts.body.ApplyAngularImpulse(-this.leanForce*e)}leanCenter(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.55),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.55),this.parts.weldCenter.m_referenceAngle=0}leanUp(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.8),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.8),this.parts.weldCenter.m_referenceAngle=0}initBodyParts(){this.parts={head:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","head")[0],body:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","body")[0],boardSegments:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","boardSegment"),bindingLeft:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","bindingLeft")[0],bindingRight:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","bindingRight")[0],distanceLegLeft:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","distanceLegLeft")[0],distanceLegRight:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","distanceLegRight")[0],weldCenter:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","weldCenter")[0],prismatic:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","prismatic")[0]}}}class P extends i.Scene{constructor(){super({key:"GameScene"})}create(){this.cameras.main.setDeadzone(50,125),this.cameras.main.setBackgroundColor(5592405);const e=this.cameras.main.width/D;this.cameras.main.setZoom(G*e),this.cameras.main.scrollX-=this.cameras.main.width,this.cameras.main.scrollY-=this.cameras.main.height,this.observer&&this.observer.destroy(),this.observer=new i.Events.EventEmitter,this.b2Physics=new l(this,40,new r.b2Vec2(0,-10));const t=localStorage.getItem(B)||T.level_001;if(this.b2Physics.loadRubeScene([T.level_001,T.level_002].includes(t)?t:T.level_001),this.playerController=new w(this,this.b2Physics),this.terrain=new a(this,this.b2Physics),this.cameras.main.startFollow(this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserCameraFollow",!0)[0].GetUserData(),!1,.8,.25),this.cameras.main.followOffset.set(-187.5,0),this.scene.launch("GameUIScene",[this.observer,()=>{this.playerController.state.reset(),this.scene.restart()}]),this.backdrop=new h(this),O){const e=this.add.graphics();e.lineStyle(5,296712,1),e.beginPath(),e.moveTo(0,0),e.lineTo(40,0),e.closePath(),e.setDepth(1e3),e.strokePath(),e.lineStyle(5,12192552,1),e.beginPath(),e.moveTo(0,0),e.lineTo(0,40),e.closePath(),e.setDepth(1e3),e.strokePath()}this.observer.on("enter_crashed",(()=>this.cameras.main.shake(200,1/e*.03)))}update(){N.begin();const e=this.game.loop.delta/1e3;this.b2Physics.update(),this.playerController.update(e),this.backdrop.update(),N.end()}}var S=s(260);const v="snowboarding_game_resolution",f="snowboarding_game_volume_music",_="snowboarding_game_volume_sfx",C="snowboarding_game_user_id",L="snowboarding_game_user_name",x="snowboarding_game_user_scores_v2",B="snowboarding_game_level_current";var T;!function(e){e.level_001="level_001",e.level_002="level_002",e.level_003="level_003",e.level_004="level_004",e.level_005="level_005"}(T||(T={}));const E=100,A=5e3,k=200,R=.2,I=8,D=1280,F=720,M=Number(localStorage.getItem(v)||1),G=Number(localStorage.getItem("snowboarding_game_debug_zoom")||1),O=Boolean(localStorage.getItem("snowboarding_game_debug")),V={title:"Snowboarding Game",version:"1.0.3",type:i.AUTO,backgroundColor:"#ffffff",disableContextMenu:!0,parent:"phaser-wrapper",dom:{createContainer:!0},fps:{min:55,target:60,smoothStep:!0},scale:{mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH,width:D*M,height:F*M},scene:[o,P,b]};let N={begin:()=>null,end:()=>null};window.addEventListener("load",(()=>{if(new i.Game(V),O){const e={autoPlace:!0,targetFPS:60,redrawInterval:200,maximumHistory:200,scale:1,memoryUpdateInterval:100,memoryMaxHistory:600,FONT_FAMILY:"Arial",COLOR_FPS_BAR:"#34cfa2",COLOR_FPS_AVG:"#FFF",COLOR_TEXT_LABEL:"#FFF",COLOR_TEXT_TO_LOW:"#eee207",COLOR_TEXT_BAD:"#d34646",COLOR_TEXT_TARGET:"#d249dd",COLOR_BG:"#333333"};N=new S.Z(e),document.body.appendChild(N.dom)}}))}},s={};function i(e){var o=s[e];if(void 0!==o)return o.exports;var r=s[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,s,o,r)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,o,r]=e[c],n=!0,l=0;l<s.length;l++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(n=!1,r<a&&(a=r));if(n){e.splice(c--,1);var h=o();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[s,o,r]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.e=()=>Promise.resolve(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var o,r,[a,n,l]=s,h=0;if(a.some((t=>0!==e[t]))){for(o in n)i.o(n,o)&&(i.m[o]=n[o]);if(l)var c=l(i)}for(t&&t(s);h<a.length;h++)r=a[h],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(c)},s=self.webpackChunksnowboarding_game=self.webpackChunksnowboarding_game||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=i.O(void 0,[216],(()=>i(9209)));o=i.O(o)})();