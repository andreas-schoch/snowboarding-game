(()=>{var e,t={7153:(e,t,s)=>{var i={"./gamestats-pixi.module.js":[6913,216]};function o(e){if(!s.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],o=t[0];return s.e(t[1]).then((()=>s(o)))}o.keys=()=>Object.keys(i),o.id=7153,e.exports=o},3499:(e,t,s)=>{"use strict";s.d(t,{R$:()=>w,$7:()=>b,m6:()=>P,nI:()=>S,ot:()=>v});var i=s(2260);class o extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.audio("riverside_ride",["assets/audio/riverside_ride/riverside_ride.ogg","assets/audio/riverside_ride/riverside_ride.mp3","assets/audio/riverside_ride/riverside_ride.aac"]),this.load.audio("boink",["assets/audio/sfx/boink.wav"]),this.load.audio("pickup_present",["assets/audio/sfx/pickupgem.wav"]),this.load.json("santa","assets/santa-v01.json");const e=`${b*S}x${w*S}`;this.load.atlas("bg_space_pack",`assets/img/packed/bg_space_${e}.png`,`assets/img/packed/bg_space_${e}.json`),this.load.image("ice_spikes","assets/img/obstacles/ice_spikes.png"),this.load.image("snowy_rock","assets/img/obstacles/snowy_rock.png"),this.load.image("present_temp","assets/img/present_temp.png"),this.load.image("tree_01.png","assets/img/svgsilh/tree_01.png"),this.load.image("cottage2.png","assets/img/svgsilh/cottage2.png"),this.load.image("santa-board.png","assets/img/santa_parts_v01/santa-board.png"),this.load.atlas("atlas-santa","assets/img/packed/character-santa.png","assets/img/packed/character-santa.json"),this.load.bitmapFont("atari-classic","assets/fonts/bitmap/atari-classic.png","assets/fonts/bitmap/atari-classic.xml")}create(){this.scene.start("GameScene")}}var r=s(2511);class a{constructor(e,t){var s;this.layers=[{color:13165035,width:5},{color:6065609,width:22},{color:2243451,width:10},{color:2960428,width:5},{color:3813938,width:250}],this.pointsPool=[],this.vec2Pool=[],this.scene=e,this.b2Physics=t;for(let e=0;e<2500;e++)this.pointsPool.push({x:0,y:0});for(let e=0;e<2500;e++)this.vec2Pool.push(new r.b2Vec2(0,0));this.chunks=[this.scene.add.graphics().setDepth(10),this.scene.add.graphics().setDepth(10),this.scene.add.graphics().setDepth(10),this.scene.add.graphics().setDepth(10),this.scene.add.graphics().setDepth(10),this.scene.add.graphics().setDepth(10),this.scene.add.graphics().setDepth(10),this.scene.add.graphics().setDepth(10)],this.terrainBody=this.b2Physics.world.CreateBody();const i=this.terrainBody.GetPosition(),o=null===(s=this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserTerrain",!0)[0].GetFixtureList())||void 0===s?void 0:s.GetShape();this.drawTerrain(o.m_vertices.map((e=>({x:(e.x+i.x)*this.b2Physics.worldScale,y:-(e.y+i.y)*this.b2Physics.worldScale}))))}drawTerrain(e){const t=this.chunks.shift();if(!t)return;this.chunks.push(t),t.clear();const s=e.length-1,i=Math.max(e[0].y,e[s].y)+2*this.scene.cameras.main.height;let o=0;e.push({x:e[s].x,y:i},{x:e[0].x,y:i});for(const{color:s,width:i}of this.layers)t.translateCanvas(0,o),t.fillStyle(s),t.fillPoints(e,!0,!0),t.translateCanvas(0,0),o=.5*i;e.length-=2}}class n{constructor(e,t,s,i){this.world=e,this.debugGraphics=t,this.scene=s,this.worldSize=i}loadScene(e){this.loadedBodies=e.body?e.body.map((e=>this.loadBody(e))):[],this.loadedJoints=e.joint?e.joint.map((e=>this.loadJoint(e))):[],this.loadedImages=e.image?e.image.map((e=>this.loadImage(e))):[];const t=this.loadedBodies.every((e=>e))&&this.loadedJoints.every((e=>e))&&this.loadedImages.every((e=>e));return t?console.log("R.U.B.E. scene loaded successfully",this.loadedBodies,this.loadedJoints,this.loadedImages):console.error("R.U.B.E. scene failed to load fully",this.loadedBodies,this.loadedJoints,this.loadedImages),t}loadBody(e){const t={};t.type=Math.min(Math.max(e.type||0,0),2),t.angle=e.angle||0,t.angularVelocity=e.angularVelocity||0,t.awake=Boolean(e.awake),t.enabled=!e.hasOwnProperty("active")||e.active,t.fixedRotation=Boolean(e.fixedRotation),t.linearVelocity=this.rubeToXY(e.linearVelocity),t.linearDamping=e.linearDamping||0,t.angularDamping=e.angularDamping||0,t.position=this.rubeToXY(e.position);const s=this.world.CreateBody(t);return s.SetMassData({mass:e["massData-mass"]||1,center:this.rubeToVec2(e["massData-center"]),I:e["massData-I"]||1}),s.name=e.name||"",s.customProperties=e.customProperties||[],s.customPropertiesMap=this.customPropertiesArrayToMap(s.customProperties||[]),(e.fixture||[]).map((e=>this.loadFixture(s,e))),s}loadFixture(e,t){const s=this.getFixtureDefWithShape(t,e);s.friction=t.friction||0,s.density=t.density||0,s.restitution=t.restitution||0,s.isSensor=Boolean(t.sensor),s.filter={categoryBits:t["filter-categoryBits"],maskBits:t["filter-maskBits"]||1,groupIndex:t["filter-groupIndex"]||65535};const i=e.CreateFixture(s);return i.name=t.name||"",i.customProperties=t.customProperties||[],i.customPropertiesMap=this.customPropertiesArrayToMap(i.customProperties),i}loadJoint(e){if(e.bodyA>=this.loadedBodies.length)return console.error("Index for bodyA is invalid: "+e),null;if(e.bodyB>=this.loadedBodies.length)return console.error("Index for bodyB is invalid: "+e),null;const t=this.loadedBodies[e.bodyA],s=this.loadedBodies[e.bodyB];if(!t||!s)return console.error("bodyA or bodyB are invalid",t,s,this.loadedBodies),null;let i;switch(e.type){case"revolute":{const o=new r.b2RevoluteJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,o.enableLimit=Boolean(e.enableLimit),o.lowerAngle=e.lowerLimit||0,o.upperAngle=e.upperLimit||0,o.enableMotor=Boolean(e.enableMotor),o.maxMotorTorque=e.maxMotorTorque||0,o.motorSpeed=e.motorSpeed||0,i=this.world.CreateJoint(o);break}case"distance":{const o=new r.b2DistanceJointDef;o.length=e.length||0,o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition()),this.rubeToVec2(e.anchorB).Rotate(s.GetAngle()).Add(s.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.length=e.length||0,o.minLength=0,o.maxLength=2*o.length,r.b2LinearStiffness(o,e.frequency||0,e.dampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o),console.log("d joint",i);break}case"prismatic":{const o=new r.b2PrismaticJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition()),this.rubeToXY(e.localAxisA)),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,o.enableLimit=Boolean(e.enableLimit),o.lowerTranslation=e.lowerLimit||0,o.upperTranslation=e.upperLimit||0,o.enableMotor=Boolean(e.enableMotor),o.maxMotorForce=e.maxMotorForce||0,o.motorSpeed=e.motorSpeed||0,i=this.world.CreateJoint(o);break}case"wheel":{const o=new r.b2WheelJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorB),this.rubeToVec2(e.localAxisA)),o.collideConnected=Boolean(e.collideConnected),o.enableMotor=Boolean(e.enableMotor),o.maxMotorTorque=e.maxMotorTorque||0,o.motorSpeed=e.motorSpeed||0,r.b2LinearStiffness(o,e.springFrequency||0,e.springDampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}case"friction":{const o=new r.b2FrictionJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.maxForce=e.maxForce||0,o.maxTorque=e.maxTorque||0,i=this.world.CreateJoint(o);break}case"weld":{const o=new r.b2WeldJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,r.b2AngularStiffness(o,e.frequency||0,e.dampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}default:throw new Error("Unsupported joint type: "+e.type)}return i.name=e.name,i.customProperties=e.customProperties||[],i.customPropertiesMap=this.customPropertiesArrayToMap(i.customProperties),i}loadImage(e){const{file:t,body:s,center:i,customProperties:o,angle:r,aspectScale:a,scale:n,flip:h,renderOrder:l}=e,c=this.loadedBodies[s],d=c?c.GetPosition().Add(this.rubeToXY(i)):this.rubeToXY(i);if(!d)return null;const p=this.getCustomProperty(e,"string","phaserTexture",""),u=(t||"").split("/").reverse()[0],m=this.getCustomProperty(e,"string","phaserTextureFrame",void 0);console.log("------------- texture",p,m);const g=this.scene.add.image(d.x*this.worldSize,d.y*-this.worldSize,p||u,m);return g.rotation=c?-c.GetAngle()-(r||0):-(r||0),g.scaleY=this.worldSize/g.height*n,g.scaleX=g.scaleY*a,g.flipX=h,g.setDepth(l),g.custom_origin_angle=-(r||0),g.customProperties=o||[],g.customPropertiesMap=this.customPropertiesArrayToMap(g.customProperties),c&&c.SetUserData(g),g}rubeToXY(e,t={x:0,y:0}){return this.isXY(e)?{x:e.x+t.x,y:e.y+t.y}:t}rubeToVec2(e){return this.isXY(e)?new r.b2Vec2(e.x,e.y):new r.b2Vec2(0,0)}getBodiesByName(e){const t=[];for(let s=this.world.GetBodyList();s;s=s.GetNext())s&&s.name===e&&t.push(s);return t}getBodiesByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetBodyList();o;o=o.GetNext())if(o&&o.customProperties)for(let r=0;r<o.customProperties.length;r++)o.customProperties[r].hasOwnProperty("name")&&o.customProperties[r].hasOwnProperty(e)&&o.customProperties[r].name==t&&o.customProperties[r][e]==s&&i.push(o);return i}getFixturesByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetBodyList();o;o=o.GetNext())for(let r=o.GetFixtureList();r;r=r.GetNext())if(r&&r.customProperties)for(let o=0;o<r.customProperties.length;o++)r.customProperties[o].hasOwnProperty("name")&&r.customProperties[o].hasOwnProperty(e)&&r.customProperties[o].name==t&&r.customProperties[o][e]==s&&i.push(r);return i}getJointsByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetJointList();o;o=o.GetNext())if(o&&o.customProperties)for(let r=0;r<o.customProperties.length;r++)o.customProperties[r].hasOwnProperty("name")&&o.customProperties[r].hasOwnProperty(e)&&o.customProperties[r].name==t&&o.customProperties[r][e]==s&&i.push(o);return i}getCustomProperty(e,t,s,i){if(!e.customProperties)return i;for(const i of e.customProperties)if(i.name&&i.hasOwnProperty(t)&&i.name===s)return i[t];return i}customPropertiesArrayToMap(e){return e.reduce(((e,t)=>{if(t.hasOwnProperty("int"))e[t.name]=t.int;else if(t.hasOwnProperty("float"))e[t.name]=t.float;else if(t.hasOwnProperty("string"))e[t.name]=t.string;else if(t.hasOwnProperty("color"))e[t.name]=t.color;else if(t.hasOwnProperty("bool"))e[t.name]=t.bool;else{if(!t.hasOwnProperty("vec2"))throw new Error("invalid or missing custom property type");e[t.name]=this.rubeToXY(t.vec2)}return e}),{})}getFixtureDefWithShape(e,t){if(e.hasOwnProperty("circle")&&e.circle){const s=new r.b2CircleShape;return s.Set(this.rubeToXY(e.circle.center),e.circle.radius),t.GetPosition().Clone().Add(s.m_p).Scale(this.worldSize),{shape:s}}if(e.hasOwnProperty("polygon")&&e.polygon){const s=this.pointsFromSeparatedVertices(e.polygon.vertices).reverse(),i=t.GetPosition();return s.map((e=>i.Clone().Add(new r.b2Vec2(e.x,e.y).Rotate(t.GetAngle())).Scale(this.worldSize))).map((({x:e,y:t})=>({x:e,y:-t}))),{shape:(new r.b2PolygonShape).Set(s,s.length)}}if(e.hasOwnProperty("chain")&&e.chain){const s=this.pointsFromSeparatedVertices(e.chain.vertices).reverse(),i=t.GetPosition();return s.map((e=>i.Clone().Add(new r.b2Vec2(e.x,e.y).Rotate(t.GetAngle())).Scale(this.worldSize))).map((({x:e,y:t})=>({x:e,y:-t}))),{shape:e.chain.hasNextVertex&&e.chain.hasPrevVertex&&e.chain.nextVertex&&e.chain.prevVertex?(new r.b2ChainShape).CreateLoop(s,s.length):(new r.b2ChainShape).CreateChain(s,s.length,this.rubeToXY(e.chain.prevVertex),this.rubeToXY(e.chain.nextVertex))}}throw Error("Could not find shape type for fixture")}pointsFromSeparatedVertices(e){const t=[];for(let s=0;s<e.x.length;s++)t.push(new r.b2Vec2(e.x[s],e.y[s]));return t}isXY(e){return Boolean(e&&"object"==typeof e&&e.hasOwnProperty("x")&&e.hasOwnProperty("y"))}}class h extends Phaser.Events.EventEmitter{constructor(e,t,s){super(),this.textureKeys=new Set,this.ZERO=new r.b2Vec2(0,0),this.bulletTime={rate:1},this.debugDraw=e.add.graphics(),this.scene=e,this.worldScale=t,this.world=r.b2World.Create(s),this.world.SetContactListener({BeginContact:e=>this.emit("begin-contact",e),EndContact:()=>null,PreSolve:()=>null,PostSolve:(e,t)=>this.emit("post-solve",e,t)}),this.world.SetAllowSleeping(!1),this.world.SetWarmStarting(!0),this.userDataGraphics=e.add.graphics();const i=this.scene.cache.json.get("santa");if(this.rubeLoader=new n(this.world,this.scene.add.graphics(),this.scene,this.worldScale),!this.rubeLoader.loadScene(i))throw new Error("Failed to load RUBE scene");console.log("RUBE scene loaded successfully."),this.update()}update(){v.begin("physics"),this.world.Step(1/60,{positionIterations:12,velocityIterations:12}),this.world.ClearForces();const e=this.worldScale;for(let t=this.world.GetBodyList();t;t=t.GetNext()){if(!t)continue;let s=t.GetUserData();if(s&&s)if(t.IsEnabled()){let{x:i,y:o}=t.GetPosition();!s.visible&&s.setVisible(!0),s.x=i*e,s.y=o*-e,s.rotation=-t.GetAngle()+(s.custom_origin_angle||0)}else s.setVisible(!1)}v.end("physics")}enterBulletTime(e,t){this.bulletTime.rate=t,this.scene.tweens.add({delay:e,targets:[this.bulletTime],rate:.9,duration:500})}}class l extends i.Scene{constructor(){super({key:"UiScene"})}init([e,t]){this.observer=e,this.restartGame=t}create(){console.log("--------------ui scene create"),this.cameras.main.setRoundPixels(!0);const e=this.game.canvas.width/b,t=20*e,s=18*e,i=24*e,o=4*e;this.music=this.sound.add("riverside_ride",{loop:!0,volume:.2,rate:.95,delay:1,detune:0}),this.music.play(),this.sfx_jump_start=this.sound.add("boink",{detune:-200}),this.sfx_pickup_present=this.sound.add("pickup_present",{detune:100,rate:1.1});const r=this.cameras.main.worldView.x+this.cameras.main.width/2,a=this.cameras.main.worldView.y+this.cameras.main.height/2;this.playAgainButton=this.add.bitmapText(r,1.5*a,"atari-classic","PLAY AGAIN?").setScrollFactor(0).setFontSize(i).setOrigin(.5).setDropShadow(1,2,2236962).setAlpha(0).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.playAgain())).on("pointerover",(()=>this.playAgainButton.setCharacterTint(0,-1,!0,10,10,10,10))).on("pointerout",(()=>this.playAgainButton.setCharacterTint(0,-1,!1,-10,-10,-10,-10))),this.add.bitmapText(4,4,"atari-classic","DISTANCE").setScrollFactor(0,0).setFontSize(t),this.textDistance=this.add.bitmapText(1.5*o,t+2*o,"atari-classic","Distance: 0m").setScrollFactor(0,0).setFontSize(s),this.add.bitmapText(r,o,"atari-classic","COMBO").setScrollFactor(0,0).setOrigin(.5,0).setFontSize(t),this.textCombo=this.add.bitmapText(r,t+2*o,"atari-classic","-").setScrollFactor(0,0).setFontSize(s).setOrigin(.5,0),this.add.bitmapText(2*r-o,o,"atari-classic","SCORE").setScrollFactor(0,0).setOrigin(1,0).setFontSize(t),this.textScore=this.add.bitmapText(2*r-o,t+2*o,"atari-classic","0").setScrollFactor(0,0).setFontSize(s).setOrigin(1,0),this.observer.on("jump_start",(()=>this.sfx_jump_start.play({delay:.1}))),this.observer.on("pickup_present",(()=>this.sfx_pickup_present.play())),this.observer.on("combo-change",((e,t)=>this.textCombo.setText(e?e+"x"+t:"-"))),this.observer.on("score-change",(e=>this.textScore.setText(e))),this.observer.on("distance-change",(e=>this.textDistance.setText(String(e)+"m"))),this.comboLeewayChart=this.add.graphics(),this.observer.on("combo-leeway-update",(t=>{this.comboLeewayChart.clear().fillStyle(16777215).slice(r,72*e,12*e,t,1.5*Math.PI).fillPath()})),this.observer.on("enter-crashed",(()=>{this.playAgainButton.setAlpha(1),this.tweens.add({targets:this.music,volume:0,detune:-500,rate:.5,duration:3e3,onComplete:e=>this.music.stop()})}))}update(){}playAgain(){this.music.stop(),this.restartGame()}}class c{constructor(e){this.scene=e,this.bgSpaceBack=this.registerLayer("bg_space_back.png"),this.bgSpaceMid=this.registerLayer("bg_space_mid.png"),this.bgSpaceFront=this.registerLayer("bg_space_front.png")}update(){v.begin("backdrop");const{scrollX:e,scrollY:t}=this.scene.cameras.main;this.bgSpaceBack.setTilePosition(.005*e,.005*t),this.bgSpaceMid.setTilePosition(.01*e,.01*t),this.bgSpaceFront.setTilePosition(.025*e,.025*t),v.end("backdrop")}registerLayer(e,t=1,s=1){const{width:i,height:o,zoomX:r,zoomY:a,worldView:n}=this.scene.cameras.main;return this.scene.add.tileSprite(n.x+i/2,n.y+o/2,i,o,"bg_space_pack",e).setOrigin(.5,.5).setScrollFactor(0,0).setScale(t*(1/r),s*(1/a)).setDepth(-200)}}class d{constructor(e){this.segments=[],this.pointStart=new r.b2Vec2(0,0),this.pointEnd=new r.b2Vec2(0,0),this.player=e,this.scene=e.scene,this.b2Physics=e.b2Physics,this.debugGraphics=this.scene.add.graphics(),this.initRays(this.b2Physics.worldScale/4)}update(e){this.player.debug&&this.debugGraphics.clear();const t=this.segments;for(const e of this.segments)this.resetSegment(e),e.body.GetWorldPoint(r.b2Vec2.ZERO,this.pointStart),e.body.GetWorldPoint(e.groundRayDirection,this.pointEnd),this.b2Physics.world.RayCast(this.pointStart,this.pointEnd,e.groundRayCallback),this.player.debug&&this.drawDebug(e.groundRayResult.hit?255:65280),e.crashRayResult&&e.crashRayCallback&&e.crashRayDirection&&(e.body.GetWorldPoint(r.b2Vec2.ZERO,this.pointStart),e.body.GetWorldPoint(e.crashRayDirection,this.pointEnd),this.b2Physics.world.RayCast(this.pointStart,this.pointEnd,e.crashRayCallback),this.player.debug&&this.drawDebug(e.crashRayResult.hit?255:65280));this.isTailGrounded=t[0].groundRayResult.hit,this.isNoseGrounded=t[t.length-1].groundRayResult.hit,this.isCenterGrounded=t[2].groundRayResult.hit||t[3].groundRayResult.hit||t[4].groundRayResult.hit}getTimeInAir(){if(this.segments.some((e=>e.groundRayResult.hit)))return-1;const e=Math.max(...this.segments.map((e=>e.groundRayResult.lastHitTime)));return this.scene.game.getTime()-e}isInAir(){return-1!==this.getTimeInAir()}rayCallbackFactory(e){return(t,s,i,o)=>(this.b2Physics.rubeLoader.getCustomProperty(t,"bool","phaserCrashSensorIgnore",!1),e.hit=!0,e.point=s,e.normal=i,e.fraction=o,e.lastHitTime=this.scene.game.getTime(),o)}resetSegment(e){e.groundRayResult.hit=!1,e.groundRayResult.point=null,e.groundRayResult.normal=null,e.groundRayResult.fraction=-1,e.crashRayResult&&(e.crashRayResult.hit=!1,e.crashRayResult.point=null,e.crashRayResult.normal=null,e.crashRayResult.fraction=-1)}drawDebug(e){this.debugGraphics.lineStyle(2,e,1);const t=this.b2Physics.worldScale;this.debugGraphics.lineBetween(this.pointStart.x*t,-this.pointStart.y*t,this.pointEnd.x*t,-this.pointEnd.y*t)}initRays(e){const t={hit:!1,point:null,normal:null,fraction:-1,lastHitTime:-1};for(const s of this.player.parts.boardSegments){const i=this.b2Physics.rubeLoader.getCustomProperty(s,"int","phaserBoardSegmentIndex",-1)===this.player.parts.boardSegments.length-1,o=Object.assign({},t),a=Object.assign({},t);this.segments.push({body:s,groundRayDirection:new r.b2Vec2(0,-e/this.b2Physics.worldScale),groundRayResult:o,groundRayCallback:this.rayCallbackFactory(o),crashRayDirection:i?new r.b2Vec2((i?2*e:e)/this.b2Physics.worldScale,0):void 0,crashRayResult:i?a:void 0,crashRayCallback:i?this.rayCallbackFactory(a):void 0}),i&&(this.nose=this.segments[this.segments.length-1])}}}class p{constructor(e){this.BASE_BOOST_FLOW=1350,this.BASE_TRICK_POINTS=200,this.maxBoost=25*this.BASE_BOOST_FLOW,this.availableBoost=this.maxBoost,this.landedFrontFlips=0,this.landedBackFlips=0,this.timeGrounded=0,this.totalTrickScore=0,this.protoTrickScore=0,this.comboAccumulatedScore=0,this.anglePreviousUpdate=0,this.totalRotation=0,this.currentFlipRotation=0,this.pendingFrontFlips=0,this.pendingBackFlips=0,this.pickupsToProcess=new Set,this.comboMultiplier=0,this.alreadyCollectedCoins=new Set,this.playerController=e,this.parts=e.parts,this.b2Physics=e.b2Physics,this.state=e.board.isInAir()?"in-air":"grounded",this.registerCollisionListeners(),this.playerController.scene.observer.on("enter-in-air",(()=>this.state="in-air")),this.playerController.scene.observer.on("enter-grounded",(()=>{this.state="grounded",this.timeGrounded=this.playerController.scene.game.getTime(),this.landedFrontFlips+=this.pendingFrontFlips,this.landedBackFlips+=this.pendingBackFlips;const e=this.pendingBackFlips+this.pendingFrontFlips;if(e>=1){const t=e*e*this.BASE_TRICK_POINTS;this.totalTrickScore+=t,this.comboAccumulatedScore+=.1*t,this.comboMultiplier++,this.playerController.scene.observer.emit("combo-change",this.comboAccumulatedScore,this.comboMultiplier),this.playerController.scene.observer.emit("score-change",this.totalTrickScore),this.playerController.scene.observer.emit("boost-change",this.availableBoost,this.maxBoost),this.comboLeewayTween.resetTweenData(!0),this.comboLeewayTween.play()}this.totalRotation=0,this.currentFlipRotation=0,this.pendingBackFlips=0,this.pendingFrontFlips=0})),this.playerController.scene.observer.on("enter-crashed",(()=>{this.state="crashed",(this.comboLeewayTween.isPlaying()||this.comboLeewayTween.isPaused())&&this.comboLeewayTween.stop()})),this.comboLeewayTween=this.playerController.scene.tweens.addCounter({paused:!0,from:-.5*Math.PI,to:1.5*Math.PI,duration:1e3,onUpdate:e=>this.playerController.scene.observer.emit("combo-leeway-update",e.getValue()),onComplete:e=>{this.totalTrickScore+=this.comboAccumulatedScore*this.comboMultiplier,this.playerController.scene.observer.emit("score-change",this.totalTrickScore),this.playerController.scene.observer.emit("combo-change",0,0),this.protoTrickScore=0,this.comboAccumulatedScore=0,this.comboMultiplier=0}})}getState(){return this.state}getTravelDistanceMeters(){const e=this.parts.body.GetPosition().Length();return 50*Math.floor(e/50)}gainBoost(e,t){const s=Math.min(this.maxBoost,this.BASE_BOOST_FLOW*t*e+this.availableBoost);return this.availableBoost=s,this.playerController.scene.observer.emit("boost-change",this.availableBoost,this.maxBoost),s}consumeBoost(e,t){if(this.availableBoost<=0)return 0;const s=Math.min(this.availableBoost,this.BASE_BOOST_FLOW*t*e);return this.availableBoost-=s*(t>1?1.5:1),this.playerController.scene.observer.emit("boost-change",this.availableBoost,this.maxBoost),s}registerCollisionListeners(){this.playerController.b2Physics.on("post-solve",((e,t)=>{if(this.isCrashed)return;const s=e.GetFixtureA().GetBody(),i=e.GetFixtureB().GetBody();s!==i&&(this.isCrashed=(s===this.parts.head||i===this.parts.head)&&Math.max(...t.normalImpulses)>8)})),this.playerController.b2Physics.on("begin-contact",(e=>{var t,s;const i=e.GetFixtureA(),o=e.GetFixtureB(),r=i.GetBody(),a=o.GetBody();i.IsSensor()&&!this.pickupsToProcess.has(r)&&"pickup_present"===(null===(t=i.customPropertiesMap)||void 0===t?void 0:t.phaserSensorType)?(console.log("-------------pickup A",i.name),this.pickupsToProcess.add(r)):o.IsSensor()&&!this.pickupsToProcess.has(a)&&"pickup_present"===(null===(s=o.customPropertiesMap)||void 0===s?void 0:s.phaserSensorType)&&(this.pickupsToProcess.add(a),console.log("-------------pickup B",o.name))}))}update(e){this.pickupsToProcess.size&&console.log("pickups",this.pickupsToProcess.size);for(const e of this.pickupsToProcess){const t=e.GetUserData();this.b2Physics.world.DestroyBody(e),t.destroy(),this.playerController.scene.observer.emit("pickup_present")}this.pickupsToProcess.clear();const t=this.playerController.board.isInAir();"crashed"!==this.state&&this.isCrashed&&this.playerController.scene.observer.emit("enter-crashed"),"grounded"===this.state&&t&&!this.isCrashed?this.playerController.scene.observer.emit("enter-in-air"):"in-air"!==this.state||t||this.isCrashed||this.playerController.scene.observer.emit("enter-grounded"),this.updateTrickCounter(),this.updateComboLeeway(),this.updateDistance()}updateTrickCounter(){if("in-air"===this.state){const e=i.Math.Angle.Normalize(this.parts.body.GetAngle()),t=this.calculateDifferenceBetweenAngles(this.anglePreviousUpdate,e);this.totalRotation+=t,this.currentFlipRotation+=t,this.anglePreviousUpdate=e,this.currentFlipRotation>=Math.PI*(0===this.pendingFrontFlips?1.25:2)?(this.pendingFrontFlips++,this.currentFlipRotation=0):this.currentFlipRotation<=Math.PI*-(0===this.pendingBackFlips?1.25:2)&&(this.pendingBackFlips++,this.currentFlipRotation=0)}}updateComboLeeway(){(this.comboLeewayTween.isPlaying()||this.comboLeewayTween.isPaused())&&("in-air"!==this.state&&this.playerController.board.isCenterGrounded?this.comboLeewayTween.resume():this.comboLeewayTween.pause())}calculateDifferenceBetweenAngles(e,t){let s=t-e;return s<-Math.PI?s+=2*Math.PI:s>Math.PI&&(s-=2*Math.PI),s}updateDistance(){const e=this.getTravelDistanceMeters();e!==this.lastDistance&&(this.playerController.scene.observer.emit("distance-change",e),this.lastDistance=e)}}class u{constructor(e,t){this.scene=e,this.b2Physics=t,this.scene.input.on("pointerdown",(e=>this.MouseDown({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale}))),this.scene.input.on("pointerup",(e=>this.MouseUp({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale}))),this.scene.input.on("pointermove",(e=>this.MouseMove({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale},!0)))}MouseMove(e,t){t&&this.mouseJoint&&this.mouseJoint.SetTarget(e)}MouseUp(e){this.mouseJoint&&(this.b2Physics.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null)}MouseDown(e){let t;if(this.mouseJoint&&(this.b2Physics.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null),this.b2Physics.world.QueryPointAABB(e,(s=>s.GetBody().GetType()!==r.b2BodyType.b2_dynamicBody||!s.TestPoint(e)||(t=s,!1))),t){const s=5,i=.5,o=t.GetBody(),a=new r.b2MouseJointDef;a.collideConnected=!0,a.damping=.1,a.bodyA=this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserTerrain",!0)[0],a.bodyB=o,a.target.Copy(e),a.maxForce=600*o.GetMass(),r.b2LinearStiffness(a,s,i,a.bodyA,a.bodyB),this.mouseJoint=this.b2Physics.world.CreateJoint(a),o.SetAwake(!0)}}}class m{constructor(e,t){this.jumpForce=39e3,this.leanForce=150,this.jumpVector=new r.b2Vec2(0,0),this.debug=!1,this.scene=e,this.b2Physics=t,this.cursors=this.scene.input.keyboard.createCursorKeys(),this.cursors.up.on("down",(()=>{console.log("up down"),"grounded"===this.state.getState()&&this.scene.game.getTime()-this.cursors.up.timeDown<=250&&this.scene.observer.emit("jump_start")})),this.initBodyParts(),this.board=new d(this),this.state=new p(this),this.debug&&new u(e,t)}update(e){v.begin("snowman"),this.state.update(e),this.state.isCrashed&&this.detachBoard(),this.board.getTimeInAir()>100&&this.resetLegs(),this.state.isCrashed||(this.board.update(e),this.cursors.up.isDown&&this.scene.game.getTime()-this.cursors.up.timeDown<=250&&this.jump(e),this.cursors.left.isDown&&this.leanBackward(e),this.cursors.right.isDown&&this.leanForward(e),this.cursors.down.isDown&&this.leanCenter(e)),v.end("snowman")}detachBoard(){this.parts.bindingLeft&&this.b2Physics.world.DestroyJoint(this.parts.bindingLeft),this.parts.bindingRight&&this.b2Physics.world.DestroyJoint(this.parts.bindingRight),this.parts.distanceLegLeft&&this.b2Physics.world.DestroyJoint(this.parts.distanceLegLeft),this.parts.distanceLegRight&&this.b2Physics.world.DestroyJoint(this.parts.distanceLegRight),this.parts.weldCenter&&this.b2Physics.world.DestroyJoint(this.parts.weldCenter)}jump(e){var t,s;if(this.scene.game.getTime()-this.state.timeGrounded<100)return;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.8),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.8);const{isTailGrounded:i,isCenterGrounded:o,isNoseGrounded:r}=this.board;if(o||i||r){const t=this.jumpForce*e,s=this.jumpVector.Set(0,0);o?this.parts.body.GetWorldVector({x:0,y:.3*t},s).Add({x:0,y:1.25*t}):this.parts.body.GetWorldVector({x:0,y:.5*t},s).Add({x:0,y:.85*t}),this.parts.body.ApplyForceToCenter(s,!0)}}resetLegs(){var e,t;null===(e=this.parts.distanceLegLeft)||void 0===e||e.SetLength(.65),null===(t=this.parts.distanceLegRight)||void 0===t||t.SetLength(.65)}leanBackward(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.55),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.8),this.parts.weldCenter.m_referenceAngle=Math.PI/180*-10,this.parts.body.ApplyAngularImpulse(this.leanForce*e)}leanForward(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.8),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.55),this.parts.weldCenter.m_referenceAngle=Math.PI/180*10,this.parts.body.ApplyAngularImpulse(-this.leanForce*e)}leanCenter(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.55),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.55),this.parts.weldCenter.m_referenceAngle=0}initBodyParts(){this.parts={head:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","head")[0],body:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","body")[0],boardSegments:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","boardSegment"),boardEdges:this.b2Physics.rubeLoader.getFixturesByCustomProperty("bool","phaserBoardEdge",!0),bindingLeft:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","bindingLeft")[0],bindingRight:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","bindingRight")[0],distanceLegLeft:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","distanceLegLeft")[0],distanceLegRight:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","distanceLegRight")[0],weldCenter:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","weldCenter")[0]},console.log("initBodyParts",this.parts)}}class g extends i.Scene{constructor(){super({key:"GameScene"}),this.observer=new i.Events.EventEmitter}create(){this.cameras.main.setDeadzone(50,125),this.cameras.main.setBackgroundColor(5592405);const e=this.cameras.main.width/b;this.cameras.main.setZoom(P*e),this.cameras.main.scrollX-=this.cameras.main.width/2,this.cameras.main.scrollY-=this.cameras.main.height/2,this.b2Physics=new h(this,40,new r.b2Vec2(0,-10)),this.playerController=new m(this,this.b2Physics),this.terrain=new a(this,this.b2Physics),this.cameras.main.startFollow(this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserCameraFollow",!0)[0].GetUserData(),!1,.8,.25),this.cameras.main.followOffset.set(-375,0),this.scene.launch(l.name,[this.observer,()=>this.scene.restart()]),this.backdrop=new c(this);const{width:t,height:s}=this.game.scale,i=this.add.graphics();i.lineStyle(5,296712,1),i.beginPath(),i.moveTo(0,0),i.lineTo(40,0),i.closePath(),i.setDepth(1e3),i.strokePath(),i.lineStyle(5,12192552,1),i.beginPath(),i.moveTo(0,0),i.lineTo(0,40),i.closePath(),i.setDepth(1e3),i.strokePath(),this.observer.on("enter-crashed",(()=>{this.cameras.main.shake(200,.01),this.b2Physics.enterBulletTime(-1,.4)}))}update(){v.begin();const e=this.game.loop.delta/1e3;this.b2Physics.update(),this.playerController.update(e),this.backdrop.update(),v.end()}}var y=s(260);const b=1280,w=720,P=1,S=1,f={title:"Snowboarding Game",version:"1.0.0",type:i.WEBGL,backgroundColor:"#ffffff",disableContextMenu:!0,fps:{min:50,target:60,smoothStep:!0},scale:{parent:"phaser-wrapper",mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH,width:b*S,height:w*S},scene:[o,g,l]},C={autoPlace:!0,targetFPS:60,redrawInterval:200,maximumHistory:200,scale:1,memoryUpdateInterval:100,memoryMaxHistory:600,FONT_FAMILY:"Arial",COLOR_FPS_BAR:"#34cfa2",COLOR_FPS_AVG:"#FFF",COLOR_TEXT_LABEL:"#FFF",COLOR_TEXT_TO_LOW:"#eee207",COLOR_TEXT_BAD:"#d34646",COLOR_TEXT_TARGET:"#d249dd",COLOR_BG:"#333333"};let v;window.addEventListener("load",(()=>{new i.Game(f),v=new y.Z(C),document.body.appendChild(v.dom)}))}},s={};function i(e){var o=s[e];if(void 0!==o)return o.exports;var r=s[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,s,o,r)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,o,r]=e[c],n=!0,h=0;h<s.length;h++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](s[h])))?s.splice(h--,1):(n=!1,r<a&&(a=r));if(n){e.splice(c--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[s,o,r]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.e=()=>Promise.resolve(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var o,r,[a,n,h]=s,l=0;if(a.some((t=>0!==e[t]))){for(o in n)i.o(n,o)&&(i.m[o]=n[o]);if(h)var c=h(i)}for(t&&t(s);l<a.length;l++)r=a[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(c)},s=self.webpackChunksnowboarding_game=self.webpackChunksnowboarding_game||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=i.O(void 0,[216],(()=>i(3499)));o=i.O(o)})();