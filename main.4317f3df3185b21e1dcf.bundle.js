(()=>{var e,t={7153:(e,t,s)=>{var i={"./gamestats-pixi.module.js":[6913,216]};function a(e){if(!s.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],a=t[0];return s.e(t[1]).then((()=>s(a)))}a.keys=()=>Object.keys(i),a.id=7153,e.exports=a},9826:(e,t,s)=>{"use strict";s.d(t,{R$:()=>f,$7:()=>w,ot:()=>B});var i=s(2260);class a extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.audio("theme",["assets/audio/theme/theme.ogg","assets/audio/theme/theme.mp3","assets/audio/theme/theme.aac"]);const e=this.game.canvas.height===f?"960x540":"480x270";this.load.atlas("atlas-backdrop",`assets/img/atlas/packed-${e}.png`,`assets/img/atlas/packed-${e}.json`),this.load.atlas("atlas-foliage","assets/img/atlas/foliage.png","assets/img/atlas/foliage.json"),this.load.bitmapFont("atari-classic","assets/fonts/bitmap/atari-classic.png","assets/fonts/bitmap/atari-classic.xml")}create(){this.scene.start("GameScene")}}var n=s(2511);class o{constructor(e,t,s=600,i=200){this.pos=new n.b2Vec2(0,0),this.enabled=!1,this.segments=[{x:0,y:0,w:64,h:0,tw:77,th:45,weldConfig:{dampingRatio:5,frequencyHz:50,referenceAngle:-.15},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-01.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_staticBody,friction:.7,depth:4,density:.5},anchorRight:{x:64,y:-4},points:[{x:3,y:44},{x:40,y:32},{x:69,y:30},{x:75.5,y:22},{x:76,y:13.5},{x:71,y:6},{x:59,y:3},{x:20,y:1},{x:10,y:2},{x:4,y:5},{x:1,y:11}]},{x:64,y:-4,w:64,h:0,tw:88,th:29,weldConfig:{dampingRatio:5,frequencyHz:50,referenceAngle:-.15},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-02.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_dynamicBody,friction:.7,depth:4,density:.5},anchorRight:{x:128,y:0},points:[{x:10,y:27.5},{x:76,y:28.5},{x:86,y:25},{x:88,y:17},{x:85,y:11},{x:81.5,y:8},{x:15,y:2},{x:5,y:2.5},{x:-.5,y:12},{x:2.5,y:23}]},{x:128,y:0,w:64,h:0,tw:84,th:22,weldConfig:{dampingRatio:5,frequencyHz:40,referenceAngle:0},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-03.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_dynamicBody,friction:.7,depth:4,density:.5},anchorRight:{x:192,y:0},points:[{x:9,y:21},{x:75,y:20},{x:81,y:17},{x:84,y:10},{x:81,y:3},{x:74,y:0},{x:9,y:0},{x:3,y:2},{x:-.5,y:9},{x:2,y:17.5}]},{x:192,y:0,w:64,h:0,tw:83,th:21,weldConfig:{dampingRatio:5,frequencyHz:40,referenceAngle:0},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-04.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_dynamicBody,friction:.7,depth:4,density:.5},anchorRight:{x:256,y:0},points:[{x:7,y:20},{x:74,y:20},{x:80,y:18},{x:83,y:11},{x:80,y:3.5},{x:74,y:2},{x:9,y:1},{x:3,y:3},{x:0,y:9},{x:1,y:17}]},{x:256,y:0,w:64,h:0,tw:80,th:21,weldConfig:{dampingRatio:5,frequencyHz:40,referenceAngle:.2*(Math.random()-.5)},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-05.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_dynamicBody,friction:.7,depth:4,density:.5},anchorRight:{x:320,y:-1},points:[{x:7,y:20},{x:71,y:18},{x:77,y:16},{x:80,y:10},{x:78,y:4},{x:74,y:2},{x:7,y:1},{x:2,y:3},{x:0,y:10},{x:2,y:17}]},{x:320,y:-1,w:64,h:0,tw:79,th:18,weldConfig:{dampingRatio:5,frequencyHz:35,referenceAngle:.2*(Math.random()-.5)},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-06.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_dynamicBody,friction:.7,depth:4,density:.5},anchorRight:{x:384,y:0},points:[{x:5,y:17.5},{x:73,y:17},{x:77,y:14},{x:79,y:10},{x:77,y:5},{x:72,y:3},{x:9,y:1},{x:4,y:2},{x:0,y:7},{x:1,y:14}]},{x:384,y:0,w:64,h:0,tw:75,th:16,weldConfig:{dampingRatio:5,frequencyHz:35,referenceAngle:.3*(Math.random()-.5)},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-07.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_dynamicBody,friction:.7,depth:4,density:.5},anchorRight:{x:448,y:0},points:[{x:6,y:15.5},{x:72,y:15},{x:75,y:12},{x:74,y:8},{x:71,y:6},{x:8,y:1},{x:2,y:2},{x:0,y:7},{x:1,y:12.5}]},{x:448,y:3,w:64,h:0,tw:60,th:10,weldConfig:{dampingRatio:.9,frequencyHz:15,referenceAngle:0},bodyConfig:{texture:"atlas-foliage",textureKey:"tree-segment-08.png",linearDamping:.5,angularDamping:.5,color:5592405,type:n.b2BodyType.b2_dynamicBody,friction:.7,depth:4,density:.5},points:[{x:3,y:9.5},{x:58,y:9},{x:59,y:6},{x:4,y:0},{x:0,y:1.5},{x:-.5,y:7}]}],this.scene=e,this.b2Physics=t,this.pos.Set(s,i),this.generateSegments()}setEnabled(e){return this.enabled=e,this.segments.forEach((t=>t.body&&t.body.SetEnabled(e))),this}moveTo(e,t){return this.pos.Set(e,t),this.segments.forEach((e=>e.body&&e.body.SetTransformXY((e.x+this.pos.x)/this.b2Physics.worldScale,(e.y+this.pos.y)/this.b2Physics.worldScale,0))),this}cleanup(e){this.enabled&&this.pos.x<e&&this.setEnabled(!1)}generateSegments(){let e=!0;for(const t of this.segments){const s=t.points.map((e=>({x:(e.x-t.tw/2)/this.b2Physics.worldScale,y:(e.y-t.th/2)/this.b2Physics.worldScale})));t.body=this.b2Physics.createChain(t.x+this.pos.x,t.y+this.pos.y,{points:s.reverse(),texture:t.bodyConfig.texture,textureKey:t.bodyConfig.textureKey,type:"physics-tree",depth:4,angle:0,isDynamic:!e})[0],e=!1}for(let e=0;e<this.segments.length-1;e++){const[t,s]=this.segments.slice(e,e+2);if(!(t.anchorRight&&t.weldConfig&&t.body&&s.body))continue;const i=new n.b2Vec2((t.anchorRight.x+this.pos.x-32)/this.b2Physics.worldScale,(t.anchorRight.y+this.pos.y)/this.b2Physics.worldScale),{dampingRatio:a,frequencyHz:o,referenceAngle:r}=t.weldConfig,h=new n.b2WeldJointDef;h.Initialize(t.body,s.body,i),h.referenceAngle=r,n.b2AngularStiffness(h,o,a,h.bodyA,h.bodyB),this.b2Physics.world.CreateJoint(h)}}}const r=[{x:2,y:82},{x:7,y:14},{x:20,y:6},{x:41,y:2},{x:89,y:11},{x:137,y:52},{x:147,y:82}],h={startTerrainHeight:.5,slopeAmplitude:200,slopeLengthRange:[7,14],gridDensity:64,layers:[{color:13165035,width:5},{color:6065609,width:22},{color:2243451,width:10},{color:2960428,width:5},{color:3813938,width:250}]};class c{constructor(e,t,s=h){this.yOffset=0,this.lastRockSpawnX=0,this.scene=e,this.b2Physics=t,this.config=s;const i=Math.floor(s.slopeLengthRange[1]*this.config.gridDensity*1.5);this.pointsPool=[];for(let e=0;e<i;e++)this.pointsPool.push({x:0,y:0});this.vec2Pool=[];for(let e=0;e<i;e++)this.vec2Pool.push(new n.b2Vec2(0,0));this.chunks=[this.scene.add.graphics().setDepth(2),this.scene.add.graphics().setDepth(2),this.scene.add.graphics().setDepth(2),this.scene.add.graphics().setDepth(2),this.scene.add.graphics().setDepth(2),this.scene.add.graphics().setDepth(2),this.scene.add.graphics().setDepth(2),this.scene.add.graphics().setDepth(2)];const a={points:r.map((e=>({x:(e.x-75)/this.b2Physics.worldScale,y:(e.y-75)/this.b2Physics.worldScale}))),type:"boulder",texture:"atlas-foliage",textureKey:"boulder-01.png",disabled:!0,body:this.terrainBody,depth:5};this.poolBoulderBodies=[this.b2Physics.createChain(1300,305,a),this.b2Physics.createChain(1300,305,a),this.b2Physics.createChain(1300,305,a),this.b2Physics.createChain(1300,305,a),this.b2Physics.createChain(1300,305,a),this.b2Physics.createChain(1300,305,a),this.b2Physics.createChain(1300,305,a),this.b2Physics.createChain(1300,305,a)];const c=22,l={color:16766720,type:n.b2BodyType.b2_staticBody,texture:"atlas-foliage",textureKey:"coin.png",enabled:!1,isSensor:!0,depth:6};this.poolCoinBodies=[this.b2Physics.createBox(0,-1e3,0,c,c,l),this.b2Physics.createBox(0,-1e3,0,c,c,l),this.b2Physics.createBox(0,-1e3,0,c,c,l),this.b2Physics.createBox(0,-1e3,0,c,c,l),this.b2Physics.createBox(0,-1e3,0,c,c,l),this.b2Physics.createBox(0,-1e3,0,c,c,l),this.b2Physics.createBox(0,-1e3,0,c,c,l),this.b2Physics.createBox(0,-1e3,0,c,c,l)],this.poolTreeImages=[this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-01.png").setVisible(!1).setDepth(1),this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-02.png").setVisible(!1).setDepth(1),this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-03.png").setVisible(!1).setDepth(1),this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-01.png").setVisible(!1).setDepth(1),this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-02.png").setVisible(!1).setDepth(1),this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-03.png").setVisible(!1).setDepth(1),this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-02.png").setVisible(!1).setDepth(1),this.scene.add.image(-1e3,0,"atlas-foliage","dead-tree-03.png").setVisible(!1).setDepth(1)],this.poolPhysicsTrees=[new o(this.scene,this.b2Physics,1450,350).setEnabled(!1),new o(this.scene,this.b2Physics,600,250).setEnabled(!1),new o(this.scene,this.b2Physics,600,250).setEnabled(!1),new o(this.scene,this.b2Physics,600,250).setEnabled(!1),new o(this.scene,this.b2Physics,600,250).setEnabled(!1),new o(this.scene,this.b2Physics,600,250).setEnabled(!1),new o(this.scene,this.b2Physics,600,250).setEnabled(!1),new o(this.scene,this.b2Physics,600,250).setEnabled(!1)],this.terrainBody=this.b2Physics.world.CreateBody(),this.slopeStart=new Phaser.Math.Vector2(0,0),this.update()}update(){B.begin("terrain");const{zoom:e,width:t,worldView:s}=this.scene.cameras.main;for(;this.slopeStart.x<s.x+t+1/e*500;)this.cleanupFixtures(),this.updateChunk();B.end("terrain")}updateChunk(){const e=0===this.slopeStart.x,[t,s]=this.generatePoints();this.drawTerrain(t,s),this.drawDecoration(t),this.drawCoins(t),this.drawObstacles(t,e),this.drawPhysicsTree(t)}drawTerrain(e,t){const s=this.chunks.shift();if(!s)return;this.chunks.push(s),s.clear(),this.b2Physics.createChain(0,0,{points:t,type:"terrain",pointsScaled:!0,body:this.terrainBody});const i=e.length-1,a=Math.max(e[0].y,e[i].y)+2*this.scene.cameras.main.height;let n=0;e.push({x:e[i].x,y:a},{x:e[0].x,y:a});for(const{color:t,width:i}of this.config.layers)s.translateCanvas(0,n),s.fillStyle(t),s.fillPoints(e,!0,!0),s.translateCanvas(0,0),n=i;e.length-=2}drawDecoration(e){const t=e[Math.floor(Math.random()*(e.length-1))],s=this.poolTreeImages.shift();s&&(this.poolTreeImages.push(s),s.setPosition(t.x,t.y-s.height/2.25).setVisible(!0))}drawCoins(e){const t=e[Math.floor(Math.random()*(e.length-1))],s=this.poolCoinBodies.shift();if(!s)return;this.poolCoinBodies.push(s);const i=this.vec2Pool[0];s.SetTransformVec(i.Set(t.x/this.b2Physics.worldScale,(t.y-25)/this.b2Physics.worldScale),0),s.GetUserData().setPosition(t.x,t.y-25),s.SetEnabled(!0)}drawObstacles(e,t=!1){const s=e[0],i=e[e.length-1],a=this.scene.cameras.main.scrollX/(2*this.b2Physics.worldScale),n=a<750?2500:1500,o=a<3e3?.7:.4,{gridDensity:r,slopeLengthRange:h}=this.config,c=i.x-s.x,l=Math.abs(s.y-i.y),d=i.x-this.lastRockSpawnX;if(l<=50&&c>=h[1]*r*o&&Math.random()<.7&&d>n||t){const e=this.poolBoulderBodies.shift();if(!e)return;this.poolBoulderBodies.push(e),this.lastRockSpawnX=i.x;const t=a<500?40:35,s=e[0];s.SetTransformXY(i.x/this.b2Physics.worldScale,(i.y+t)/this.b2Physics.worldScale,0),s.GetUserData().setPosition(i.x,i.y+t).setVisible(!0),s.SetEnabled(!0)}}drawPhysicsTree(e){const t=e[0],s=e[e.length-1],i=s.x-t.x;if(t.y-s.y<-125&&i<=(this.config.slopeLengthRange[0]+2)*this.config.gridDensity){const t=this.poolPhysicsTrees.shift();if(!t)return;this.poolPhysicsTrees.push(t),t.moveTo(e[2].x-10,e[1].y+25).setEnabled(!0)}}generatePoints(){this.slopeEnd=this.getNextSlopeEnd();const e=[],t=[],s=this.b2Physics.worldScale;let i=this.slopeStart.x,a=0;const{startTerrainHeight:n,slopeAmplitude:o}=this.config,r=this.scene.cameras.main.height*n,h=this.slopeEnd.x-this.slopeStart.x,c=this.slopeStart.x,l=this.slopeStart.y,d=this.slopeEnd.y;let y,g;for(;i<=this.slopeEnd.x;){let n=r+this.interpolate(l,d,(i-c)/h)*o;y=this.pointsPool[a],y.x=i,y.y=n,e.push(y),g=this.vec2Pool[a],g.x=y.x/s,g.y=y.y/s,t.push(g),i+=this.config.gridDensity,a++}return this.slopeStart.x=this.slopeEnd.x,this.slopeStart.y=this.slopeEnd.y,[e,t]}getNextSlopeEnd(){const{gridDensity:e,slopeLengthRange:t}=this.config,s=t[1]-t[0],i=(Math.round(Math.random()*s)+s)*e;return this.yOffset+=i>(t[1]-3)*e?.4:.1,this.yOffset+=i<(t[0]+2)*e?.4:0,0===this.slopeStart.x?{x:(t[1]+7)*e,y:0}:{x:this.slopeStart.x+i,y:.75*Math.random()+this.yOffset}}interpolate(e,t,s){let i=.5*(1-Math.cos(s*Math.PI));return e*(1-i)+t*i}cleanupFixtures(){const e=this.b2Physics.worldScale,t=this.scene.cameras.main.scrollX-1/this.scene.cameras.main.zoom*500;this.poolPhysicsTrees.forEach((e=>e.cleanup(t)));for(let s=this.terrainBody.GetFixtureList();s;s=s.GetNext()){const i=s.GetShape();if(this.b2Physics.isChain(i)&&i.m_vertices[i.m_vertices.length-1].x*e<t){const e=s.GetBody();e.GetUserData()?e.SetEnabled(!1):this.terrainBody.DestroyFixture(s)}}}}class l{constructor(e){this.BASE_BOOST_FLOW=1350,this.BASE_TRICK_POINTS=200,this.maxBoost=25*this.BASE_BOOST_FLOW,this.availableBoost=this.maxBoost,this.landedFrontFlips=0,this.landedBackFlips=0,this.timeGrounded=0,this.totalTrickScore=0,this.protoTrickScore=0,this.comboAccumulatedScore=0,this.anglePreviousUpdate=0,this.totalRotation=0,this.currentFlipRotation=0,this.pendingFrontFlips=0,this.pendingBackFlips=0,this.ignoredSensorBodies=new Set,this.comboMultiplier=0,this.alreadyCollectedCoins=new Set,this.snowman=e,this.parts=e.parts,this.b2Physics=e.b2Physics,this.crashIgnoredParts=[this.parts.armLowerLeft,this.parts.armLowerRight,this.parts.body],this.state=e.isInAir()?"in-air":"grounded",this.registerCollisionListeners(),this.snowman.scene.observer.on("enter-in-air",(()=>this.state="in-air")),this.snowman.scene.observer.on("enter-grounded",(()=>{this.state="grounded",this.timeGrounded=this.snowman.scene.game.getTime(),this.landedFrontFlips+=this.pendingFrontFlips,this.landedBackFlips+=this.pendingBackFlips;const e=this.pendingBackFlips+this.pendingFrontFlips;if(e>=1){const t=e*e*this.BASE_TRICK_POINTS;this.totalTrickScore+=t,this.comboAccumulatedScore+=.1*t,this.comboMultiplier++,this.gainBoost(1,5*e),this.snowman.scene.observer.emit("combo-change",this.comboAccumulatedScore,this.comboMultiplier),this.snowman.scene.observer.emit("score-change",this.totalTrickScore),this.snowman.scene.observer.emit("boost-change",this.availableBoost,this.maxBoost),this.comboLeewayTween.resetTweenData(!0),this.comboLeewayTween.play()}this.totalRotation=0,this.currentFlipRotation=0,this.pendingBackFlips=0,this.pendingFrontFlips=0})),this.snowman.scene.observer.on("enter-crashed",(()=>{this.state="crashed",(this.comboLeewayTween.isPlaying()||this.comboLeewayTween.isPaused())&&this.comboLeewayTween.stop()})),this.comboLeewayTween=this.snowman.scene.tweens.addCounter({paused:!0,from:-.5*Math.PI,to:1.5*Math.PI,duration:1e3,onUpdate:e=>this.snowman.scene.observer.emit("combo-leeway-update",e.getValue()),onComplete:e=>{this.totalTrickScore+=this.comboAccumulatedScore*this.comboMultiplier,this.snowman.scene.observer.emit("score-change",this.totalTrickScore),this.snowman.scene.observer.emit("combo-change",0,0),this.protoTrickScore=0,this.comboAccumulatedScore=0,this.comboMultiplier=0}})}getState(){return this.state}getTravelDistanceMeters(){const e=this.parts.body.GetPosition().Length()/2;return 50*Math.floor(e/50)}gainBoost(e,t){const s=Math.min(this.maxBoost,this.BASE_BOOST_FLOW*t*e+this.availableBoost);return this.availableBoost=s,this.snowman.scene.observer.emit("boost-change",this.availableBoost,this.maxBoost),s}consumeBoost(e,t){if(this.availableBoost<=0)return 0;const s=Math.min(this.availableBoost,this.BASE_BOOST_FLOW*t*e);return this.availableBoost-=s*(t>1?1.5:1),this.snowman.scene.observer.emit("boost-change",this.availableBoost,this.maxBoost),s}registerCollisionListeners(){this.snowman.b2Physics.on("post-solve",((e,t)=>{var s;if(this.isCrashed&&this.lostHead)return;const i=e.GetFixtureA().GetBody(),a=e.GetFixtureB().GetBody();if(this.crashIgnoredParts.includes(i)||this.crashIgnoredParts.includes(a))return;const n=this.snowman.board.nose;i===this.parts.head||a===this.parts.head?Math.max(...t.normalImpulses)>8&&(this.lostHead=!0,this.isCrashed=!0):!n||i!==n.body&&a!==n.body||Math.max(...t.normalImpulses)>10&&(null===(s=n.crashRayResult)||void 0===s?void 0:s.hit)&&(this.isCrashed=!0)})),this.snowman.b2Physics.on("begin-contact",(e=>{const t=e.GetFixtureA(),s=e.GetFixtureB(),i=t.GetBody(),a=s.GetBody();t.IsSensor()&&i.IsEnabled()&&!this.ignoredSensorBodies.has(i)?(this.ignoredSensorBodies.add(i),this.gainBoost(1,.25),this.totalTrickScore+=25,this.snowman.scene.observer.emit("collected-coin",i),this.snowman.scene.observer.emit("score-change",this.totalTrickScore),setTimeout((()=>i.SetEnabled(!1)))):s.IsSensor()&&a.IsEnabled()&&!this.ignoredSensorBodies.has(a)&&(this.ignoredSensorBodies.add(a),this.gainBoost(1,.25),this.totalTrickScore+=25,this.snowman.scene.observer.emit("collected-coin",a),this.snowman.scene.observer.emit("score-change",this.totalTrickScore),setTimeout((()=>a.SetEnabled(!1))))}))}update(e){this.ignoredSensorBodies.clear();const t=this.snowman.isInAir();"crashed"!==this.state&&this.isCrashed&&this.snowman.scene.observer.emit("enter-crashed"),"grounded"===this.state&&t&&!this.isCrashed?this.snowman.scene.observer.emit("enter-in-air"):"in-air"!==this.state||t||this.isCrashed||this.snowman.scene.observer.emit("enter-grounded"),this.updateTrickCounter(),this.updateComboLeeway(),this.updateDistance()}updateTrickCounter(){if("in-air"===this.state){const e=i.Math.Angle.Normalize(this.parts.body.GetAngle()),t=this.calculateDifferenceBetweenAngles(this.anglePreviousUpdate,e);this.totalRotation+=t,this.currentFlipRotation+=t,this.anglePreviousUpdate=e,this.currentFlipRotation>=Math.PI*(0===this.pendingFrontFlips?1.25:2)?(this.pendingFrontFlips++,this.currentFlipRotation=0):this.currentFlipRotation<=Math.PI*-(0===this.pendingBackFlips?1.25:2)&&(this.pendingBackFlips++,this.currentFlipRotation=0)}}updateComboLeeway(){(this.comboLeewayTween.isPlaying()||this.comboLeewayTween.isPaused())&&("in-air"!==this.state&&this.snowman.board.isCenterGrounded?this.comboLeewayTween.resume():this.comboLeewayTween.pause())}calculateDifferenceBetweenAngles(e,t){let s=t-e;return s<-Math.PI?s+=2*Math.PI:s>Math.PI&&(s-=2*Math.PI),s}updateDistance(){const e=this.getTravelDistanceMeters();e!==this.lastDistance&&(this.snowman.scene.observer.emit("distance-change",e),this.lastDistance=e)}}class d{constructor(e,t=250,s=50){this.numSegments=10,this.segmentLength=8.4,this.segmentThickness=3.75,this.segments=[],this.pointStart=new n.b2Vec2(0,0),this.pointEnd=new n.b2Vec2(0,0),this.player=e,this.scene=e.scene,this.b2Physics=e.b2Physics,this.debugGraphics=this.scene.add.graphics();const[i,a]=this.generateSegments(t,s,this.b2Physics.worldScale/2);this.leftBinding=i,this.rightBinding=a}update(){this.player.debug&&this.debugGraphics.clear();const e=this.segments;for(const e of this.segments)this.resetSegment(e),e.body.GetWorldPoint(n.b2Vec2.ZERO,this.pointStart),e.body.GetWorldPoint(e.groundRayDirection,this.pointEnd),this.b2Physics.world.RayCast(this.pointStart,this.pointEnd,e.groundRayCallback),this.player.debug&&this.drawDebug(e.groundRayResult.hit?255:65280),e.crashRayResult&&e.crashRayCallback&&e.crashRayDirection&&(e.body.GetWorldPoint(n.b2Vec2.ZERO,this.pointStart),e.body.GetWorldPoint(e.crashRayDirection,this.pointEnd),this.b2Physics.world.RayCast(this.pointStart,this.pointEnd,e.crashRayCallback),this.player.debug&&this.drawDebug(e.crashRayResult.hit?255:65280));this.isTailGrounded=e[0].groundRayResult.hit,this.isNoseGrounded=e[e.length-1].groundRayResult.hit,this.isCenterGrounded=e[4].groundRayResult.hit||e[5].groundRayResult.hit||e[6].groundRayResult.hit}getTimeInAir(){if(this.segments.some((e=>e.groundRayResult.hit)))return-1;const e=Math.max(...this.segments.map((e=>e.groundRayResult.lastHitTime)));return this.scene.game.getTime()-e}isInAir(){return-1!==this.getTimeInAir()}rayCallbackFactory(e){return(t,s,i,a)=>(e.hit=!0,e.point=s,e.normal=i,e.fraction=a,e.lastHitTime=this.scene.game.getTime(),a)}resetSegment(e){e.groundRayResult.hit=!1,e.groundRayResult.point=null,e.groundRayResult.normal=null,e.groundRayResult.fraction=-1,e.crashRayResult&&(e.crashRayResult.hit=!1,e.crashRayResult.point=null,e.crashRayResult.normal=null,e.crashRayResult.fraction=-1)}drawDebug(e){this.debugGraphics.lineStyle(2,e,1);const t=this.b2Physics.worldScale;this.debugGraphics.lineBetween(this.pointStart.x*t,this.pointStart.y*t,this.pointEnd.x*t,this.pointEnd.y*t)}generateSegments(e,t,s){const{numSegments:i,segmentLength:a,segmentThickness:o}=this,r={hit:!1,point:null,normal:null,fraction:-1,lastHitTime:-1};for(let i=1;i<=this.numSegments;i++){const h=this.b2Physics.createBox(e+a*i,t,0,a,o,{color:13973086,type:n.b2BodyType.b2_dynamicBody}),c=i===this.numSegments,l=Object.assign({},r),d=Object.assign({},r);this.segments.push({body:h,groundRayDirection:new n.b2Vec2(0,s/this.b2Physics.worldScale),groundRayResult:l,groundRayCallback:this.rayCallbackFactory(l),crashRayDirection:c?new n.b2Vec2(s/this.b2Physics.worldScale,0):void 0,crashRayResult:c?d:void 0,crashRayCallback:c?this.rayCallbackFactory(d):void 0})}this.nose=this.segments[this.segments.length-1];const h=[{dampingRatio:.5,frequencyHz:6,referenceAngle:-.35},{dampingRatio:.5,frequencyHz:6,referenceAngle:-.25},{dampingRatio:.5,frequencyHz:7,referenceAngle:-.05},{dampingRatio:.5,frequencyHz:8,referenceAngle:-.025},{dampingRatio:.5,frequencyHz:10,referenceAngle:0},{dampingRatio:.5,frequencyHz:8,referenceAngle:-.025},{dampingRatio:.5,frequencyHz:7,referenceAngle:-.05},{dampingRatio:.5,frequencyHz:6,referenceAngle:-.25},{dampingRatio:.5,frequencyHz:6,referenceAngle:-.35}];for(let s=0;s<i-1;s++){const[i,o]=this.segments.slice(s,s+2),r=new n.b2Vec2((e+a/2+a*(s+1))/this.b2Physics.worldScale,t/this.b2Physics.worldScale),{dampingRatio:c,frequencyHz:l,referenceAngle:d}=h[s],y=new n.b2WeldJointDef;y.Initialize(i.body,o.body,r),y.referenceAngle=d,n.b2AngularStiffness(y,l,c,y.bodyA,y.bodyB),this.b2Physics.world.CreateJoint(y)}return[this.segments[3].body,this.segments[6].body]}}class y{constructor(e,t){this.debug=!1,this.jumpForce=18e3,this.leanForce=300,this.boostVector=new n.b2Vec2(0,0),this.jumpVector=new n.b2Vec2(0,0),this.boostFlowMultiplier=1,this.scene=e,this.b2Physics=t,this.bodyRadius=t.worldScale,this.legMinLength=this.bodyRadius,this.legMaxLength=1.6*this.legMinLength,this.cursors=this.scene.input.keyboard.createCursorKeys(),this.board=new d(this,250,50),this.parts=this.generateBodyParts(250,50),this.stateComponent=new l(this)}update(e){var t;if(B.begin("snowman"),this.boostFlowMultiplier=1,this.stateComponent.update(e),this.stateComponent.isCrashed&&this.detachBoard(),this.stateComponent.lostHead&&this.detachHead(),this.getTimeInAir()>100&&this.resetLegs(),!this.stateComponent.isCrashed){if(this.board.update(),null===(t=this.scene.input.activePointer)||void 0===t?void 0:t.isDown){const t=this.scene.input.activePointer;t.motionFactor=.2,this.scene.input.activePointer.x<this.scene.cameras.main.width/2?this.leanBackward(e):this.leanForward(e),t.velocity.y<-30&&this.scene.game.getTime()-t.moveTime<=300&&this.jump(e)}else this.scene.input.activePointer.motionFactor=.8;this.cursors.up.isDown&&this.scene.game.getTime()-this.cursors.up.timeDown<=300&&this.jump(e),this.cursors.left.isDown&&this.leanBackward(e),this.cursors.right.isDown&&this.leanForward(e),this.cursors.down.isDown&&this.leanCenter(),this.boost(e)}B.end("snowman")}getTimeInAir(){return this.board.getTimeInAir()}isInAir(){return this.board.isInAir()}detachBoard(){this.parts.jointBindingLeft&&this.b2Physics.world.DestroyJoint(this.parts.jointBindingLeft),this.parts.jointBindingRight&&this.b2Physics.world.DestroyJoint(this.parts.jointBindingRight),this.parts.jointDistanceLeft&&this.b2Physics.world.DestroyJoint(this.parts.jointDistanceLeft),this.parts.jointDistanceRight&&this.b2Physics.world.DestroyJoint(this.parts.jointDistanceRight),this.parts.jointDistanceRight&&this.board.segments[this.board.segments.length-1].body.SetLinearVelocity(n.b2Vec2.ZERO)}detachHead(){this.parts.jointNeck&&this.b2Physics.world.DestroyJoint(this.parts.jointNeck),this.parts.jointNeck=null}boost(e){const t=this.isInAir()?.6:1,s=this.boostVector.Set(this.stateComponent.consumeBoost(e,this.boostFlowMultiplier)*t,0);this.board.segments&&this.board.segments[4].body.ApplyForceToCenter(s,!0),this.parts.body.ApplyForceToCenter(s,!0)}resetLegs(){this.setDistanceLegs(this.legMinLength,this.legMinLength)}leanBackward(e){this.isInAir(),this.parts.body.ApplyAngularImpulse(-this.leanForce*e),this.setDistanceLegs(this.legMinLength,this.legMaxLength)}leanForward(e){this.isInAir(),this.parts.body.ApplyAngularImpulse(this.leanForce*e),this.setDistanceLegs(this.legMaxLength,this.legMinLength)}leanCenter(){this.boostFlowMultiplier=2,"in-air"===this.stateComponent.getState()&&this.parts.body.ApplyForceToCenter(new n.b2Vec2(0,10)),this.setDistanceLegs(this.legMinLength-5,this.legMinLength-5)}jump(e){if(this.scene.game.getTime()-this.stateComponent.timeGrounded<200)return;this.setDistanceLegs(this.legMaxLength,this.legMaxLength);const t=this.jumpForce*e,s=this.jumpVector.Set(0,0),{isTailGrounded:i,isCenterGrounded:a,isNoseGrounded:n}=this.board;i&&!n?s.y=-t:n&&!i?this.parts.body.GetWorldVector({x:0,y:.6*-t},s).Add({x:0,y:.4*-t}):a&&(s.y=2*-t),this.parts.body.ApplyForceToCenter(s,!0)}setDistanceLegs(e,t){this.parts.jointDistanceLeft&&this.b2Physics.setDistanceJointLength(this.parts.jointDistanceLeft,e,this.legMinLength,this.legMaxLength),this.parts.jointDistanceRight&&this.b2Physics.setDistanceJointLength(this.parts.jointDistanceRight,t,this.legMinLength,this.legMaxLength)}generateBodyParts(e,t){const s={},a=.7*this.bodyRadius,o=.7*this.bodyRadius,r=.3*this.bodyRadius,h=.5,c=o,l=r,d=new n.b2Vec2(e+this.board.segmentLength*(this.board.numSegments/2+h),t-2*this.bodyRadius-this.bodyRadius/2),y=new i.Math.Vector2(0,-1).multiply({x:0,y:this.bodyRadius}).add(d);s.head=this.b2Physics.createCircle(d.x,d.y-this.bodyRadius-a,0,a,{color:13165035,type:n.b2BodyType.b2_dynamicBody,linearDamping:.15,angularDamping:.15,depth:7,texture:"atlas-foliage",textureKey:"snowman-head.png"}),s.body=this.b2Physics.createCircle(d.x,d.y,0,this.bodyRadius,{color:13165035,type:n.b2BodyType.b2_dynamicBody,linearDamping:.15,angularDamping:.15,depth:7,texture:"atlas-foliage",textureKey:"snowman-body.png"}),s.jointNeck=this.b2Physics.createRevoluteJoint({bodyA:s.body,bodyB:s.head,anchor:y,lowerAngle:-.25,upperAngle:.25,enableLimit:!0});const g={texture:"atlas-foliage",textureKey:"snowman-leg.png",type:n.b2BodyType.b2_dynamicBody},p=this.bodyRadius+o/1.75,b=new i.Math.Vector2(0,1).rotate(h).multiply({x:p,y:p}).add(d),m=new i.Math.Vector2(0,1).rotate(h).multiply({x:this.bodyRadius,y:this.bodyRadius}).add(d),u=new i.Math.Vector2(0,1).rotate(.25).multiply({x:o,y:o}).add(b),x=new i.Math.Vector2(u.x,u.y).add({x:0,y:-o/2}),w=new i.Math.Vector2(u).add({x:0,y:o/2});s.legUpperLeft=this.b2Physics.createBox(b.x,b.y,h,r,o,g),s.legLowerLeft=this.b2Physics.createBox(u.x,u.y,0,r,o,g),s.jointHipLeft=this.b2Physics.createRevoluteJoint({bodyA:s.body,bodyB:s.legUpperLeft,anchor:m,lowerAngle:-.2,upperAngle:1,enableLimit:!0}),s.jointKneeLeft=this.b2Physics.createRevoluteJoint({bodyA:s.legUpperLeft,bodyB:s.legLowerLeft,anchor:x,lowerAngle:-1.5,upperAngle:.375,enableLimit:!0}),s.jointBindingLeft=this.b2Physics.createRevoluteJoint({bodyA:s.legLowerLeft,bodyB:this.board.leftBinding,anchor:w});const f=this.bodyRadius+o/1.75,S=new i.Math.Vector2(0,1).rotate(-.5).multiply({x:f,y:f}).add(d),R=new i.Math.Vector2(0,1).rotate(-.5).multiply({x:this.bodyRadius,y:this.bodyRadius}).add(d),B=new i.Math.Vector2(0,1).rotate(-.25).multiply({x:o,y:o}).add(S),P=new i.Math.Vector2(B.x,B.y).add({x:0,y:-o/2}),C=new i.Math.Vector2(B).add({x:0,y:o/2});s.legUpperRight=this.b2Physics.createBox(S.x,S.y,-.5,r,o,g),s.legLowerRight=this.b2Physics.createBox(B.x,B.y,0,r,o,g),s.jointHipRight=this.b2Physics.createRevoluteJoint({bodyA:s.body,bodyB:s.legUpperRight,anchor:R,lowerAngle:-1,upperAngle:.2,enableLimit:!0}),s.jointKneeRight=this.b2Physics.createRevoluteJoint({bodyA:s.legUpperRight,bodyB:s.legLowerRight,anchor:P,lowerAngle:-.375,upperAngle:1.5,enableLimit:!0}),s.jointBindingRight=this.b2Physics.createRevoluteJoint({bodyA:s.legLowerRight,bodyB:this.board.rightBinding,anchor:C});const T={length:this.legMinLength,minLength:this.legMinLength,maxLength:this.legMaxLength,frequencyHz:8,dampingRatio:5};s.jointDistanceLeft=this.b2Physics.createDistanceJoint(s.body,this.board.rightBinding,m,w,T),s.jointDistanceRight=this.b2Physics.createDistanceJoint(s.body,this.board.leftBinding,R,C,T);const L=Math.PI/180*90,D=.5,v=this.bodyRadius+c/1.75,A=new i.Math.Vector2(-1,0).rotate(D).multiply({x:v,y:v}).add(d),M=new i.Math.Vector2(-1,0).rotate(D).multiply({x:this.bodyRadius,y:this.bodyRadius}).add(d),F=new i.Math.Vector2(-1,0).rotate(D).multiply({x:c,y:c}).add(A),k=new i.Math.Vector2(F).add(new i.Math.Vector2(c/2,0).rotate(D));s.armUpperLeft=this.b2Physics.createBox(A.x,A.y,L+D,l,c,g),s.armLowerLeft=this.b2Physics.createBox(F.x,F.y,L+D,l,c,g),s.jointShoulderLeft=this.b2Physics.createRevoluteJoint({bodyA:s.body,bodyB:s.armUpperLeft,anchor:M,lowerAngle:-1.25,upperAngle:.75,enableLimit:!0}),s.jointElbowLeft=this.b2Physics.createRevoluteJoint({bodyA:s.armUpperLeft,bodyB:s.armLowerLeft,anchor:k,lowerAngle:-.75,upperAngle:.75,enableLimit:!0});const E=-L,O=-.5,V=v,G=new i.Math.Vector2(1,0).rotate(O).multiply({x:V,y:V}).add(d),I=new i.Math.Vector2(1,0).rotate(O).multiply({x:this.bodyRadius,y:this.bodyRadius}).add(d),_=new i.Math.Vector2(1,0).rotate(O).multiply({x:c,y:c}).add(G),j=new i.Math.Vector2(_).add(new i.Math.Vector2(-c/2,0).rotate(O));return s.armUpperRight=this.b2Physics.createBox(G.x,G.y,E+O,l,c,g),s.jointShoulderRight=this.b2Physics.createRevoluteJoint({bodyA:s.body,bodyB:s.armUpperRight,anchor:I,lowerAngle:-.75,upperAngle:1.25,enableLimit:!0}),s.armLowerRight=this.b2Physics.createBox(_.x,_.y,E+O,l,c,g),s.jointElbowRight=this.b2Physics.createRevoluteJoint({bodyA:s.armUpperRight,bodyB:s.armLowerRight,anchor:j,lowerAngle:-.75,upperAngle:.75,enableLimit:!0}),s}}class g extends Phaser.Events.EventEmitter{constructor(e,t,s){super(),this.textureKeys=new Set,this.ZERO=new n.b2Vec2(0,0),this.bulletTime={rate:1},this.scene=e,this.worldScale=t,this.world=n.b2World.Create(s),this.world.SetContactListener({BeginContact:e=>this.emit("begin-contact",e),EndContact:()=>null,PreSolve:()=>null,PostSolve:(e,t)=>this.emit("post-solve",e,t)}),this.world.SetAllowSleeping(!1),this.world.SetWarmStarting(!0),this.userDataGraphics=e.add.graphics()}update(){B.begin("physics");const e=Math.floor(Math.max(this.scene.game.loop.actualFps/3,9));this.world.Step(1/38.5,{positionIterations:e,velocityIterations:e}),this.world.ClearForces();const t=this.worldScale;for(let e=this.world.GetBodyList();e;e=e.GetNext()){if(!e)continue;let s=e.GetUserData();if(s)if(e.IsEnabled()){let{x:i,y:a}=e.GetPosition();!s.visible&&s.setVisible(!0),s.x=i*t,s.y=a*t,s.rotation=e.GetAngle()}else s.visible&&s.setVisible(!1)}B.end("physics")}enterBulletTime(e,t){this.bulletTime.rate=t,this.scene.tweens.add({delay:e,targets:[this.bulletTime],rate:.9,duration:500})}createBox(e,t,s,i,a,o={}){const r=new n.b2PolygonShape;r.SetAsBox(i/2/this.worldScale,a/2/this.worldScale);const h={shape:r,isSensor:o.isSensor||!1,density:o.density||.1,friction:o.friction||.001,restitution:o.restitution||.005},c=this.world.CreateBody({enabled:o.enabled||!0,fixedRotation:o.fixedRotation,awake:!0,position:{x:e/this.worldScale,y:t/this.worldScale},angle:s,linearDamping:o.linearDamping||.15,angularDamping:o.angularDamping||.1,type:o.type});let l;if(c.CreateFixture(h),c.SetMassData({mass:.5,center:new n.b2Vec2,I:1}),o.texture)l=this.scene.add.image(e,t,o.texture,o.textureKey),l.displayHeight=a,l.displayWidth=i;else{const s=o.color||11962192;let n=this.scene.add.graphics().setDepth(o.depth||3);n.fillStyle(s),n.fillRect(-i/2,-a/2,2*i,2*a);const r=`box-${i}-${a}-${s}`;this.textureKeys.has(r)||(this.textureKeys.add(r),n.generateTexture(r,i,a)),l=this.scene.add.image(e,t,r)}return l.setDepth(o.depth||3),c.SetUserData(l),c}createChain(e,t,s){const i=new n.b2ChainShape;"terrain"===s.type?i.CreateChain(s.points,s.points.length,s.points[0],s.points[s.points.length-1]):i.CreateLoop(s.points,s.points.length);const a={shape:i,density:0,friction:0};let o;o=s.body?s.body:this.world.CreateBody({enabled:!s.disabled,angle:s.angle||0,position:{x:e/this.worldScale,y:t/this.worldScale},linearDamping:.8,angularDamping:.8,type:s.isDynamic?n.b2BodyType.b2_dynamicBody:n.b2BodyType.b2_staticBody});const r=o.CreateFixture(a);if(!s.body&&o.SetMassData({mass:.5,center:new n.b2Vec2,I:1}),"terrain"!==s.type&&s.texture){const i=this.scene.add.image(e,t,s.texture,s.textureKey).setDepth(s.depth||3).setVisible(!s.disabled);o.SetUserData(i)}return[o,r]}createCircle(e,t,s,i,a={type:n.b2BodyType.b2_dynamicBody,fixedRotation:!1}){const o=new n.b2CircleShape;o.m_radius=i/this.worldScale;const r={shape:o,isSensor:a.isSensor,density:a.density||1,friction:a.friction||.001,restitution:a.restitution||.005},h=this.world.CreateBody({enabled:a.enabled||!0,position:{x:e/this.worldScale,y:t/this.worldScale},angle:s,fixedRotation:a.fixedRotation,linearDamping:a.linearDamping,angularDamping:a.angularDamping,type:a.type});let c;if(h.CreateFixture(r),h.SetMassData({mass:1,center:this.ZERO,I:1}),a.texture)c=this.scene.add.image(e,t,a.texture,a.textureKey),c.displayHeight=2*i,c.displayWidth=2*i;else{const s=a.color||11962192,n=`circle-${i}-${s}`;this.userDataGraphics.clear().fillStyle(s).fillCircle(i,i,i).generateTexture(n,2*i,2*i),this.textureKeys.has(n)||this.textureKeys.add(n),c=this.scene.add.image(e,t,n)}return c.setDepth(a.depth||3),h.SetUserData(c),h}createRevoluteJoint(e){const t=new n.b2RevoluteJointDef,s=new n.b2Vec2(e.anchor.x/this.worldScale,e.anchor.y/this.worldScale);return t.Initialize(e.bodyA,e.bodyB,s),t.collideConnected=!1,e.lowerAngle&&(t.lowerAngle=e.lowerAngle),e.upperAngle&&(t.upperAngle=e.upperAngle),e.enableLimit&&(t.enableLimit=e.enableLimit),this.world.CreateJoint(t)}createDistanceJoint(e,t,s,i,a={}){const o=new n.b2DistanceJointDef,r=this.worldScale;o.Initialize(e,t,{x:s.x/r,y:s.y/r},{x:i.x/r,y:i.y/r}),o.collideConnected=!0;const h=a.length?a.length/this.worldScale:0;return o.length=h,o.minLength=h,o.maxLength=h,n.b2AngularStiffness(o,a.frequencyHz||15,a.dampingRatio||10,o.bodyA,o.bodyB),this.world.CreateJoint(o)}setDistanceJointLength(e,t,s,i){e&&(e.SetMinLength(s?s/this.worldScale:e.GetMinLength()),e.SetMaxLength(i?i/this.worldScale:e.GetMaxLength()),e.SetLength(t/this.worldScale))}isEdge(e){return e.GetType()===n.b2ShapeType.e_edge}isChain(e){return e.GetType()===n.b2ShapeType.e_chain}isPolygon(e){return e.GetType()===n.b2ShapeType.e_polygon}isCircle(e){return e.GetType()===n.b2ShapeType.e_circle}}class p{constructor(e){this.scene=e,this.bgSpaceBack=this.registerLayer("bg-space-back.png"),this.bgLandscapeMountains=this.registerLayer("mountain-back.png").setTint(30,30,30,30),this.bgLandscapeHills=this.registerLayer("mountain-mid.png").setTint(50,50,50,50)}update(){B.begin("backdrop");const{scrollX:e,scrollY:t}=this.scene.cameras.main;this.bgSpaceBack.setTilePosition(.001*e,.001*t),this.bgLandscapeMountains.setTilePosition(.02*e,0),this.bgLandscapeHills.setTilePosition(.06*e,0),B.end("backdrop")}registerLayer(e,t=1,s=1){const{width:i,height:a,zoomX:n,zoomY:o,worldView:r}=this.scene.cameras.main;return this.scene.add.tileSprite(r.x+i/2,r.y+a/2,i,a,"atlas-backdrop",e).setOrigin(.5,.5).setScrollFactor(0,0).setScale(t*(1/n),s*(1/o)).setDepth(0)}}class b extends i.Scene{constructor(){super({key:"GameScene"}),this.observer=new i.Events.EventEmitter}create(){this.cameras.main.setDeadzone(50,125),this.cameras.main.setBackgroundColor(0);const e=this.game.canvas.width===w?1:.5;this.cameras.main.setZoom(.8*e,.8*e),this.b2Physics=new g(this,15,new n.b2Vec2(0,9.8)),this.backdrop=new p(this),this.wickedSnowman=new y(this,this.b2Physics),this.terrainSimple=new c(this,this.b2Physics),this.cameras.main.startFollow(this.wickedSnowman.parts.body.GetUserData(),!1,.8,.25),this.cameras.main.followOffset.set(-375,0);const t=this.cameras.main.worldView.x+this.cameras.main.width/2,s=this.cameras.main.worldView.y+this.cameras.main.height/2;this.add.bitmapText(t+50,s-200,"atari-classic","WICKED SNOWMAN").setScrollFactor(.35).setFontSize(40).setOrigin(.5),this.add.bitmapText(t+50,s-100,"atari-classic","Don't lose your head").setScrollFactor(.35).setFontSize(25).setOrigin(.5),this.scene.launch("UIScene",[this.observer,this.restartGame.bind(this)]),this.observer.on("enter-crashed",(()=>{this.cameras.main.shake(200,.01),this.b2Physics.enterBulletTime(-1,.4)}))}restartGame(){this.scene.restart()}update(){B.begin();const e=this.game.loop.delta/1e3;this.b2Physics.update(),this.backdrop.update(),this.wickedSnowman.update(e),this.terrainSimple.update(),B.end()}}class m{constructor(e,t,s=10,i=100){this.scene=e,this.observer=t,this.currentBoost=s,this.maxBoost=i;const a=this.scene.game.canvas.width===w?1:.5,n=32*a,o=4*a,r=this.scene.cameras.main.worldView.x+this.scene.cameras.main.width/2,h=this.scene.cameras.main.worldView.y+this.scene.cameras.main.height/2,c=this.scene.add.graphics();c.lineStyle(o,16777215),c.strokeRect(2*r-n-15-o,150*a,15*a,h);const l=this.scene.add.graphics();this.observer.on("boost-change",((e,t)=>{const s=h*(e/t);l.clear(),l.fillStyle(16777215,1),l.fillRect(2*r-n-15-o/2,h+150*a-s,15*a-o,s)}))}}class u extends i.Scene{constructor(){super({key:"UIScene"})}init([e,t]){this.observer=e,this.restartGame=t}create(){this.cameras.main.setRoundPixels(!0);const e=this.game.canvas.width===w?1:.5,t=20*e,s=18*e,i=24*e,a=4*e;this.music=this.sound.add("theme"),this.music.play({loop:!0,volume:.2,rate:.9,delay:1.25});const n=this.cameras.main.worldView.x+this.cameras.main.width/2,o=this.cameras.main.worldView.y+this.cameras.main.height/2;this.boostBar=new m(this,this.observer,10,100),this.playAgainButton=this.add.bitmapText(n,1.5*o,"atari-classic","PLAY AGAIN?").setScrollFactor(0).setFontSize(i).setOrigin(.5).setDropShadow(1,2,2236962).setAlpha(0).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.playAgain())).on("pointerover",(()=>this.playAgainButton.setCharacterTint(0,-1,!0,10,10,10,10))).on("pointerout",(()=>this.playAgainButton.setCharacterTint(0,-1,!1,-10,-10,-10,-10))),this.add.bitmapText(4,4,"atari-classic","DISTANCE").setScrollFactor(0,0).setFontSize(t),this.textDistance=this.add.bitmapText(1.5*a,t+2*a,"atari-classic","Distance: 0m").setScrollFactor(0,0).setFontSize(s),this.add.bitmapText(n,a,"atari-classic","COMBO").setScrollFactor(0,0).setOrigin(.5,0).setFontSize(t),this.textCombo=this.add.bitmapText(n,t+2*a,"atari-classic","-").setScrollFactor(0,0).setFontSize(s).setOrigin(.5,0),this.add.bitmapText(2*n-a,a,"atari-classic","SCORE").setScrollFactor(0,0).setOrigin(1,0).setFontSize(t),this.textScore=this.add.bitmapText(2*n-a,t+2*a,"atari-classic","0").setScrollFactor(0,0).setFontSize(s).setOrigin(1,0),this.observer.on("combo-change",((e,t)=>this.textCombo.setText(e?e+"x"+t:"-"))),this.observer.on("score-change",(e=>this.textScore.setText(e))),this.observer.on("distance-change",(e=>this.textDistance.setText(String(e)+"m"))),this.comboLeewayChart=this.add.graphics(),this.observer.on("combo-leeway-update",(t=>{this.comboLeewayChart.clear().fillStyle(16777215).slice(n,72*e,12*e,t,1.5*Math.PI).fillPath()})),this.observer.on("enter-crashed",(()=>{this.playAgainButton.setAlpha(1),this.tweens.add({targets:this.music,volume:0,detune:-500,rate:.5,duration:3e3,onComplete:e=>this.music.stop()})}))}update(){}playAgain(){this.music.stop(),this.restartGame()}}var x=s(260);const w=960,f=540,S={title:"Wicked Snowman",version:"0.4.2",type:i.WEBGL,backgroundColor:"#ffffff",disableContextMenu:!0,fps:{min:50,target:60},scale:{parent:"phaser-wrapper",mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH,width:w,height:f},scene:[a,b,u]},R={autoPlace:!0,targetFPS:60,redrawInterval:200,maximumHistory:200,scale:1,memoryUpdateInterval:100,memoryMaxHistory:600,FONT_FAMILY:"Arial",COLOR_FPS_BAR:"#34cfa2",COLOR_FPS_AVG:"#FFF",COLOR_TEXT_LABEL:"#FFF",COLOR_TEXT_TO_LOW:"#eee207",COLOR_TEXT_BAD:"#d34646",COLOR_TEXT_TARGET:"#d249dd",COLOR_BG:"#333333"};let B;window.addEventListener("load",(()=>{new i.Game(S),B=new x.Z(R),document.body.appendChild(B.dom)}))}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(l=0;l<e.length;l++){for(var[s,a,n]=e[l],r=!0,h=0;h<s.length;h++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[h])))?s.splice(h--,1):(r=!1,n<o&&(o=n));if(r){e.splice(l--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[s,a,n]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.e=()=>Promise.resolve(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,h]=s,c=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(h)var l=h(i)}for(t&&t(s);c<o.length;c++)n=o[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(l)},s=self.webpackChunkwicked_snowman=self.webpackChunkwicked_snowman||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=i.O(void 0,[216],(()=>i(9826)));a=i.O(a)})();