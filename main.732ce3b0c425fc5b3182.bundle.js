(()=>{var e,t={7153:(e,t,s)=>{var i={"./gamestats-pixi.module.js":[6913,216]};function o(e){if(!s.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],o=t[0];return s.e(t[1]).then((()=>s(o)))}o.keys=()=>Object.keys(i),o.id=7153,e.exports=o},6335:(e,t,s)=>{"use strict";s.d(t,{fl:()=>V,eM:()=>X,R$:()=>Y,$7:()=>J,m6:()=>K,qs:()=>j,gC:()=>R,$K:()=>D,uF:()=>F,zq:()=>O,rb:()=>N,O2:()=>M,mO:()=>G,nI:()=>z,XG:()=>E,N8:()=>k,c6:()=>I,d5:()=>U,Fl:()=>T,ot:()=>H});var i=s(2260),o=s(656);class r extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.loadAudio(),this.loadImg(),this.loadLevels(),this.load.html("dom_game_ui","assets/html/game_ui.html")}create(){this.scene.start("GameScene")}loadAudio(){this.load.audio("riverside_ride",["assets/audio/music/riverside_ride/riverside_ride.ogg","assets/audio/music/riverside_ride/riverside_ride.mp3"]),this.load.audio("boink",["assets/audio/sfx/jump/boink.ogg","assets/audio/sfx/jump/boink.mp3"]),this.load.audio("pickup_present",["assets/audio/sfx/pickup/pickupgem.ogg","assets/audio/sfx/pickup/pickupgem.mp3"]),this.load.audio("death",["assets/audio/sfx/crash/death.ogg","assets/audio/sfx/crash/death.mp3"]),this.load.audio("grunt",["assets/audio/sfx/crash_grunt/grunt.ogg","assets/audio/sfx/crash_grunt/grunt.mp3"]),this.load.audio("applause",["assets/audio/sfx/applause/applause.ogg","assets/audio/sfx/applause/applause.mp3"]),this.load.audio("game_over_demon",["assets/audio/sfx/game_over_demon/game_over_demon.ogg","assets/audio/sfx/game_over_demon/game_over_demon.mp3"])}loadImg(){const e=Y*z,t={360:"640x360",540:"960x540",720:"1280x720"}[[360,540,720].reduce(((t,s)=>Math.abs(s-e)<Math.abs(t-e)?s:t))];this.load.atlas("bg_space_pack",`assets/img/packed/bg_space_${t}.png`,`assets/img/packed/bg_space_${t}.json`),this.load.atlas("atlas_santa",`assets/img/packed/character_santa_${t}.png`,`assets/img/packed/character_santa_${t}.json`),this.load.atlas("atlas_environment",`assets/img/packed/environment_${t}.png`,`assets/img/packed/environment_${t}.json`)}loadLevels(){this.load.json(M.level_001,`assets/levels/export/${M.level_001}.json`),this.load.json(M.level_002,`assets/levels/export/${M.level_002}.json`),this.load.json(M.level_003,`assets/levels/export/${M.level_003}.json`),this.load.json(M.level_004,`assets/levels/export/${M.level_004}.json`)}}var n=s(2511);class a{constructor(e,t){var s;this.chunks=[],this.zoomModifier=1/K,this.layers=[{color:13165035,width:4*this.zoomModifier},{color:6065609,width:15*this.zoomModifier},{color:13165035,width:4*this.zoomModifier},{color:16777215,width:250*this.zoomModifier}],this.scene=e,this.b2Physics=t,this.terrainBody=this.b2Physics.world.CreateBody();const i=this.terrainBody.GetPosition(),o=this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserTerrain",!0)[0];if(!o)return;const r=null===(s=o.GetFixtureList())||void 0===s?void 0:s.GetShape();let n=0;const a=50*this.b2Physics.worldScale,l=[];let h=[];for(const[e,t]of[...r.m_vertices].reverse().entries()){const s={x:(t.x-i.x)*this.b2Physics.worldScale,y:-(t.y+i.y)*this.b2Physics.worldScale};h.push(s),0===e?n=s.x:e===r.m_vertices.length-1&&h.length&&l.length&&s.x-h[0].x<a&&l[l.length-1].push(...h),s.x-n>=a&&(l.push(h),h=[s],n=s.x)}l.forEach(((e,t)=>this.drawTerrain(e,t)))}update(){}drawTerrain(e,t){const s=e.length-1,i={graphics:this.scene.add.graphics().setDepth(10),index:t,vertices:e,firstVert:e[0],lastVert:e[s]};this.chunks.push(i);const o=Math.max(...i.vertices.map((e=>e.y)))+2*this.scene.cameras.main.height;let r=0;e.push({x:i.lastVert.x,y:o},{x:i.firstVert.x,y:o});for(const{color:t,width:s}of this.layers)i.graphics.translateCanvas(0,r),i.graphics.fillStyle(t),i.graphics.fillPoints(e,!0,!0),i.graphics.translateCanvas(0,0),r=.5*s}}class l{constructor(e,t,s,i){this.world=e,this.debugGraphics=t,this.scene=s,this.worldSize=i}loadScene(e){this.loadedBodies=e.body?e.body.map((e=>this.loadBody(e))):[],this.loadedJoints=e.joint?e.joint.map((e=>this.loadJoint(e))):[],this.loadedImages=e.image?e.image.map((e=>this.loadImage(e))):[];const t=this.loadedBodies.every((e=>e))&&this.loadedJoints.every((e=>e))&&this.loadedImages.every((e=>e));return t?console.log("R.U.B.E. scene loaded successfully",this.loadedBodies,this.loadedJoints,this.loadedImages):console.error("R.U.B.E. scene failed to load fully",this.loadedBodies,this.loadedJoints,this.loadedImages),t}loadBody(e){const t={};t.type=Math.min(Math.max(e.type||0,0),2),t.angle=e.angle||0,t.angularVelocity=e.angularVelocity||0,t.awake=Boolean(e.awake),t.enabled=!e.hasOwnProperty("active")||e.active,t.fixedRotation=Boolean(e.fixedRotation),t.linearVelocity=this.rubeToXY(e.linearVelocity),t.linearDamping=e.linearDamping||0,t.angularDamping=e.angularDamping||0,t.position=this.rubeToXY(e.position);const s=this.world.CreateBody(t);return s.SetMassData({mass:e["massData-mass"]||1,center:this.rubeToVec2(e["massData-center"]),I:e["massData-I"]||1}),s.name=e.name||"",s.customProperties=e.customProperties||[],s.customPropertiesMap=this.customPropertiesArrayToMap(s.customProperties||[]),(e.fixture||[]).map((e=>this.loadFixture(s,e))),s}loadFixture(e,t){const s=this.getFixtureDefWithShape(t,e);s.friction=t.friction||0,s.density=t.density||0,s.restitution=t.restitution||0,s.isSensor=Boolean(t.sensor),s.filter={categoryBits:t["filter-categoryBits"],maskBits:t["filter-maskBits"]||1,groupIndex:t["filter-groupIndex"]||65535};const i=e.CreateFixture(s);return i.name=t.name||"",i.customProperties=t.customProperties||[],i.customPropertiesMap=this.customPropertiesArrayToMap(i.customProperties),i}loadJoint(e){if(e.bodyA>=this.loadedBodies.length)return console.error("Index for bodyA is invalid: "+e),null;if(e.bodyB>=this.loadedBodies.length)return console.error("Index for bodyB is invalid: "+e),null;const t=this.loadedBodies[e.bodyA],s=this.loadedBodies[e.bodyB];if(!t||!s)return console.error("bodyA or bodyB are invalid",t,s,this.loadedBodies),null;let i;switch(e.type){case"revolute":{const o=new n.b2RevoluteJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,o.enableLimit=Boolean(e.enableLimit),o.lowerAngle=e.lowerLimit||0,o.upperAngle=e.upperLimit||0,o.enableMotor=Boolean(e.enableMotor),o.maxMotorTorque=e.maxMotorTorque||0,o.motorSpeed=e.motorSpeed||0,i=this.world.CreateJoint(o);break}case"distance":{const o=new n.b2DistanceJointDef;o.length=e.length||0,o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition()),this.rubeToVec2(e.anchorB).Rotate(s.GetAngle()).Add(s.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.length=e.length||0,o.minLength=0,o.maxLength=2*o.length,n.b2LinearStiffness(o,e.frequency||0,e.dampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}case"prismatic":{const o=new n.b2PrismaticJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition()),this.rubeToXY(e.localAxisA)),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,o.enableLimit=Boolean(e.enableLimit),o.lowerTranslation=e.lowerLimit||0,o.upperTranslation=e.upperLimit||0,o.enableMotor=Boolean(e.enableMotor),o.maxMotorForce=e.maxMotorForce||0,o.motorSpeed=e.motorSpeed||0,i=this.world.CreateJoint(o);break}case"wheel":{const o=new n.b2WheelJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorB),this.rubeToVec2(e.localAxisA)),o.collideConnected=Boolean(e.collideConnected),o.enableMotor=Boolean(e.enableMotor),o.maxMotorTorque=e.maxMotorTorque||0,o.motorSpeed=e.motorSpeed||0,n.b2LinearStiffness(o,e.springFrequency||0,e.springDampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}case"friction":{const o=new n.b2FrictionJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.maxForce=e.maxForce||0,o.maxTorque=e.maxTorque||0,i=this.world.CreateJoint(o);break}case"weld":{const o=new n.b2WeldJointDef;o.Initialize(t,s,this.rubeToVec2(e.anchorA).Rotate(t.GetAngle()).Add(t.GetPosition())),o.collideConnected=Boolean(e.collideConnected),o.referenceAngle=e.refAngle||0,n.b2AngularStiffness(o,e.frequency||0,e.dampingRatio||0,o.bodyA,o.bodyB),i=this.world.CreateJoint(o);break}default:throw new Error("Unsupported joint type: "+e.type)}return i.name=e.name,i.customProperties=e.customProperties||[],i.customPropertiesMap=this.customPropertiesArrayToMap(i.customProperties),i}loadImage(e){const{file:t,body:s,center:i,customProperties:o,angle:r,aspectScale:n,scale:a,flip:l,renderOrder:h}=e,c=this.loadedBodies[s],d=c?c.GetPosition().Add(this.rubeToXY(i)):this.rubeToXY(i);if(!d)return null;const u=this.getCustomProperty(e,"string","phaserTexture",""),p=(t||"").split("/").reverse()[0],m=this.getCustomProperty(e,"string","phaserTextureFrame",p),g=this.scene.add.image(d.x*this.worldSize,d.y*-this.worldSize,u||p,m);return g.rotation=c?-c.GetAngle()-(r||0):-(r||0),g.scaleY=this.worldSize/g.height*a,g.scaleX=g.scaleY*n,g.flipX=l,g.setDepth(h),g.custom_origin_angle=-(r||0),g.customProperties=o||[],g.customPropertiesMap=this.customPropertiesArrayToMap(g.customProperties),c&&c.SetUserData(g),g}rubeToXY(e,t={x:0,y:0}){return this.isXY(e)?{x:e.x+t.x,y:e.y+t.y}:t}rubeToVec2(e){return this.isXY(e)?new n.b2Vec2(e.x,e.y):new n.b2Vec2(0,0)}getBodiesByName(e){const t=[];for(let s=this.world.GetBodyList();s;s=s.GetNext())s&&s.name===e&&t.push(s);return t}getBodiesByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetBodyList();o;o=o.GetNext())if(o&&o.customProperties)for(let r=0;r<o.customProperties.length;r++)o.customProperties[r].hasOwnProperty("name")&&o.customProperties[r].hasOwnProperty(e)&&o.customProperties[r].name==t&&o.customProperties[r][e]==s&&i.push(o);return i}getFixturesByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetBodyList();o;o=o.GetNext())for(let r=o.GetFixtureList();r;r=r.GetNext())if(r&&r.customProperties)for(let o=0;o<r.customProperties.length;o++)r.customProperties[o].hasOwnProperty("name")&&r.customProperties[o].hasOwnProperty(e)&&r.customProperties[o].name==t&&r.customProperties[o][e]==s&&i.push(r);return i}getJointsByCustomProperty(e,t,s){const i=[];for(let o=this.world.GetJointList();o;o=o.GetNext())if(o&&o.customProperties)for(let r=0;r<o.customProperties.length;r++)o.customProperties[r].hasOwnProperty("name")&&o.customProperties[r].hasOwnProperty(e)&&o.customProperties[r].name==t&&o.customProperties[r][e]==s&&i.push(o);return i}getCustomProperty(e,t,s,i){if(!e.customProperties)return i;for(const i of e.customProperties)if(i.name&&i.hasOwnProperty(t)&&i.name===s)return i[t];return i}customPropertiesArrayToMap(e){return e.reduce(((e,t)=>{if(t.hasOwnProperty("int"))e[t.name]=t.int;else if(t.hasOwnProperty("float"))e[t.name]=t.float;else if(t.hasOwnProperty("string"))e[t.name]=t.string;else if(t.hasOwnProperty("color"))e[t.name]=t.color;else if(t.hasOwnProperty("bool"))e[t.name]=t.bool;else{if(!t.hasOwnProperty("vec2"))throw new Error("invalid or missing custom property type");e[t.name]=this.rubeToXY(t.vec2)}return e}),{})}getFixtureDefWithShape(e,t){if(e.hasOwnProperty("circle")&&e.circle){const s=new n.b2CircleShape;s.Set(this.rubeToXY(e.circle.center),e.circle.radius);const i=t.GetPosition().Clone().Add(s.m_p).Scale(this.worldSize);return X&&this.debugGraphics.strokeCircle(i.x,-i.y,e.circle.radius*this.worldSize),{shape:s}}if(e.hasOwnProperty("polygon")&&e.polygon){const s=this.pointsFromSeparatedVertices(e.polygon.vertices).reverse(),i=t.GetPosition();if(X){const e=s.map((e=>i.Clone().Add(new n.b2Vec2(e.x,e.y).Rotate(t.GetAngle())).Scale(this.worldSize))).map((({x:e,y:t})=>({x:e,y:-t})));this.debugGraphics.strokePoints(e,!0).setDepth(100)}return{shape:(new n.b2PolygonShape).Set(s,s.length)}}if(e.hasOwnProperty("chain")&&e.chain){const s=this.pointsFromSeparatedVertices(e.chain.vertices).reverse(),i=t.GetPosition();if(X){const e=s.map((e=>i.Clone().Add(new n.b2Vec2(e.x,e.y).Rotate(t.GetAngle())).Scale(this.worldSize))).map((({x:e,y:t})=>({x:e,y:-t})));this.debugGraphics.strokePoints(e).setDepth(100)}return{shape:e.chain.hasNextVertex&&e.chain.hasPrevVertex&&e.chain.nextVertex&&e.chain.prevVertex?(new n.b2ChainShape).CreateLoop(s,s.length):(new n.b2ChainShape).CreateChain(s,s.length,this.rubeToXY(e.chain.prevVertex),this.rubeToXY(e.chain.nextVertex))}}throw new Error("Could not find shape type for fixture")}pointsFromSeparatedVertices(e){const t=[];for(let s=0;s<e.x.length;s++)t.push(new n.b2Vec2(e.x[s],e.y[s]));return t}isXY(e){return Boolean(e&&"object"==typeof e&&e.hasOwnProperty("x")&&e.hasOwnProperty("y"))}}class h extends Phaser.Events.EventEmitter{constructor(e,t,s){super(),this.isPaused=!1,this.stepDeltaTime=1/60,this.stepConfig={positionIterations:12,velocityIterations:12},this.debugDraw=e.add.graphics(),this.scene=e,this.worldScale=t,this.world=n.b2World.Create(s),this.world.SetAutoClearForces(!0),this.world.SetContactListener({BeginContact:e=>this.emit("begin_contact",e),EndContact:()=>null,PreSolve:()=>null,PostSolve:(e,t)=>this.emit("post_solve",e,t)}),this.rubeLoader=new l(this.world,this.scene.add.graphics(),this.scene,this.worldScale)}loadRubeScene(e){const t=this.scene.cache.json.get(e);if(!this.rubeLoader.loadScene(t))throw new Error("Failed to load RUBE scene");console.log("RUBE scene loaded successfully.")}update(){if(this.isPaused)return;H.begin("physics"),this.world.Step(this.stepDeltaTime,this.stepConfig),this.world.ClearForces();const e=this.worldScale;for(let t=this.world.GetBodyList();t;t=t.GetNext()){if(!t)continue;let s=t.GetUserData();if(s&&s)if(t.IsEnabled()){let{x:i,y:o}=t.GetPosition();!s.visible&&s.setVisible(!0),s.x=i*e,s.y=o*-e,s.rotation=-t.GetAngle()+(s.custom_origin_angle||0)}else s.setVisible(!1)}H.end("physics")}}class c{constructor(e){this.scene=e,this.bgSpaceBack=this.registerLayer("bg_space_back.png"),this.bgSpaceMid=this.registerLayer("bg_space_mid.png"),this.bgSpaceFront=this.registerLayer("bg_space_front.png")}update(){H.begin("backdrop");const{scrollX:e,scrollY:t}=this.scene.cameras.main;this.bgSpaceBack.setTilePosition(.005*e,.005*t),this.bgSpaceMid.setTilePosition(.01*e,.01*t),this.bgSpaceFront.setTilePosition(.025*e,.025*t),H.end("backdrop")}registerLayer(e,t=1,s=1){const{width:i,height:o,zoomX:r,zoomY:n,worldView:a}=this.scene.cameras.main;return this.scene.add.tileSprite(a.x+i/2,a.y+o/2,i,o,"bg_space_pack",e).setOrigin(.5,.5).setScrollFactor(0,0).setScale(t*(1/r),s*(1/n)).setDepth(-200)}}class d{constructor(e){this.segments=[],this.pointStart=new n.b2Vec2(0,0),this.pointEnd=new n.b2Vec2(0,0),this.player=e,this.scene=e.scene,this.b2Physics=e.b2Physics,this.debugGraphics=this.scene.add.graphics(),this.initRays(this.b2Physics.worldScale/4)}update(e){X&&this.debugGraphics.clear();const t=this.segments;for(const e of this.segments)this.resetSegment(e),e.body.GetWorldPoint(n.b2Vec2.ZERO,this.pointStart),e.body.GetWorldPoint(e.groundRayDirection,this.pointEnd),this.b2Physics.world.RayCast(this.pointStart,this.pointEnd,e.groundRayCallback),X&&this.drawDebug(e.groundRayResult.hit?255:65280);this.isTailGrounded=t[0].groundRayResult.hit,this.isNoseGrounded=t[t.length-1].groundRayResult.hit,this.isCenterGrounded=t[3].groundRayResult.hit}getTimeInAir(){if(this.segments.some((e=>e.groundRayResult.hit)))return-1;const e=Math.max(...this.segments.map((e=>e.groundRayResult.lastHitTime)));return this.scene.game.getTime()-e}isInAir(){return-1!==this.getTimeInAir()}rayCallbackFactory(e){return(t,s,i,o)=>{if(!t.IsSensor())return e.hit=!0,e.point=s,e.normal=i,e.fraction=o,e.lastHitTime=this.scene.game.getTime(),o}}resetSegment(e){e.groundRayResult.hit=!1,e.groundRayResult.point=null,e.groundRayResult.normal=null,e.groundRayResult.fraction=-1}drawDebug(e){this.debugGraphics.lineStyle(2,e,1);const t=this.b2Physics.worldScale;this.debugGraphics.lineBetween(this.pointStart.x*t,-this.pointStart.y*t,this.pointEnd.x*t,-this.pointEnd.y*t)}initRays(e){const t={hit:!1,point:null,normal:null,fraction:-1,lastHitTime:-1};for(const s of this.player.parts.boardSegments){const i=this.b2Physics.rubeLoader.getCustomProperty(s,"int","phaserBoardSegmentIndex",-1)===this.player.parts.boardSegments.length-1,o=Object.assign({},t);Object.assign({},t),this.segments.push({body:s,groundRayDirection:new n.b2Vec2(0,-e/this.b2Physics.worldScale),groundRayResult:o,groundRayCallback:this.rayCallbackFactory(o)}),i&&(this.nose=this.segments[this.segments.length-1])}}}const u=()=>{const e=localStorage.getItem(R);return e&&O.includes(e)?e:M.level_001};class p{constructor(e){this.levelFinished=!1,this.isCrashed=!1,this.timeGrounded=0,this.pickupsToProcess=new Set,this.seenSensors=new Set,this.comboLeeway=null,this.comboAccumulatedScore=0,this.comboMultiplier=0,this.totalTrickScore=0,this.totalCollectedPresents=0,this.trickScoreLog=[],this.anglePreviousUpdate=0,this.totalRotation=0,this.currentFlipRotation=0,this.pendingFrontFlips=0,this.pendingBackFlips=0,this.landedFrontFlips=0,this.landedBackFlips=0,this.lastDistance=0,this.parts=e.parts,this.playerController=e,this.b2Physics=e.b2Physics,this.state=e.board.isInAir()?"in_air":"grounded",this.registerCollisionListeners(),this.playerController.scene.observer.on("enter_in_air",(()=>this.state="in_air")),this.playerController.scene.observer.on("enter_grounded",(()=>{this.state="grounded",this.timeGrounded=this.playerController.scene.game.getTime(),this.landedFrontFlips+=this.pendingFrontFlips,this.landedBackFlips+=this.pendingBackFlips;const e=this.pendingBackFlips+this.pendingFrontFlips;if(e>=1){this.trickScoreLog.push({type:"flip",flips:e,timestamp:Date.now()});const t=e*e*V;this.totalTrickScore+=t,this.comboAccumulatedScore+=t*U,this.comboMultiplier++,this.playerController.scene.observer.emit("combo_change",this.comboAccumulatedScore,this.comboMultiplier),this.playerController.scene.observer.emit("score_change",this.getCurrentScore()),this.resetComboLeewayTween(),this.comboLeeway=this.createComboLeewayTween(!1)}this.totalRotation=0,this.currentFlipRotation=0,this.pendingBackFlips=0,this.pendingFrontFlips=0}))}createComboLeewayTween(e=!0){return this.playerController.scene.tweens.addCounter({paused:e,from:-.5*Math.PI,to:1.5*Math.PI,duration:4e3,onUpdate:e=>this.playerController.scene.observer.emit("combo_leeway_update",e.getValue()),onComplete:e=>this.handleComboComplete()})}reset(){this.totalTrickScore=0,this.trickScoreLog=[],this.comboLeeway&&(this.comboLeeway.stop(),this.comboLeeway=null),this.totalCollectedPresents=0,this.comboMultiplier=0,this.comboAccumulatedScore=0,this.levelFinished=!1,this.isCrashed=!1,this.seenSensors.clear(),this.pickupsToProcess.clear(),this.pendingFrontFlips=0,this.pendingBackFlips=0,this.landedBackFlips=0,this.landedFrontFlips=0,this.currentFlipRotation=0,this.anglePreviousUpdate=0,this.lastDistance=0,this.timeGrounded=0,this.totalRotation=0}getCurrentScore(){return{distance:this.getTravelDistanceMeters(),coins:this.totalCollectedPresents,trickScore:this.totalTrickScore,finishedLevel:this.levelFinished,crashed:this.isCrashed,trickScoreLog:this.trickScoreLog,level:u()}}getState(){return this.state}getTravelDistanceMeters(){const e=this.parts.body.GetPosition().x;return 5*Math.floor(e/5)}registerCollisionListeners(){this.playerController.b2Physics.on("post_solve",((e,t)=>{if(this.isCrashed)return;const s=e.GetFixtureA().GetBody(),i=e.GetFixtureB().GetBody();s!==i&&(s===this.parts.head||i===this.parts.head)&&Math.max(...t.normalImpulses)>j&&this.setCrashed()})),this.playerController.b2Physics.on("begin_contact",(e=>{var t,s;const i=e.GetFixtureA(),o=e.GetFixtureB(),r=i.GetBody(),n=o.GetBody();i.IsSensor()&&!this.seenSensors.has(r)&&(null===(t=i.customPropertiesMap)||void 0===t?void 0:t.phaserSensorType)?this.handleSensor(r,i):o.IsSensor()&&!this.seenSensors.has(n)&&(null===(s=o.customPropertiesMap)||void 0===s?void 0:s.phaserSensorType)&&this.handleSensor(n,o)}))}setCrashed(){this.isCrashed=!0,this.playerController.scene.observer.emit("enter_crashed",this.getCurrentScore()),this.resetComboLeewayTween()}handleSensor(e,t){var s;if(this.seenSensors.add(e),!this.isCrashed&&!this.levelFinished)switch(null===(s=t.customPropertiesMap)||void 0===s?void 0:s.phaserSensorType){case"pickup_present":this.pickupsToProcess.add(e);break;case"level_finish":{this.playerController.scene.cameras.main.stopFollow(),console.log("congratulations you reached the end of the level"),this.handleComboComplete(),this.levelFinished=!0,this.resetComboLeewayTween();const e=this.getCurrentScore();this.playerController.scene.observer.emit("score_change",e),this.playerController.scene.observer.emit("level_finish",e);break}case"level_deathzone":this.setCrashed()}}update(e){this.processPickups();const t=this.playerController.board.isInAir();"grounded"===this.state&&t&&!this.isCrashed?this.playerController.scene.observer.emit("enter_in_air"):"in_air"!==this.state||t||this.isCrashed||this.playerController.scene.observer.emit("enter_grounded"),this.updateTrickCounter(),this.updateComboLeeway(),this.updateDistance()}processPickups(){for(const e of this.pickupsToProcess){const t=e.GetUserData();this.b2Physics.world.DestroyBody(e),t.destroy(),this.totalCollectedPresents++,this.playerController.scene.observer.emit("pickup_present",this.totalCollectedPresents),this.playerController.scene.observer.emit("score_change",this.getCurrentScore())}this.pickupsToProcess.clear()}updateTrickCounter(){if("in_air"===this.state){const e=i.Math.Angle.Normalize(this.parts.body.GetAngle()),t=this.calculateDifferenceBetweenAngles(this.anglePreviousUpdate,e);this.totalRotation+=t,this.currentFlipRotation+=t,this.anglePreviousUpdate=e,this.currentFlipRotation>=Math.PI*(0===this.pendingBackFlips?1.25:2)?(this.pendingBackFlips++,this.currentFlipRotation=0):this.currentFlipRotation<=Math.PI*-(0===this.pendingFrontFlips?1.25:2)&&(this.pendingFrontFlips++,this.currentFlipRotation=0)}}updateComboLeeway(){this.comboLeeway&&("in_air"===this.state||!this.playerController.board.isCenterGrounded||this.b2Physics.isPaused?this.comboLeeway.isPlaying()&&this.comboLeeway.pause()&&X&&console.log("pause comboLeeway"):this.comboLeeway.isPaused()&&this.comboLeeway.resume()&&X&&console.log("resume comboLeeway"))}resetComboLeewayTween(){this.comboLeeway&&(this.comboLeeway.stop(),this.comboLeeway=null)}calculateDifferenceBetweenAngles(e,t){let s=t-e;return s<-Math.PI?s+=2*Math.PI:s>Math.PI&&(s-=2*Math.PI),s}updateDistance(){const e=this.getTravelDistanceMeters();e===this.lastDistance||this.isCrashed||this.levelFinished||(this.playerController.scene.observer.emit("distance_change",e),this.playerController.scene.observer.emit("score_change",this.getCurrentScore()),this.lastDistance=e)}handleComboComplete(){if(this.levelFinished)return;const e=this.comboAccumulatedScore*this.comboMultiplier;this.totalTrickScore+=e,this.trickScoreLog.push({type:"combo",multiplier:this.comboMultiplier,accumulator:this.comboAccumulatedScore,timestamp:Date.now()}),this.playerController.scene.observer.emit("score_change",this.getCurrentScore()),this.playerController.scene.observer.emit("combo_change",0,0),this.comboAccumulatedScore=0,this.comboMultiplier=0}}class m{constructor(e,t){this.scene=e,this.b2Physics=t,this.scene.input.on("pointerdown",(e=>this.MouseDown({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale}))),this.scene.input.on("pointerup",(e=>this.MouseUp({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale}))),this.scene.input.on("pointermove",(e=>this.MouseMove({x:e.worldX/this.b2Physics.worldScale,y:-e.worldY/this.b2Physics.worldScale},!0)))}MouseMove(e,t){t&&this.mouseJoint&&this.mouseJoint.SetTarget(e)}MouseUp(e){this.mouseJoint&&(this.b2Physics.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null)}MouseDown(e){let t;if(this.mouseJoint&&(this.b2Physics.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null),this.b2Physics.world.QueryPointAABB(e,(s=>s.GetBody().GetType()!==n.b2BodyType.b2_dynamicBody||!s.TestPoint(e)||(t=s,!1))),t){const s=5,i=.5,o=t.GetBody(),r=new n.b2MouseJointDef;r.collideConnected=!0,r.damping=.1,r.bodyA=this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserTerrain",!0)[0],r.bodyB=o,r.target.Copy(e),r.maxForce=700*o.GetMass(),n.b2LinearStiffness(r,s,i,r.bodyA,r.bodyB),this.mouseJoint=this.b2Physics.world.CreateJoint(r),o.SetAwake(!0)}}}const g=(e,t=!0)=>e.distance+y(e,t)+e.coins*G+(e.finishedLevel?N:0),y=(e,t)=>t?e.trickScore:e.trickScoreLog.reduce(((e,t)=>"combo"===t.type?e+t.multiplier*t.accumulator:"flip"===t.type?e+t.flips*t.flips*V:e),0),b=()=>Math.random().toString(36).slice(2);var v,w,f=function(e,t,s,i){return new(s||(s=Promise))((function(o,r){function n(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};!function(e){e.PANEL_PAUSE_MENU="panel-pause-menu",e.PANEL_SELECT_LEVEL="panel-select-level",e.PANEL_LEADERBOARDS="panel-leaderboards",e.PANEL_HOW_TO_PLAY="panel-how-to-play",e.PANEL_SETTINGS="panel-settings",e.PANEL_CREDITS="panel-credits",e.PANEL_YOUR_SCORE="panel-your-score",e.NONE="none"}(v||(v={})),function(e){e.HUD_DISTANCE="hud-distance",e.HUD_COMBO="hud-combo",e.HUD_SCORE="hud-score"}(w||(w={}));class P extends i.Scene{constructor(){super({key:"GameUIScene"}),this.panels=[],this.pendingScore=null,this.localScores=[],this.crashed=!1,this.finished=!1}init([e,t]){this.observer=e,this.restartGame=t,this.resolutionMod=this.game.canvas.width/J}create(){const e=Number(localStorage.getItem(k)||80)/100;this.music=this.sound.add("riverside_ride",{loop:!0,volume:.3*e,rate:.95,delay:1,detune:0}),this.music.play();const t=Number(localStorage.getItem(I)||80)/100;this.sfx_jump_start=this.sound.add("boink",{detune:-200,volume:t}),this.sfx_pickup_present=this.sound.add("pickup_present",{detune:100,rate:1.1,volume:t}),this.sfx_death=this.sound.add("death",{detune:700,rate:1.25,volume:t}),this.sfx_grunt=this.sound.add("grunt",{detune:700,rate:1.25,volume:.6*t}),this.sfx_applause=this.sound.add("applause",{detune:0,rate:1,volume:.6*t}),this.sfx_game_over_demon=this.sound.add("game_over_demon",{detune:0,rate:.95,volume:.6*t});const s=this.cameras.main.worldView.x+this.cameras.main.width/2;this.cameras.main.worldView.y,this.cameras.main.height,T.setLevel(u()),this.initDomUi(),this.observer.on("toggle_pause",((e,t)=>this.setPanelVisibility(e?t:v.NONE))),this.observer.on("jump_start",(()=>this.sfx_jump_start.play({delay:.15,detune:-200,rate:1}))),this.observer.on("pickup_present",(e=>{this.hudDistance&&(this.hudDistance.innerText=String(e)+"x"),this.sfx_pickup_present.play()})),this.observer.on("combo_change",((e,t)=>{this.hudCombo&&(this.hudCombo.innerText=e?e+"x"+t:"-")})),this.observer.on("score_change",(e=>{this.hudScore&&(this.hudScore.innerText=String(g(e)))})),this.comboLeewayChart=this.add.graphics(),this.observer.on("combo_leeway_update",(e=>{this.comboLeewayChart.clear().fillStyle(16777215).slice(s,72*this.resolutionMod,12*this.resolutionMod,e,1.5*Math.PI).fillPath()})),this.observer.on("enter_crashed",(e=>{this.pendingScore=e,this.crashed=!0,this.sfx_death.play(),this.sfx_grunt.play(),this.finished||(this.comboLeewayChart.clear(),this.hudCombo&&(this.hudCombo.innerText="-"),this.sfx_game_over_demon.play(),this.tweens.add({targets:this.music,volume:0,detune:-500,rate:.5,duration:750,onComplete:()=>f(this,void 0,void 0,(function*(){this.music.stop(),yield this.updateYourScorePanelData(e),this.setPanelVisibility(v.PANEL_YOUR_SCORE)}))}))})),this.observer.on("level_finish",(e=>{this.crashed||(this.pendingScore=e,this.finished=!0,this.sfx_applause.play(),this.comboLeewayChart.clear(),this.tweens.add({targets:this.music,volume:0,duration:2e3,onComplete:()=>f(this,void 0,void 0,(function*(){this.music.stop(),yield this.updateYourScorePanelData(e),this.setPanelVisibility(v.PANEL_YOUR_SCORE)}))}))}))}update(){}initDomUi(){const e=this.cameras.main.worldView.x+this.cameras.main.width/2,t=this.cameras.main.worldView.y+this.cameras.main.height/2,s=this.add.dom(e,t).createFromCache("dom_game_ui");s.setScale(this.resolutionMod).addListener("click");const i=localStorage.getItem(E)||"1",o=Array.from(document.querySelectorAll('#settings-form input[name="resolution"]'));for(const e of o)e.value===i&&(e.checked=!0);const r=localStorage.getItem(k)||"80",n=document.querySelector('#settings-form input[name="volumeMusic"]');n&&(n.value=r);const a=localStorage.getItem(I)||"80",l=document.querySelector('#settings-form input[name="volumeSfx"]');l&&(l.value=a);const h=this.sys.game.device.browser;if(!(h.chrome||h.edge||h.opera)){const e=document.getElementById("unsupported-browser-notice");if(!e)throw new Error('element with id "unsupported-browser-notice" not found');console.warn("Unsupported browser detected. Game may run well but it was not optimized for this particular browser:",h),e.classList.remove("hidden")}const c=document.getElementById("pause-game-icon"),d=document.getElementById("how-to-play-icon");if(c&&d&&setTimeout((()=>{c.classList.remove("hidden"),d.classList.remove("hidden")}),250),this.panelPauseMenu=document.getElementById(v.PANEL_PAUSE_MENU),this.panelSelectLevel=document.getElementById(v.PANEL_SELECT_LEVEL),this.panelHowToPlay=document.getElementById(v.PANEL_HOW_TO_PLAY),this.panelLeaderboards=document.getElementById(v.PANEL_LEADERBOARDS),this.panelSettings=document.getElementById(v.PANEL_SETTINGS),this.panelCredits=document.getElementById(v.PANEL_CREDITS),this.panelYourScore=document.getElementById(v.PANEL_YOUR_SCORE),this.hudDistance=document.getElementById(w.HUD_DISTANCE),this.hudCombo=document.getElementById(w.HUD_COMBO),this.hudScore=document.getElementById(w.HUD_SCORE),!this.panelPauseMenu)throw new Error("panelPauseMenu not found");if(!this.panelSelectLevel)throw new Error("panelSelectLevel not found");if(!this.panelHowToPlay)throw new Error("panelHowToPlay not found");if(!this.panelLeaderboards)throw new Error("panelLeaderboards not found");if(!this.panelSettings)throw new Error("panelSettings not found");if(!this.panelCredits)throw new Error("panelCredits not found");if(!this.panelYourScore)throw new Error("panelYourScore not found");if(!this.hudDistance)throw new Error("hudDistance not found");if(!this.hudCombo)throw new Error("hudCombo not found");if(!this.hudScore)throw new Error("hudScore not found");return this.panels=[this.panelPauseMenu,this.panelSelectLevel,this.panelHowToPlay,this.panelLeaderboards,this.panelSettings,this.panelCredits,this.panelYourScore],s.on("click",(e=>f(this,void 0,void 0,(function*(){var t,s,i,o;switch(e.target.id){case"btn-goto-pause-menu":this.setPanelVisibility(v.PANEL_PAUSE_MENU);break;case"btn-resume-game":this.setPanelVisibility(v.NONE),this.observer.emit("resume_game");break;case"btn-goto-select-level":{const e=document.querySelector("#panel-select-level #btn-goto-pause-menu");e&&(this.crashed?e.classList.add("hidden"):e.classList.remove("hidden")),this.setPanelVisibility(v.PANEL_SELECT_LEVEL);break}case"btn-goto-how-to-play":this.setPanelVisibility(v.PANEL_HOW_TO_PLAY);break;case"btn-goto-leaderboards":yield this.updateLeaderboardPanelData(),this.setPanelVisibility(v.PANEL_LEADERBOARDS);break;case"btn-goto-settings":this.setPanelVisibility(v.PANEL_SETTINGS);break;case"btn-goto-credits":this.setPanelVisibility(v.PANEL_CREDITS);break;case"pause-game-icon":(null===(t=this.panelPauseMenu)||void 0===t?void 0:t.classList.contains("hidden"))&&this.observer.emit("pause_game_icon_pressed");break;case"how-to-play-icon":(null===(s=this.panelPauseMenu)||void 0===s?void 0:s.classList.contains("hidden"))&&this.observer.emit("how_to_play_icon_pressed");break;case"btn-score-submit":{const e=document.querySelector(".submit-score"),t=document.getElementById("username");(null==t?void 0:t.value)&&this.pendingScore&&e&&((null===(i=T.auth)||void 0===i?void 0:i.currentUser)&&(T.rexLeaderboard.setUser({userID:T.auth.currentUser.uid,userName:t.value}),yield T.auth.currentUser.updateProfile({displayName:t.value})),localStorage.setItem(D,t.value),yield T.submit(this.pendingScore),yield this.updateYourScorePanelData(this.pendingScore),e.classList.add("hidden"));break}case"btn-save-settings":{e.preventDefault();const t=null===(o=this.panelSettings)||void 0===o?void 0:o.querySelector("form");t&&(localStorage.setItem(E,t.resolution.value||"1"),localStorage.setItem(k,t.volumeMusic.value),localStorage.setItem(I,t.volumeSfx.value),location.reload());break}case"btn-play-again":this.playAgain();break;case"level_001":case"level_002":case"level_003":case"level_004":localStorage.setItem(R,e.target.id),T.setLevel(e.target.id),this.playAgain();break;default:X&&console.log("non-interactable target id",e.target.id)}})))),s}playAgain(){this.music.stop(),this.sfx_game_over_demon.stop(),this.crashed=!1,this.finished=!1,this.restartGame()}setPanelVisibility(e){const t=document.getElementById("pause-game-icon"),s=document.getElementById("how-to-play-icon");t&&s&&(e===v.NONE?(t.classList.remove("hidden"),s.classList.remove("hidden")):(t.classList.add("hidden"),s.classList.add("hidden"))),this.panels.forEach((t=>{t.id===e?t.classList.remove("hidden"):t.classList.add("hidden")}))}updateYourScorePanelData(e){var t;return f(this,void 0,void 0,(function*(){if(this.panelYourScore){const s=document.getElementById("your-score-distance"),i=document.getElementById("your-score-coins"),o=document.getElementById("your-score-trick-score"),r=document.getElementById("your-score-bonus"),n=document.getElementById("your-score-best-combo"),a=document.getElementById("your-score-total"),l=document.getElementById("username"),h=document.querySelector(".submit-score");e.finishedLevel?this.panelYourScore.classList.add("succeeded"):this.panelYourScore.classList.remove("succeeded");const c=e.trickScoreLog.filter((e=>"combo"===e.type)),d=c.length?Math.max(...c.map((e=>e.accumulator*e.multiplier))):0;s&&(s.innerText=String(e.distance)+"m"),i&&(i.innerText=`${e.coins}x${G}`),o&&(o.innerText=String(e.trickScore)),r&&(r.innerText=String(e.finishedLevel?N:0)),n&&(n.innerText=String(d)),a&&(a.innerText=String(g(e)));const u=null===(t=T.auth)||void 0===t?void 0:t.currentUser;if(!u)return void(localStorage.getItem(D)?(null==h||h.classList.add("hidden"),yield T.submit(e)):(l.value=`Player_${b()}`,l.setAttribute("value",l.value),localStorage.setItem(D,l.value)));if(!l)throw new Error("username input field not found");const p=document.querySelector(".submit-score-offline-info");if(p&&p.classList.add("hidden"),u.displayName){null==h||h.classList.add("hidden"),T.rexLeaderboard.setUser({userID:u.uid,userName:u.displayName}),yield T.submit(e);const t=(yield T.rexLeaderboard.loadFirstPage()).map((e=>Object.assign(Object.assign({},e),{total:g(e,!1)}))).sort(((e,t)=>Number(t.total)-Number(e.total))),s=t.findIndex((e=>e.userID===u.uid)),i=document.getElementById("your-score-rank-value");i&&-1!==s&&(null==t?void 0:t.length)&&(i.innerText=`${s+1}/${t.length}`)}else l.value=`Player_${b()}`,l.setAttribute("value",l.value),localStorage.setItem(D,l.value)}}))}updateLeaderboardPanelData(){var e,t,s,i,o;return f(this,void 0,void 0,(function*(){if(null===(e=T.auth)||void 0===e?void 0:e.currentUser){const e=document.querySelector(".leaderboard-note");e&&e.classList.add("hidden")}let r=T.auth?yield T.rexLeaderboard.loadFirstPage():(JSON.parse(localStorage.getItem(F)||"{}")[u()]||[]).map((e=>Object.assign(Object.assign({},e),{userName:localStorage.getItem(D)})));const n=document.getElementById("leaderboard-item-template"),a=document.getElementById("leaderboard-item-container");if(this.panelLeaderboards&&n&&a){const e=(null===(s=null===(t=T.auth)||void 0===t?void 0:t.currentUser)||void 0===s?void 0:s.displayName)||localStorage.getItem(D),l=r.map((e=>Object.assign(Object.assign({},e),{total:g(e,!1)}))).sort(((e,t)=>Number(t.total)-Number(e.total)));a.innerText="";for(const[t,s]of l.entries()){const r=s.userName,l=n.content.cloneNode(!0),h=l.querySelector("#leaderboard-item-rank"),c=l.querySelector("#leaderboard-item-username"),d=l.querySelector("#leaderboard-item-score");h&&(h.innerHTML=String(t+1)),c&&(c.innerHTML=String(r)),d&&(d.innerHTML=String(g(s))),!c||!e||(null===(o=null===(i=T.auth)||void 0===i?void 0:i.currentUser)||void 0===o?void 0:o.uid)!==s.userID&&T.auth||c.classList.add("your-own-score"),a.appendChild(l)}}}))}}class S{constructor(e,t){var s,i,o,r,a,l,h,c,u,g;this.jumpForce=39e3,this.leanForce=150,this.jumpVector=new n.b2Vec2(0,0),this.scene=e,this.b2Physics=t,this.cursors=null===(s=this.scene.input.keyboard)||void 0===s?void 0:s.createCursorKeys(),this.scene.observer.on("pause_game_icon_pressed",(()=>this.pauseGame())),this.scene.observer.on("how_to_play_icon_pressed",(()=>this.pauseGame(v.PANEL_HOW_TO_PLAY))),null===(i=this.scene.input.keyboard)||void 0===i||i.on("keydown-ESC",(()=>this.pauseGame())),null===(o=this.cursors)||void 0===o||o.space.on("down",(()=>this.pauseGame())),this.scene.observer.on("resume_game",(()=>this.b2Physics.isPaused=!1)),null===(r=this.cursors)||void 0===r||r.up.on("down",(()=>{this.cursors&&!this.state.isCrashed&&!this.state.levelFinished&&"grounded"===this.state.getState()&&this.scene.game.getTime()-this.cursors.up.timeDown<=250&&!this.b2Physics.isPaused&&this.scene.observer.emit("jump_start")})),this.initBodyParts(),this.board=new d(this),this.state=new p(this),X&&(new m(e,t),this.debugKeyLeft=null===(a=this.scene.input.keyboard)||void 0===a?void 0:a.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.debugKeyRight=null===(l=this.scene.input.keyboard)||void 0===l?void 0:l.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.debugKeyUp=null===(h=this.scene.input.keyboard)||void 0===h?void 0:h.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.debugKeyDown=null===(c=this.scene.input.keyboard)||void 0===c?void 0:c.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.debugControls=new Phaser.Cameras.Controls.SmoothedKeyControl({camera:this.scene.cameras.main,zoomIn:null===(u=this.scene.input.keyboard)||void 0===u?void 0:u.addKey(Phaser.Input.Keyboard.KeyCodes.Q),zoomOut:null===(g=this.scene.input.keyboard)||void 0===g?void 0:g.addKey(Phaser.Input.Keyboard.KeyCodes.E),acceleration:.05,drag:.0015,maxSpeed:1,zoomSpeed:.02}))}pauseGame(e=v.PANEL_PAUSE_MENU){this.state.isCrashed||this.state.levelFinished||(this.b2Physics.isPaused=!this.b2Physics.isPaused,this.state.updateComboLeeway(),this.scene.observer.emit("toggle_pause",this.b2Physics.isPaused,e))}update(e){var t,s,i,o,r;if(!this.b2Physics.isPaused){if(H.begin("snowman"),X&&(this.debugControls&&this.debugControls.update(e),(null===(t=this.debugKeyLeft)||void 0===t?void 0:t.isDown)&&(this.scene.cameras.main.scrollX-=300*e),(null===(s=this.debugKeyRight)||void 0===s?void 0:s.isDown)&&(this.scene.cameras.main.scrollX+=300*e),(null===(i=this.debugKeyUp)||void 0===i?void 0:i.isDown)&&(this.scene.cameras.main.scrollY-=300*e),(null===(o=this.debugKeyDown)||void 0===o?void 0:o.isDown)&&(this.scene.cameras.main.scrollY+=300*e)),this.state.update(e),this.state.isCrashed&&this.detachBoard(),this.board.getTimeInAir()>100&&this.resetLegs(),!this.state.isCrashed&&!this.state.levelFinished){if(this.board.update(e),(null===(r=this.scene.input.activePointer)||void 0===r?void 0:r.isDown)&&this.scene.input.activePointer.wasTouch){const t=this.scene.input.activePointer;t.motionFactor=.2,this.scene.input.activePointer.x<this.scene.cameras.main.width/2?this.leanBackward(e):this.leanForward(e),t.velocity.y<-30&&this.scene.game.getTime()-t.moveTime<=250&&this.jump(e)}else this.scene.input.activePointer.motionFactor=.8;this.cursors&&(this.cursors.up.isDown&&this.leanUp(e),this.cursors.left.isDown&&this.leanBackward(e),this.cursors.right.isDown&&this.leanForward(e),this.cursors.down.isDown&&this.leanCenter(e),this.cursors.up.isDown&&this.scene.game.getTime()-this.cursors.up.timeDown<=250&&this.jump(e))}H.end("snowman")}}detachBoard(){this.parts.bindingLeft&&this.b2Physics.world.DestroyJoint(this.parts.bindingLeft),this.parts.bindingRight&&this.b2Physics.world.DestroyJoint(this.parts.bindingRight),this.parts.distanceLegLeft&&this.b2Physics.world.DestroyJoint(this.parts.distanceLegLeft),this.parts.distanceLegRight&&this.b2Physics.world.DestroyJoint(this.parts.distanceLegRight),this.parts.weldCenter&&this.b2Physics.world.DestroyJoint(this.parts.weldCenter),this.parts.prismatic&&this.b2Physics.world.DestroyJoint(this.parts.prismatic)}jump(e){if(this.scene.game.getTime()-this.state.timeGrounded<100)return;this.leanUp(e);const{isTailGrounded:t,isCenterGrounded:s,isNoseGrounded:i}=this.board;if(s||t||i){const t=this.jumpForce*e,i=this.jumpVector.Set(0,0);s?this.parts.body.GetWorldVector({x:0,y:.3*t},i).Add({x:0,y:1.25*t}):this.parts.body.GetWorldVector({x:0,y:.5*t},i).Add({x:0,y:.85*t}),this.parts.body.ApplyForceToCenter(i,!0)}}resetLegs(){var e,t;null===(e=this.parts.distanceLegLeft)||void 0===e||e.SetLength(.65),null===(t=this.parts.distanceLegRight)||void 0===t||t.SetLength(.65)}leanBackward(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.55),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.8),this.parts.weldCenter.m_referenceAngle=Math.PI/180*-10,this.parts.body.ApplyAngularImpulse(this.leanForce*e)}leanForward(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.8),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.55),this.parts.weldCenter.m_referenceAngle=Math.PI/180*10,this.parts.body.ApplyAngularImpulse(-this.leanForce*e)}leanCenter(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.55),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.55),this.parts.weldCenter.m_referenceAngle=0}leanUp(e){var t,s;null===(t=this.parts.distanceLegLeft)||void 0===t||t.SetLength(.8),null===(s=this.parts.distanceLegRight)||void 0===s||s.SetLength(.8),this.parts.weldCenter.m_referenceAngle=0}initBodyParts(){this.parts={head:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","head")[0],body:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","body")[0],boardSegments:this.b2Physics.rubeLoader.getBodiesByCustomProperty("string","phaserPlayerCharacterPart","boardSegment"),bindingLeft:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","bindingLeft")[0],bindingRight:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","bindingRight")[0],distanceLegLeft:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","distanceLegLeft")[0],distanceLegRight:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","distanceLegRight")[0],weldCenter:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","weldCenter")[0],prismatic:this.b2Physics.rubeLoader.getJointsByCustomProperty("string","phaserPlayerCharacterSpring","prismatic")[0]}}}class _ extends i.Scene{constructor(){super({key:"GameScene"})}create(){this.cameras.main.setDeadzone(50,125),this.cameras.main.setBackgroundColor(5592405);const e=this.cameras.main.width/J;if(this.cameras.main.setZoom(K*e),this.cameras.main.scrollX-=this.cameras.main.width,this.cameras.main.scrollY-=this.cameras.main.height,this.observer&&this.observer.destroy(),this.observer=new i.Events.EventEmitter,this.b2Physics=new h(this,40,new n.b2Vec2(0,-10)),this.b2Physics.loadRubeScene(u()),this.playerController=new S(this,this.b2Physics),this.terrain=new a(this,this.b2Physics),this.cameras.main.startFollow(this.b2Physics.rubeLoader.getBodiesByCustomProperty("bool","phaserCameraFollow",!0)[0].GetUserData(),!1,.8,.25),this.cameras.main.followOffset.set(-187.5,0),this.scene.launch("GameUIScene",[this.observer,()=>{this.playerController.state.reset(),this.scene.restart()}]),this.backdrop=new c(this),X){const e=this.add.graphics();e.lineStyle(5,296712,1),e.beginPath(),e.moveTo(0,0),e.lineTo(40,0),e.closePath(),e.setDepth(1e3),e.strokePath(),e.lineStyle(5,12192552,1),e.beginPath(),e.moveTo(0,0),e.lineTo(0,40),e.closePath(),e.setDepth(1e3),e.strokePath()}this.observer.on("enter_crashed",(()=>this.cameras.main.shake(200,1/e*.03)))}update(){H.begin();const e=this.game.loop.delta/1e3;this.b2Physics.update(),this.playerController.update(e),this.backdrop.update(),H.end()}}var C=s(260),L=s(4866),x=(s(3654),s(1170),s(8867));const A="303158013990";var B=function(e,t,s,i){return new(s||(s=Promise))((function(o,r){function n(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const T=new class{constructor(){this.numAuthAttempts=0;{window.firebase=L.Z;const e={apiKey:"AIzaSyCCxWe4_fyEhV9Qyv3Sb1GF_AZchgbhBG8",authDomain:"snowboarding-game.firebaseapp.com",projectId:"snowboarding-game",storageBucket:"snowboarding-game.appspot.com",messagingSenderId:A,appId:"1:303158013990:web:d85e188299ea519e1936e7",measurementId:A};L.Z.initializeApp(e),this.auth=L.Z.auth(),this.auth.onAuthStateChanged((e=>B(this,void 0,void 0,(function*(){if(X&&console.log("onAuthStateChanged user",e),e)e.displayName&&e.displayName!==localStorage.getItem(D)&&localStorage.setItem(D,e.displayName),this.setLevel(u());else{if(X&&console.log("try signInAnonymously"),++this.numAuthAttempts>=3)throw new Error("failed to authenticate multiple times.");this.auth.signInAnonymously().catch((e=>console.error("Failed to login anonymous user",e)))}}))))}}setLevel(e){var t;this.numAuthAttempts=0,this.currentLevel=e,localStorage.setItem(R,e),(null===(t=this.auth)||void 0===t?void 0:t.currentUser)&&(this.rexLeaderboard=new x.wB({root:`leaderboard_${e}`,pageItemCount:200}))}submit(e){var t;return B(this,void 0,void 0,(function*(){if(e.id=b(),e.timestamp=Date.now(),this.saveScoreLocally(e),null===(t=this.auth)||void 0===t?void 0:t.currentUser){const t=yield this.rexLeaderboard.getScore(this.auth.currentUser.uid);if(!t||g(t)<g(e))return yield this.rexLeaderboard.post(g(e),e,e.timestamp),!0}return!1}))}saveScoreLocally(e){const t=JSON.parse(localStorage.getItem(F)||"{}"),s=t[e.level]||[];s.push(e),t[e.level]=s,localStorage.setItem(F,JSON.stringify(t))}},E="snowboarding_game_resolution",k="snowboarding_game_volume_music",I="snowboarding_game_volume_sfx",D="snowboarding_game_user_name",F="snowboarding_game_user_scores_v3",R="snowboarding_game_level_current";var M;!function(e){e.level_001="level_001",e.level_002="level_002",e.level_003="level_003",e.level_004="level_004",e.level_005="level_005"}(M||(M={}));const O=[M.level_001,M.level_002,M.level_003,M.level_004],G=100,N=5e3,V=200,U=.2,j=8,J=1280,Y=720,z=Number(localStorage.getItem(E)||1),K=Number(localStorage.getItem("snowboarding_game_debug_zoom")||1),X=Boolean(localStorage.getItem("snowboarding_game_debug")),q={title:"Snowboarding Game",version:"1.1.1",type:i.AUTO,backgroundColor:"#ffffff",disableContextMenu:!0,parent:"phaser-wrapper",dom:{createContainer:!0},fps:{min:55,target:60,smoothStep:!0},scale:{mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH,width:J*z,height:Y*z},scene:[r,_,P],plugins:{global:[{key:"rexFirebase",plugin:o.Z,start:!0}]}};let H={begin:()=>null,end:()=>null};window.addEventListener("load",(()=>{if(new i.Game(q),X){const e={autoPlace:!0,targetFPS:60,redrawInterval:200,maximumHistory:200,scale:1,memoryUpdateInterval:100,memoryMaxHistory:600,FONT_FAMILY:"Arial",COLOR_FPS_BAR:"#34cfa2",COLOR_FPS_AVG:"#FFF",COLOR_TEXT_LABEL:"#FFF",COLOR_TEXT_TO_LOW:"#eee207",COLOR_TEXT_BAD:"#d34646",COLOR_TEXT_TARGET:"#d249dd",COLOR_BG:"#333333"};H=new C.Z(e),document.body.appendChild(H.dom)}}))}},s={};function i(e){var o=s[e];if(void 0!==o)return o.exports;var r=s[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,s,o,r)=>{if(!s){var n=1/0;for(c=0;c<e.length;c++){for(var[s,o,r]=e[c],a=!0,l=0;l<s.length;l++)(!1&r||n>=r)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(a=!1,r<n&&(n=r));if(a){e.splice(c--,1);var h=o();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[s,o,r]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.e=()=>Promise.resolve(),i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var o,r,[n,a,l]=s,h=0;if(n.some((t=>0!==e[t]))){for(o in a)i.o(a,o)&&(i.m[o]=a[o]);if(l)var c=l(i)}for(t&&t(s);h<n.length;h++)r=n[h],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(c)},s=self.webpackChunksnowboarding_game=self.webpackChunksnowboarding_game||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=i.O(void 0,[216],(()=>i(6335)));o=i.O(o)})();